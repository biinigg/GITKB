function allNodeLoaded(g,s){var b=!0,p=null;null==s&&(s=g.getRootNode());if(s.hasChildNodes())for(var p=s.childNodes,t=0;t<p.length&&!(b=allNodeLoaded(g,p[t]),!b);t++);else b=s.isLeaf()?!0:s.isLoaded();return b}
function showIndexPage(g,s,b,p){function t(a,b){b&&(r="");for(var e=null,c=a.childNodes,f=0;f<c.length;f++)e="",e+=c[f].data.id,e=b?e+",":e+(","+c[f].parentNode.data.id),e+=","+c[f].data.lang_key,e+=","+c[f].parentNode.indexOf(c[f]),e+=","+c[f].data.leaf,r=""==r?e:r+(";"+e),!c[f].data.leaf&&c[f].hasChildNodes()&&t(c[f],!1)}var D="TreeModel-Configs TreeModel-LKB TreeModel-ET_FOLDER TreeModel-WF_FOLDER TreeModel-SM_FOLDER TreeModel-EF_FOLDER TreeModel-WPP TreeModel-TT_FOLDER".split(" "),q=null,u=(new Ext.util.TaskRunner).newTask({timegap:900,
run:function(){try{var a=null,b=!1,e=!1;if(null!=mainPanel){for(var c=0;c<mainPanel.items.length;c++)if("EKB"==mainPanel.items.get(c).tabPackage)if(null==q){q=mainPanel.items.get(c).id;a=Ext.getCmp(q.substring(3)+"Main");a.globalTimerEvent(-1,this.timegap);mainPanel.setActiveTab(q);e=!0;break}else if(q==mainPanel.items.get(c).id||b)if(b){q=mainPanel.items.get(c).id;a=Ext.getCmp(q.substring(3)+"Main");a.globalTimerEvent(-1,this.timegap);mainPanel.setActiveTab(q);e=!0;break}else if(a=Ext.getCmp(q.substring(3)+
"Main"),a.switchToNextTab())b=!0;else{a.globalTimerEvent(0,this.timegap);mainPanel.setActiveTab(q);e=!0;break}if(!e)for(c=0;c<mainPanel.items.length;c++)if("EKB"==mainPanel.items.get(c).tabPackage){q=mainPanel.items.get(c).id;a=Ext.getCmp(q.substring(3)+"Main");a.globalTimerEvent(-1,this.timegap);mainPanel.setActiveTab(q);break}}}catch(f){window.console&&console.log(f.message)}},setTimeGap:function(a){if(null==a||""==a||1>a)a=600;this.timegap=a},getTimeGap:function(){return this.timegap},executeTask:function(){this.start(1E3*
this.timegap);null!=x&&x.changeIcon(!0)},stopTask:function(){null!=mainPanel.getActiveTab()&&"EKB"==mainPanel.getActiveTab().tabPackage&&Ext.getCmp(mainPanel.getActiveTab().id.substring(3)+"Main").globalTimerStop();this.stop();null!=x&&x.changeIcon(!1);q=null}});Ext.define("TreeModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"string"},{name:"text",type:"string"},{name:"level",type:"int"},{name:"leaf",type:"boolean"},{name:"url",type:"string"},{name:"parent",type:"string"},{name:"lang_key",
type:"string"},{name:"func_package",type:"string"},{name:"can_edit",type:"string"},{name:"init_load_expanded",type:"string"}]});var I=Ext.create("Ext.data.Store",{autoLoad:!1,checkSession:!1,fields:"dblistvalue userInfo pageTimerGap hasfavor sysMarquee hascus".split(" "),proxy:{type:"ajax",url:"./../../Funcs/Main/Index.dsc",actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{DCITag:g,uid:p,action:"init"}}}),y=new Ext.data.Store({fields:["label","value"],autoLoad:!1,proxy:{type:"memory",
reader:{type:"json"}}}),w=new Ext.data.Store({fields:["uid","uname","gname","ltime"],autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}}),k=Ext.create("Ext.form.field.ComboBox",{store:y,queryMode:"local",displayField:"label",valueField:"value",width:125,x:62,y:5,typeAhead:!0,editable:!1,listeners:{change:function(a,d,e,c){"undefined"!==typeof l&&null!=l&&(l.getRootNode().removeAll(),l.getProxy().extraParams.connid=d,l.load());"undefined"!==typeof h&&null!=h&&(h.getRootNode().removeAll(),h.getProxy().extraParams.connid=
d,h.load());Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:g,action:"hasCusTree",uid:p,connid:d},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=a.responseText.split("$"),2<=a.length){var d=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,d.msg,function(){iserror=!0;window.location=d.result})}}else a=Ext.JSON.decode(a.responseText),"true"==a.result[0].hasdefcus?m.setCusIcon():m.rmCusIcon(),"true"==a.result[0].hasfavcus?n.setCusIcon():n.rmCusIcon()},
failure:function(a,b){}})}}}),l=Ext.create("Ext.data.TreeStore",{model:"TreeModel",autoLoad:!1,proxy:{type:"ajax",url:"./../../Funcs/Main/Index.dsc",actionMethods:{read:"POST"},reader:{type:"json",root:"datas"},extraParams:{DCITag:g,action:"tree",uid:p,connid:""}},root:{text:b.func_tree_root,id:"FuncTreeRoot"}}),m=Ext.create("Ext.tree.Panel",{rootVisible:!0,viewConfig:{loadMask:!0,plugins:{ptype:"treeviewdragdrop",ddGroup:"ddgroup",sortOnDrop:!0,containerScroll:!0}},useArrows:!0,store:l,tbar:[{xtype:"button",
iconCls:"savebutton_tree",tooltip:b.save,handler:function(){t(m.getRootNode(),!0);null!=r&&""!=r&&Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:g,action:"save",uid:p,connid:k.getValue(),treeArr:r},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=a.responseText.split("$"),2<=a.length){var d=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,d.msg,function(){iserror=!0;window.location=d.result})}}else a=Ext.JSON.decode(a.responseText),a.success[0].result?
(m.setCusIcon(),Ext.MessageBox.alert(b.save_result_title,b.save_success)):Ext.MessageBox.alert(b.save_result_title,b.save_fail)},failure:function(a,d){Ext.MessageBox.alert(b.errmsg,b.system_error)}})}},{xtype:"button",iconCls:"refreshbutton_tree",tooltip:b.refersh,handler:function(){var a=k.getValue();if("undefined"!==typeof l&&null!=l){var b=allNodeLoaded(m,null);!l.isLoading()&&b&&(l.getRootNode().removeAll(),l.getProxy().extraParams.connid=a,l.load())}}},{xtype:"button",iconCls:"addfolderbutton",
tooltip:b.add,handler:function(){if(m.getSelectionModel().hasSelection()){var a=m.getSelectionModel().getSelection(),d={id:(new Date).getTime(),leaf:!1};a[0].data.leaf?l.getNodeById(a[0].data.parent).appendChild(d):a[0].appendChild(d);l.getNodeById(d.id).data.lang_key="lang"+d.id;Ext.MessageBox.show({title:b.add_folder_title,msg:b.node_lang_panel,width:300,buttons:Ext.MessageBox.OKCANCEL,multiline:!0,fn:function(a,c){if("ok"==a){var f=l.getNodeById(d.id);f.set("text",c);t(m.getRootNode(),!0);Ext.Ajax.request({method:"POST",
url:"./../../Funcs/Main/Index.dsc",params:{DCITag:g,action:"savelang",uid:p,connid:k.getValue(),langkey:f.data.lang_key,langvalue:c,treeArr:r},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=a.responseText.split("$"),2<=a.length){var d=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,d.msg,function(){iserror=!0;window.location=d.result})}}else a=Ext.JSON.decode(a.responseText),a.success[0].result?Ext.MessageBox.alert(b.add_result_title,b.add_success):Ext.MessageBox.alert(b.add_result_title,
b.add_fail)},failure:function(a,d){Ext.MessageBox.alert(b.errmsg,b.system_error)}})}else f=l.getNodeById(d.id),f.remove()}})}else Ext.MessageBox.alert(b.errmsg,b.no_f_node_selected)}},{xtype:"button",iconCls:"deletebutton_tree",tooltip:b._delete,handler:function(){m.getSelectionModel().hasSelection()&&Ext.MessageBox.confirm(b.delete_confirm_title,b.delete_confirm_msg,function(a){"yes"==a&&(a=m.getSelectionModel().getSelection()[0],a.hasChildNodes()?Ext.MessageBox.alert(b.errmsg,b.remove_node_before_delete):
(a.remove(),t(m.getRootNode(),!0),Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:g,action:"save",uid:p,connid:k.getValue(),treeArr:r},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=a.responseText.split("$"),2<=a.length){var e=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,e.msg,function(){iserror=!0;window.location=e.result})}}else a=Ext.JSON.decode(a.responseText),a.success[0].result?(m.setCusIcon(),Ext.MessageBox.alert(b.delete_result_title,
b.delete_success)):Ext.MessageBox.alert(b.delete_result_title,b.delete_fail)},failure:function(a,e){Ext.MessageBox.alert(b.errmsg,b.system_error)}})))})}},{xtype:"button",iconCls:"clearbutton_tree",tooltip:b.clear_user_folder_title,handler:function(){Ext.MessageBox.show({title:b.clear_user_folder_title,msg:b.clear_user_folder,width:300,buttons:Ext.MessageBox.OKCANCEL,fn:function(a,d){"ok"==a&&Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:g,action:"clean",uid:p,
connid:k.getValue()},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=a.responseText.split("$"),2<=a.length){var d=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,d.msg,function(){iserror=!0;window.location=d.result})}}else"undefined"!==typeof l&&null!=l&&(l.getRootNode().removeAll(),l.getProxy().extraParams.connid=k.getValue(),l.load()),a=Ext.JSON.decode(a.responseText),a.success[0].result?(m.rmCusIcon(),Ext.MessageBox.alert(b.clear_result_title,b.clear_success)):Ext.MessageBox.alert(b.clear_result_title,
b.clear_fail)},failure:function(a,d){Ext.MessageBox.alert(b.errmsg,b.system_error)}})}})}},{xtype:"button",iconCls:"collapseAllbutton_tree",tooltip:b.collapse,handler:function(){m.collapseAll()}},{xtype:"button",iconCls:"expandAllbutton_tree",tooltip:b.expand,handler:function(){m.expandAll()}},{xtype:"button",iconCls:"addfavoritebutton",tooltip:b.add_favorite,handler:function(){if(m.getSelectionModel().hasSelection()&&null!=h){var a=m.getSelectionModel().getSelection();if(null==h.getNodeById(a[0].data.id)){if(a[0].data.leaf){var d=
{id:a[0].data.id,leaf:a[0].data.leaf,parent:null,lang_key:a[0].data.lang_key,text:a[0].data.text,url:a[0].data.url,func_package:a[0].data.func_package};h.getRootNode().appendChild(d)}else Ext.MessageBox.alert(b.errmsg,b.not_program);d=0;null!=h.getRootNode()&&null!=h.getRootNode().childNodes&&(d=h.getRootNode().childNodes.length);Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:g,action:"addfavor",uid:p,connid:k.getValue(),treeArr:a[0].data.id+",,"+a[0].data.lang_key+
","+d+","+a[0].data.leaf}});n.setCusIcon()}else Ext.MessageBox.alert(b.errmsg,b.favor_exist)}}}],listeners:{itemclick:function(a,d,e,c,f,z){d.data.leaf&&("TreeLogout"==d.data.id?Ext.MessageBox.confirm(b.confirm_title,b.logout_confirm,function(a){"yes"==a&&(islogout=!0,logout(g))}):mainPanel.beforeAddCheck(d.data.id,k.getValue(),d.data,!1))},itemdblclick:function(a,b,e,c,f,z){},afteritemexpand:function(a,b,e,c){!a.isRoot()&&(existInArray(D,a.id)&&!a.hasChildNodes())&&(b=a.parentNode,null!=b&&b.removeChild(a))},
load:function(a,b,e,c,f){if(b.isRoot())try{this.expandAll()}catch(z){window.console&&console.log(z.message)}}},setCusIcon:function(){var a=this.getDockedItems('toolbar[dock="top"]')[0].items.get(4);null!=a&&a.getEl().setStyle({borderWidth:"2px 2px 2px 2px",borderColor:"red",boderStyle:"solid"})},rmCusIcon:function(){var a=this.getDockedItems('toolbar[dock="top"]')[0].items.get(4);null!=a&&a.getEl().setStyle({borderWidth:"1px 1px 1px 1px",borderColor:"",boderStyle:""})}}),h=Ext.create("Ext.data.TreeStore",
{model:"TreeModel",autoLoad:!1,proxy:{type:"ajax",url:"./../../Funcs/Main/Index.dsc",actionMethods:{read:"POST"},reader:{type:"json",root:"datas"},extraParams:{DCITag:g,action:"favor",uid:p,connid:""}},root:{text:b.func_tree_root,id:"FuncTreeRoot"}}),n=Ext.create("Ext.tree.Panel",{rootVisible:!0,viewConfig:{loadMask:!0,plugins:{ptype:"treeviewdragdrop",ddGroup:"ddgroup",sortOnDrop:!0,containerScroll:!0}},useArrows:!0,store:h,tbar:[{xtype:"button",iconCls:"savebutton_tree",tooltip:b.save,handler:function(){t(n.getRootNode(),
!0);null!=r&&""!=r&&Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:g,action:"savefavor",uid:p,connid:k.getValue(),treeArr:r},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=a.responseText.split("$"),2<=a.length){var d=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,d.msg,function(){iserror=!0;window.location=d.result})}}else a=Ext.JSON.decode(a.responseText),a.success[0].result?(n.setCusIcon(),Ext.MessageBox.alert(b.save_result_title,b.save_success)):
Ext.MessageBox.alert(b.save_result_title,b.save_fail)},failure:function(a,d){Ext.MessageBox.alert(b.errmsg,b.system_error)}})}},{xtype:"button",iconCls:"refreshbutton_tree",tooltip:b.refresh,handler:function(){if("undefined"!==typeof h&&null!=h){var a=allNodeLoaded(n,null);!h.isLoading()&&a&&(h.getRootNode().removeAll(),h.getProxy().extraParams.connid=k.getValue(),h.load())}}},{xtype:"button",iconCls:"addfolderbutton",tooltip:b.add,handler:function(){if(n.getSelectionModel().hasSelection()){var a=
n.getSelectionModel().getSelection(),d={id:(new Date).getTime(),leaf:!1};a[0].data.leaf?h.getNodeById(a[0].data.parent).appendChild(d):a[0].appendChild(d);h.getNodeById(d.id).data.lang_key="lang"+d.id;Ext.MessageBox.show({title:b.add_folder_title,msg:b.node_lang_panel,width:300,buttons:Ext.MessageBox.OKCANCEL,multiline:!0,fn:function(a,c){if("ok"==a){var f=h.getNodeById(d.id);f.set("text",c);t(n.getRootNode(),!0);Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:g,
action:"savelangfavor",uid:p,connid:k.getValue(),langkey:f.data.lang_key,langvalue:c,treeArr:r},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=a.responseText.split("$"),2<=a.length){var d=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,d.msg,function(){iserror=!0;window.location=d.result})}}else a=Ext.JSON.decode(a.responseText),a.success[0].result?Ext.MessageBox.alert(b.add_result_title,b.add_success):Ext.MessageBox.alert(b.add_result_title,b.add_fail)},failure:function(a,
d){Ext.MessageBox.alert(b.errmsg,b.system_error)}})}else f=h.getNodeById(d.id),f.remove()}})}else Ext.MessageBox.alert(b.errmsg,b.no_f_node_selected)}},{xtype:"button",iconCls:"deletebutton_tree",tooltip:b._delete,handler:function(){Ext.MessageBox.confirm(b.delete_confirm_title,b.delete_confirm_msg,function(a){"yes"==a&&n.getSelectionModel().hasSelection()&&(n.getSelectionModel().getSelection()[0].remove(),t(n.getRootNode(),!0),Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:g,
action:"savefavor",uid:p,connid:k.getValue(),treeArr:r},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=a.responseText.split("$"),2<=a.length){var e=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,e.msg,function(){iserror=!0;window.location=e.result})}}else a=Ext.JSON.decode(a.responseText),a.success[0].result?(n.setCusIcon(),Ext.MessageBox.alert(b.delete_result_title,b.delete_success)):Ext.MessageBox.alert(b.delete_result_title,b.delete_fail)},failure:function(a,e){Ext.MessageBox.alert(b.errmsg,
b.system_error)}}))})}},{xtype:"button",iconCls:"clearbutton_tree",tooltip:b.clear_favor_folder_title,handler:function(){Ext.MessageBox.show({title:b.clear_favor_folder_title,msg:b.clear_favor_folder,width:300,buttons:Ext.MessageBox.OKCANCEL,fn:function(a,d){"ok"==a&&Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:g,action:"cleanfavor",uid:p,connid:k.getValue()},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=a.responseText.split("$"),
2<=a.length){var d=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,d.msg,function(){iserror=!0;window.location=d.result})}}else"undefined"!==typeof h&&null!=h&&(h.getRootNode().removeAll(),h.getProxy().extraParams.connid=k.getValue(),h.load()),a=Ext.JSON.decode(a.responseText),a.success[0].result?(n.rmCusIcon(),Ext.MessageBox.alert(b.clear_result_title,b.clear_success)):Ext.MessageBox.alert(b.clear_result_title,b.clear_fail)},failure:function(a,d){Ext.MessageBox.alert(b.errmsg,b.system_error)}})}})}},
{xtype:"button",iconCls:"collapseAllbutton_tree",tooltip:b.collapse,handler:function(){n.collapseAll()}},{xtype:"button",iconCls:"expandAllbutton_tree",tooltip:b.expand,handler:function(){n.expandAll()}}],listeners:{itemclick:function(a,d,e,c,f,h){d.data.leaf&&("TreeLogout"==d.data.id?Ext.MessageBox.confirm(b.confirm_title,b.logout_confirm,function(a){"yes"==a&&(islogout=!0,logout(g))}):mainPanel.beforeAddCheck(d.data.id,k.getValue(),d.data,!1))},itemdblclick:function(a,b,e,c,f,g){},afteritemexpand:function(a,
b,e,c){!a.isRoot()&&(existInArray(D,a.id)&&!a.hasChildNodes())&&(b=a.parentNode,null!=b&&b.removeChild(a))},load:function(a,b,e,c,f){if(b.isRoot())try{this.expandAll()}catch(g){window.console&&console.log(g.message)}}},setCusIcon:function(){var a=this.getDockedItems('toolbar[dock="top"]')[0].items.get(4);null!=a&&a.getEl().setStyle({borderWidth:"2px 2px 2px 2px",borderColor:"red",boderStyle:"solid"})},rmCusIcon:function(){var a=this.getDockedItems('toolbar[dock="top"]')[0].items.get(4);null!=a&&a.getEl().setStyle({borderWidth:"1px 1px 1px 1px",
borderColor:"",boderStyle:""})}});mainPanel=Ext.create("Ext.tab.Panel",{region:"center",xtype:"tabpanel",deferredRender:!1,bodyStyle:{background:"#EEF5FC"},listeners:{tabchange:function(a,b,e,c){null!=b&&null!=e&&(a=Ext.getCmp(e.getId().substring(3)+"Main"),b=Ext.getCmp(b.getId().substring(3)+"Main"),null!=a&&"kanban"==a.pagetype&&a.leavePage(),null!=b&&b.focusPage())},resize:function(a,b,e,c,f,g){if(null!=a.getActiveTab()){f=c=null;for(g=0;g<a.items.length;g++)f=a.items.get(g),a.getActiveTab().getId()==
f.getId()&&(c=Ext.getCmp(f.getId().substring(3)+"Main"),null!=c&&c.resize(b-20,e-a.getTabBar().getHeight()-2)),c=Ext.get(f.getId().substring(3)+"Page"),null!=c&&(c.setWidth(b-20),c.setHeight(e-a.getTabBar().getHeight()-2))}}},beforeAddCheck:function(a,d,e,c){var f="",h=this,l="tab"+a,k=!1;null!=e&&(f=e.func_package);for(var m=0;m<h.items.length&&!k;m++)if(h.items.getAt(m).id==l){k=!0;break}"EKB"==f&&!k?Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:g,action:"kanbanCheck",
uid:p,func_id:a,connid:d},success:function(f){if(-1!=f.responseText.indexOf("@dcifiltererrtag@$")){if(f=f.responseText.split("$"),2<=f.length){var g=Ext.JSON.decode(f[1]);Ext.Msg.alert(b.errmsg,g.msg,function(){iserror=!0;window.location=g.result})}}else f=Ext.JSON.decode(f.responseText),"true"==f.result[0].success?h.addKanBanTab(a,d,e,c):Ext.Msg.alert(b.errmsg,b.kanban_not_exist)}}):h.addKanBanTab(a,d,e,c)},addKanBanTab:function(a,d,e,c){u.stopTask();var f=this,g="tab"+a,h=!1,k="",l="0",m="",q="";
null!=e&&(k=e.text,m=e.url,q=e.func_package,l=e.can_edit);for(var n=0;n<f.items.length&&!h;n++)if(f.items.getAt(n).id==g){h=!0;break}h||(functab=Ext.create("Ext.panel.Panel",{id:g,title:k,closable:!0,autoScroll:!0,tabPackage:q,bodyStyle:{background:"#eaf1fb"},loader:{url:m,scripts:!0,params:{forwardTag:s,func_id:a,func_name:k,conn_id:d,canEdit:l,filter:e.filter,uid:p},listeners:{exception:function(a,c,d,e){Ext.Msg.alert(b.errmsg,b.load_fail);f.remove(functab)},load:function(a,c,d,e){if(100>c.responseText.length&&
-1!=c.responseText.indexOf("@dcifiltererrtag@$")&&(a=c.responseText.split("$"),2<=a.length)){var g=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,g.msg,function(){iserror=!0;null!=g.result&&0<g.result.length?window.location=g.result:f.remove(functab)})}}}},listeners:{added:function(a){a.loader.load()},beforeclose:function(a,c){if(null!=a){var d=Ext.getCmp(a.id.substring(3)+"Main");if(null!=d){var e=!1;if(null!=d.items)for(var g=0;g<d.items.length&&!("function"==typeof d.items.get(g).getCurrMode&&(e=
d.items.get(g).getCurrMode()==PageMode.Edit||d.items.get(g).getCurrMode()==PageMode.Add));g++);e?Ext.MessageBox.confirm(b.confirm_title,b.data_lose_warning,function(b){"yes"==b&&(d.beforeClose(),f.remove(a))}):(d.beforeClose(),f.remove(a));return!1}}}}}),f.add(functab));h&&c&&(a=Ext.getCmp(a+"Main"),null!=a&&null!=e&&a.relationReload(e.filter));f.setActiveTab(g)}});var E=Ext.create("Ext.form.Label",{xtype:"label",text:"",margin:"0 0 0 5",x:90,y:5}),F=Ext.create("Ext.form.Label",{xtype:"label",text:"",
margin:"0 0 0 5",x:250,y:5}),G=Ext.create("Ext.form.Label",{xtype:"label",text:"",margin:"0 0 0 5",x:250,y:30}),H=Ext.create("Ext.form.Label",{xtype:"label",text:"",margin:"0 0 0 5",x:90,y:30}),A=Ext.create("Ext.panel.Panel",{region:"north",xtype:"panel",height:30,margins:"0 5 5 5",layout:"absolute",border:!1,split:!1,items:[{xtype:"label",text:b.conn_target,margin:"0 0 0 2",width:60,x:0,y:8},k,{xtype:"button",iconCls:"refreshbutton_tree",tooltip:b.refersh,x:188,y:5,handler:function(){var a=k.getValue();
Ext.create("Ext.data.Store",{autoLoad:!1,checkSession:!1,fields:["dblistvalue"],proxy:{type:"ajax",url:"./../../Funcs/Main/Index.dsc",actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{DCITag:g,uid:p,action:"dblist"}}}).load(function(b){y.loadData(b[0].get("dblistvalue"));k.setValue(a)})}}]}),B=Ext.create("Ext.panel.Panel",{title:b.functions,xtype:"panel",margins:"0 0 0 0",border:!1,split:!1,layout:"fit",items:[m],setCusIcon:function(){this.items.get(0).setCusIcon()}}),v=Ext.create("Ext.panel.Panel",
{xtype:"panel",title:b.favorties,margins:"0 0 0 0",border:!1,split:!1,layout:"fit",items:[n]}),v=Ext.create("Ext.panel.Panel",{region:"center",margins:"0 0 0 0",border:!1,split:!1,layout:{type:"accordion",titleCollapse:!1,animate:!0},items:[B,v]}),A=Ext.create("Ext.panel.Panel",{region:"west",stateId:"funcPanel",title:b.tree_panel_title,split:!0,splitterResize:!1,width:220,collapsible:!0,animCollapse:!1,layout:"border",border:!1,items:[A,v]}),v=Ext.create("Ext.panel.Panel",{region:"west",xtype:"panel",
layout:"absolute",margins:"0 0 0 0",width:400,bodyStyle:{background:"#EEF5FC"},border:!1,split:!1,items:[{xtype:"label",text:b.user_id,margin:"0 0 0 5",x:5,y:5},E,{xtype:"label",text:b.user_name,margin:"0 0 0 5",x:170,y:5},F,{xtype:"label",text:b.group_name,margin:"0 0 0 5",x:5,y:30},H,{xtype:"label",text:b.login_time,margin:"0 0 0 5",x:170,y:30},G]}),J=Ext.create("Ext.panel.Panel",{region:"center",xtype:"panel",layout:"absolute",margins:"0 0 0 0",bodyStyle:{background:"#EEF5FC"},border:!1,split:!1}),
x=Ext.create("Ext.panel.Panel",{region:"east",xtype:"panel",margins:"0 0 0 0",split:!1,layout:"absolute",border:!1,bodyStyle:{background:"#EEF5FC"},items:[{xtype:"button",cls:"starttimerbutton24",tooltip:b.kanban_loop,enableToggle:!0,x:10,y:10,width:35,height:35,handler:function(){var a=this;if(a.pressed){var d=mainPanel.getActiveTab();if(null==d)Ext.MessageBox.alert(b.errmsg,b.no_kanban_can_show),a.pressed=!1;else{var e=!1;Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:g,
uid:p,action:"pageTaskGap"},success:function(c){if(-1!=c.responseText.indexOf("@dcifiltererrtag@$")){if(c=c.responseText.split("$"),2<=c.length){var f=Ext.JSON.decode(c[1]);Ext.Msg.alert(b.errmsg,f.msg,function(){iserror=!0;window.location=f.result})}}else{c=Ext.JSON.decode(c.responseText);u.setTimeGap(c.result[0].gap);if(null!=d&&"EKB"==d.tabPackage)q=mainPanel.getActiveTab().id,c=Ext.getCmp(q.substring(3)+"Main"),c.globalTimerEvent(-1,u.getTimeGap()),e=!0;else for(c=0;c<mainPanel.items.length;c++)if("EKB"==
mainPanel.items.get(c).tabPackage){q=mainPanel.items.get(c).id;c=Ext.getCmp(q.substring(3)+"Main");c.globalTimerEvent(-1,u.getTimeGap());mainPanel.setActiveTab(q);e=!0;break}e?u.executeTask():(Ext.MessageBox.alert(b.errmsg,b.no_kanban_can_show),a.pressed=!1)}},failure:function(d,e){Ext.MessageBox.alert(b.errmsg,b.get_task_gap_fail);a.pressed=!1}})}}else u.stopTask()}},{xtype:"button",cls:"logoutbutton",tooltip:b.logout,x:50,y:10,width:35,height:35,handler:function(){Ext.MessageBox.confirm(b.confirm_title,
b.logout_confirm,function(a){"yes"==a&&(islogout=!0,logout(g))})}}],changeIcon:function(a){var b=this.items.get(0);(b.pressed=a)?(b.removeCls("starttimerbutton24"),b.addCls("stoptimerbutton24")):(b.removeCls("stoptimerbutton24"),b.addCls("starttimerbutton24"))}}),v=Ext.create("Ext.panel.Panel",{region:"north",xtype:"panel",header:!1,height:50,split:!0,splitterResize:!1,collapsible:!0,collapseMode:"mini",animCollapse:!1,margins:"0 0 0 0",layout:"border",bodyStyle:{background:"#EEF5FC"},items:[v,J,
x]}),C=Ext.create("Ext.panel.Panel",{region:"south",xtype:"panel",header:!1,height:40,iheight:40,split:!0,splitterResize:!1,collapsible:!0,collapseMode:"mini",animCollapse:!1,dataTask:null,scrollTask:null,collapseBySys:!1,collapseByUser:!1,showType:"1",bodyStyle:{background:"#EEF5FC"},syscollapse:function(){this.collapseBySys=!0;this.collapse(!0);this.collapseBySys=!1},sysexpand:function(){this.collapseByUser||this.expand(!0)},listeners:{collapse:function(a,b){a.collapseBySys||(a.collapseByUser=!0)},
expand:function(a,b){a.collapseByUser=!1}},startMarquee:function(a,b){function e(){null!=k&&k.load(function(a){if(null!=a&&0<a.length){var e="";c.sysexpand();if("1"==b){for(var f=0;f<a.length;f++)e=0==f?'<div style="font-size:22px;"><Marquee height="'+c.iheight+'" scrollamount="3" onmouseover="this.stop()" onmouseout="this.start()">'+a[f].get("message"):e+("                              "+a[f].get("message")),f==a.length-1&&(e+="</div></Marquee>");c.update(e)}else{null!=c.scrollTask&&(c.scrollTask.stop(),
c.body.dom.scrollTop=0);for(var g="",f=0;f<a.length;f++)0==f?(g='<div style="font-size:22px;text-align:center;overflow:hidden;height:'+c.iheight+'px;">'+a[f].get("message")+"</div>",e="<div>"+g):e+='<div  style="font-size:22px;text-align:center;overflow:hidden;height:'+c.iheight+'px;">'+a[f].get("message")+"</div>",f==a.length-1&&(e+=g+"</div>");c.update(e);null!=c.scrollTask&&c.scrollTask.start(5E3)}}else null!=c.scrollTask&&(c.scrollTask.stop(),c.body.dom.scrollTop=0),c.update("")})}var c=this,
f=new Ext.util.TaskRunner,h=null;c.syscollapse();var k=Ext.create("Ext.data.Store",{autoLoad:!1,fields:["message"],proxy:{type:"ajax",url:"./../../Funcs/Main/Index.dsc",actionMethods:{read:"POST"},reader:{root:"marquee"},extraParams:{DCITag:g,uid:p,action:"marqueeData"}}});k.getProxy().on("exception",function(a,b,c,d){if(-1!=b.responseText.indexOf("@dcifiltererrtag@")&&(a=b.responseText.split("$"),2<=a.length)){var e=Ext.JSON.decode(a[1]);null!=m&&m.stop();Ext.Msg.alert("error",e.msg,function(){iserror=
!0;window.location=e.result})}});var l=0;"2"==b?(null==h&&(h=f.newTask({run:function(){0<k.getCount()&&(0==l&&(c.body.dom.scrollTop=0),l==k.getCount()-1?l=0:l++,c.scrollBy(0,c.iheight,!0))}})),c.scrollTask=h,h.start(5E3)):c.scrollTask=null;var m=f.newTask({run:function(){e()}});this.dataTask=m;e();m.start(1E3*a)}});Ext.create("Ext.Viewport",{layout:"border",items:[A,v,mainPanel,C],listenres:[{disable:function(a,b){logout(g)}}]});I.load(function(a){if(1==a.length){u.setTimeGap(a[0].get("pageTimerGap")[0].gap);
y.loadData(a[0].get("dblistvalue"));w.loadData(a[0].get("userInfo"));if(0<y.getCount()&&"undefined"!=typeof k&&null!=k){var b=y.getAt(0).get("value");k.setValue(b);l.getRootNode().expand();h.getRootNode().expand()}0<w.getCount()&&(E.setText(" : "+w.getAt(0).get("uid")),F.setText(" : "+w.getAt(0).get("uname")),G.setText(" : "+w.getAt(0).get("ltime")),H.setText(" : "+w.getAt(0).get("gname")));null!=B&&"true"==a[0].get("hasfavor")[0].hasfavor.toLowerCase()&&B.collapse(!0);null!=m&&null!=n&&(b=a[0].get("hascus")[0],
"true"==b.hasdefcus.toLowerCase()&&m.setCusIcon(),"true"==b.hasfavcus.toLowerCase()&&n.setCusIcon());null!=C&&C.startMarquee(a[0].get("sysMarquee")[0].marquee_refresh_gap,a[0].get("sysMarquee")[0].marquee_type)}});var r=""}
function logout(g){Ext.Ajax.request({method:"POST",url:"./../../Login.dsc",params:{DCITag:g,uid:idxuid,action:"logout"},success:function(g){Ext.JSON.decode(g.responseText).success?window.location.href="./../../":Ext.MessageBox.alert(langs.errmsg,langs.logout_fail)},failure:function(g,b){Ext.MessageBox.alert(langs.errmsg,langs.logout_fail)}})}
function logoutF(g){if("Firefox"==navigator.userAgent.match("Firefox")){var s=new XMLHttpRequest;s&&(s.open("GET","/KanBan/Login.dsc?action=logout&uid="+idxuid+"&DCITag="+g,!1),s.send(""))}else"Microsoft Internet Explorer"==navigator.appName?window.navigate("./../../Login.dsc?action=logout&uid="+idxuid+"&DCITag="+g):Ext.Ajax.request({method:"POST",url:"./../../Login.dsc",params:{DCITag:g,uid:idxuid,action:"logout"}})};
