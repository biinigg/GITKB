var pagekey,globeuid;function createAJAX(){if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(q){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(l){return null}}else return window.XMLHttpRequest?new XMLHttpRequest:null}
function logout(q,l){if("Firefox"==navigator.userAgent.match("Firefox")){var f=new XMLHttpRequest;f&&(f.open("GET","/KanBan/Login.dsc?action=logout&uid="+l+"&DCITag="+q,!1),f.send(""))}else"Microsoft Internet Explorer"==navigator.appName?window.navigate("./../../Login.dsc?action=logout&uid="+l+"&DCITag="+q):Ext.Ajax.request({method:"POST",url:"./../../Login.dsc",params:{DCITag:q,uid:l,action:"logout"}})}
function updatePanelOpen(q,l,f,p,g){Ext.Ajax.request({method:"POST",url:"../../Funcs/EKB/KanBan.dsc",params:{DCITag:l,uid:f,action:"updatePanelOpen",params_value:g,sql_id:q.func_id},failure:function(f,g){Ext.Msg.alert(p.save_result_title,p.save_fail+" :</br>"+g.result.errorMessage)}})}function removeAllStyle(q){for(var l=0;null!=document.getElementById(q);){Ext.util.CSS.removeStyleSheet(q);if(10<=l)break;l++}}
function changeKanbanGrid(q,l,f){try{var p=null,g=null;"FS"==f?(p="font-size",g=q+"pt",Ext.util.CSS.updateRule("."+l+" .x-progress-text",p,q-2+"pt")):"FC"==f?(p="color",g="#"+q):"BC"==f?(p="background-color",g="#"+q):"RH"==f?(p="height",g=q+"px",Ext.util.CSS.updateRule("."+l+" .x-progress-default",p,q-8+"px"),Ext.util.CSS.updateRule("."+l+" .x-progress-text","line-height",q-8+"px")):"BcEven"==f&&(p="background-color",g="#"+q);null!=p&&("BcEven"!=f&&Ext.util.CSS.updateRule("."+l+" .x-grid-row .x-grid-cell",
p,g),"BC"!=f&&Ext.util.CSS.updateRule("."+l+" .x-grid-row-alt .x-grid-cell",p,g),"background-color"!=p&&"height"!=p&&Ext.util.CSS.updateRule("."+l+" .x-column-header",p,g))}catch(O){window.console&&console.log(O.message)}}
function filterComboData(q,l){var f=null;return f="NUM"==q||"DATE"==q?[{label:l.bigger,value:">"},{label:l.bigger_equal,value:">="},{label:l.smaller,value:"<"},{label:l.smaller_equal,value:"<="},{label:l.equal,value:"="},{label:l.not_equal,value:"<>"}]:"LIGHT"==q||"MAPPING"==q?[{label:l.equal,value:"="},{label:l.not_equal,value:"<>"}]:[{label:l.start_with,value:"startwith"},{label:l.end_with,value:"endwith"},{label:l.bigger,value:">"},{label:l.bigger_equal,value:">="},{label:l.smaller,value:"<"},
{label:l.smaller_equal,value:"<="},{label:l.equal,value:"="},{label:l.not_equal,value:"<>"},{label:l.like,value:"like"},{label:l.not_like,value:"notlike"}]}var test,ckbInfos={};
Ext.onReady(function(){function q(f,p,g,l){var q=!1,u=!1,G=!1,w=Ext.create("Ext.window.Window",{layout:"border",title:g.toolbar_query_title,closeAction:"hide",height:300,width:520,minHeight:300,minWidth:520,modal:!0,plain:!0,condiStr:"",kanbanStore:null,headPanel:null,lightsData:null,langObj:g,items:[{xtype:"panel",region:"north",layout:"anchor",border:0,height:70,items:[{xtype:"panel",layout:"absolute",anchor:"100% 50%",height:35,condiParams:{condi_col:"",condi_type:"",condi_value:"",dcondi_col:"",
dcondi_type:"",dcondi_value:""},items:[Ext.create("DCI.Customer.ComboBox",{fieldLabel:g.condi_col,store:{fields:["label","value","col_type","config_value"],autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}},labelWidth:90,width:250,x:0,y:5,listeners:{change:function(a,b,c,d){c=this.up("panel");var e=c.items.get(1),k=a.getStore();d=c.items.get(2);for(var h=null,f=null,n=null,l=0;l<k.getCount();l++)if(b==k.getAt(l).get("value")){h=k.getAt(l).get("col_type");n=k.getAt(l).get("config_value");break}if(null!=
h){e.getStore().loadData(filterComboData(h,g));e.loadDefault();if("DATE"==h)f=Ext.create("DCI.Customer.DateField",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",parentPanel:c,x:340,y:5,listeners:{change:function(a,b,c,e){a.parentPanel.condiParams.condi_value=Ext.Date.format(new Date(b),"Ymd");a.parentPanel.condiParams.dcondi_value=Ext.Date.format(new Date(b),"Y/m/d")}}});else if("MAPPING"==h||"LIGHT"==h){f=Ext.create("DCI.Customer.ComboBox",{fieldLabel:"",labelWidth:0,width:150,
name:"condi_value",defaultvalue:"",parentPanel:c,x:340,y:5,listeners:{change:function(a,b,c,e){a.parentPanel.condiParams.condi_value=b;a.parentPanel.condiParams.dcondi_value=a.getRawValue()}}});if("MAPPING"==h){e=[];n=n.split(";");k=null;for(l=0;l<n.length;l++)k=n[l].split("="),null!=k&&2==k.length&&e.push({value:k[0],label:k[1]});f.getStore().loadData(e)}else null!=c.up("panel").up("window").lightsData&&f.getStore().loadData(c.up("panel").up("window").lightsData);f.loadDefault()}else f=Ext.create("DCI.Customer.TextField",
{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",parentPanel:c,x:340,y:5,listeners:{change:function(a,b,c,e){a.parentPanel.condiParams.condi_value=b;a.parentPanel.condiParams.dcondi_value=b}}});c.remove(d.getId());c.insert(2,f)}c.condiParams.condi_col=b;c.condiParams.dcondi_col=a.getRawValue()}}}),Ext.create("DCI.Customer.ComboBox",{fieldLabel:"",labelWidth:0,width:90,x:250,y:5,listeners:{change:function(a,b,c,d){c=this.up("panel");c.condiParams.condi_type=b;c.condiParams.dcondi_type=
a.getRawValue()}}}),Ext.create("DCI.Customer.TextField",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",x:340,y:5})]},{xtype:"panel",anchor:"100% 50%",layout:"absolute",items:[{xtype:"radiogroup",fieldLabel:g.condi_relation,columns:2,vertical:!0,width:200,x:0,y:5,items:[{boxLabel:"AND",name:"rb",inputValue:"AND",checked:!0},{boxLabel:"OR",name:"rb",inputValue:"OR"}]},{xtype:"button",text:g.add,x:200,y:5,handler:function(){var a=this.up("panel"),b=a.up("panel").items.get(0),
c=a.up("panel").up("window").items.get(1).getStore(),a=a.items.get(0).getValue();null!=c&&c.add({condi_relation:a.rb,condi_col_display:b.condiParams.dcondi_col,condi_type_display:b.condiParams.dcondi_type,condi_value_display:b.condiParams.dcondi_value,condi_col:b.condiParams.condi_col,condi_type:b.condiParams.condi_type,condi_value:b.condiParams.condi_value})}},{xtype:"button",text:g._delete,x:250,y:5,handler:function(){var a=this.up("panel").up("panel").up("window").items.get(1);a.getSelectionModel().hasSelection()&&
a.getStore().remove(a.getSelectionModel().getSelection()[0])}},{xtype:"button",text:g.clear,x:300,y:5,handler:function(){var a=this.up("panel").up("panel").up("window").items.get(1).getStore();null!=a&&a.removeAll()}}]}]},{xtype:"grid",region:"center",renderer:"component",border:0,stripeRows:!0,autoScroll:!0,loadMask:!0,hideHeaders:!0,enableTextSelection:!0,viewConfig:{forceFit:!1,autoLoad:!1},columns:[{dataIndex:"condi_relation",width:50},{dataIndex:"condi_col_display",width:150},{text:g.conn_id,
dataIndex:"condi_type_display",width:100},{text:g.conn_id,dataIndex:"condi_value_display",width:200}],store:Ext.create("Ext.data.Store",{fields:"condi_relation condi_col_display condi_type_display condi_value_display condi_col condi_type condi_value".split(" "),autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}},syncCondiString:function(a){for(var b="",c=0;c<this.getCount();c++)b+=" "+this.getAt(c).get("condi_relation")+" "+this.getAt(c).get("condi_col")+" ",b="startwith"==this.getAt(c).get("condi_type")?
b+("like '"+this.getAt(c).get("condi_value")+"%' "):"endwith"==this.getAt(c).get("condi_type")?b+("like '%"+this.getAt(c).get("condi_value")+"' "):"like"==this.getAt(c).get("condi_type")?b+("like '%"+this.getAt(c).get("condi_value")+"%' "):"notlike"==this.getAt(c).get("condi_type")?b+("not like '%"+this.getAt(c).get("condi_value")+"%' "):b+(this.getAt(c).get("condi_type")+" '"+this.getAt(c).get("condi_value")+"' ");a.condiStr=b},listeners:{datachanged:function(a,b){var c=null;null!=y&&(c=y.items.get(4),
null!=c&&(0<a.getCount()?c.getEl().setStyle({borderWidth:"2px 2px 2px 2px",borderColor:"red",boderStyle:"solid"}):c.getEl().setStyle({borderWidth:"1px 1px 1px 1px",borderColor:"",boderStyle:""})))}}})}],buttons:[{xtype:"button",text:g.ok,handler:function(){var a=this.up("window"),b=a.items.get(1).getStore();null!=b&&(b.syncCondiString(a),null!=a.kanbanStore&&a.kanbanStore.gridreload(a.headPanel,a.condiStr,m.getStore(),""));a.close()}},{xtype:"button",text:g.cancel,handler:function(){this.up("window").close()}}],
setComboData:function(a,b){var c=this.items.get(0).items.get(0).items.get(0),d=c.getStore();null!=d&&(d.loadData(a),null==b||""==b?c.loadDefault():c.setValue(b))},setInitData:function(a,b,c,d){var e=this.items.get(0).items.get(0).items.get(0);null==c.filter_col||""==c.filter_col?e.loadDefault():e.setValue(c.filter_col);e=this.items.get(0).items.get(0).items.get(1);null==c.filter_condi||""==c.filter_condi?e.loadDefault():e.setValue(c.filter_condi);e=this.items.get(0).items.get(0).items.get(2);null==
c.filter_value||""==c.filter_value?e.loadDefault():e.setValue(c.filter_value);this.headPanel=a;this.kanbanStore=b;null!=d&&(this.items.get(1).getStore().loadData(d),this.items.get(1).getStore().syncCondiString(w));var k=this.items.get(0).items.get(0);d=k.items.get(0).getStore();e=k.items.get(1);a=k.items.get(2);var h=null;c=b=null;if(null!=d&&0<d.getCount()&&(h=d.getAt(0).get("col_type"),c=d.getAt(0).get("config_value"),null!=h)){e.getStore().loadData(filterComboData(h,g));e.loadDefault();if("DATE"==
h)b=Ext.create("DCI.Customer.DateField",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",parentPanel:k,x:340,y:5,listeners:{change:function(a,b,c,e){a.parentPanel.condiParams.condi_value=Ext.Date.format(new Date(b),"Ymd");a.parentPanel.condiParams.dcondi_value=Ext.Date.format(new Date(b),"Y/m/d")}}});else if("MAPPING"==h||"LIGHT"==h){b=Ext.create("DCI.Customer.ComboBox",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",parentPanel:k,x:340,y:5,listeners:{change:function(a,
b,c,e){a.parentPanel.condiParams.condi_value=b;a.parentPanel.condiParams.dcondi_value=k.items.get(2).getRawValue()}}});if("MAPPING"==h){d=[];c=c.split(";");e=null;for(h=0;h<c.length;h++)e=c[h].split("="),null!=e&&2==e.length&&d.push({value:e[0],label:e[1]});b.getStore().loadData(d)}else null!=this.lightsData&&b.getStore().loadData(this.lightsData);b.loadDefault();k.condiParams.condi_value=b.getValue();k.condiParams.dcondi_value=b.getRawValue()}else b=Ext.create("DCI.Customer.TextField",{fieldLabel:"",
labelWidth:0,width:150,name:"condi_value",defaultvalue:"",parentPanel:k,x:340,y:5,listeners:{change:function(a,b,c,e){a.parentPanel.condiParams.condi_value=b;a.parentPanel.condiParams.dcondi_value=b}}});k.remove(a.getId());k.insert(2,b)}},getCondiValue:function(){var a=[],b=this.items.get(1).getStore();if(null!=b)for(var c=0;c<b.getCount();c++)a.push({condi_relation:b.getAt(c).get("condi_relation"),condi_col:b.getAt(c).get("condi_col"),condi_type:b.getAt(c).get("condi_type"),condi_value:b.getAt(c).get("condi_value"),
condi_col_display:b.getAt(c).get("condi_col_display"),condi_type_display:b.getAt(c).get("condi_type_display"),condi_value_display:b.getAt(c).get("condi_value_display"),seq:c});return a}}),y=Ext.create("Ext.panel.Panel",{title:"",id:f.func_id+"-hp1",anchor:"100% 50%",layout:"absolute",border:0,bodyStyle:{background:"#d3e1f1"},bodyPadding:0,targetGrid:null,lightsData:null,condiParams:{condi_col:"",condi_type:"",condi_value:""},items:[Ext.create("DCI.Customer.ComboBox",{fieldLabel:g.condi_col,store:{fields:["label",
"value","col_type","config_value"],autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}},labelWidth:90,width:250,x:0,y:8,listeners:{change:function(a,b,c,d){c=this.up("panel");var e=c.items.get(1),k=a.getStore();a=c.items.get(2);for(var h=null,f=d=null,n=0;n<k.getCount();n++)if(b==k.getAt(n).get("value")){h=k.getAt(n).get("col_type");f=k.getAt(n).get("config_value");break}if(null!=h){e.getStore().loadData(filterComboData(h,g));e.loadDefault();if("DATE"==h)d=Ext.create("DCI.Customer.DateField",{fieldLabel:"",
labelWidth:0,width:150,name:"condi_value",defaultvalue:"",parentPanel:c,x:340,y:8,listeners:{change:function(a,b,c,e){a.parentPanel.condiParams.condi_value=Ext.Date.format(new Date(b),"Ymd")}}});else if("MAPPING"==h||"LIGHT"==h){d=Ext.create("DCI.Customer.ComboBox",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",parentPanel:c,x:340,y:8,listeners:{change:function(a,b,c,e){a.parentPanel.condiParams.condi_value=b}}});if("MAPPING"==h){e=[];f=f.split(";");k=null;for(n=0;n<f.length;n++)k=
f[n].split("="),null!=k&&2==k.length&&e.push({value:k[0],label:k[1]});d.getStore().loadData(e)}else null!=c.lightsData&&d.getStore().loadData(c.lightsData);d.loadDefault()}else d=Ext.create("DCI.Customer.TextField",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",parentPanel:c,x:340,y:8,listeners:{change:function(a,b,c,e){a.parentPanel.condiParams.condi_value=b}}});c.remove(a.getId());c.insert(2,d)}c.condiParams.condi_col=b}}}),Ext.create("DCI.Customer.ComboBox",{fieldLabel:"",
labelWidth:0,width:90,x:250,y:8,listeners:{change:function(a,b,c,d){this.up("panel").condiParams.condi_type=b}}}),Ext.create("DCI.Customer.TextField",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",x:340,y:8}),{xtype:"button",cls:"search-toolbar",tooltip:g.search,width:30,height:30,x:500,y:3,handler:function(){var a=this.up("panel"),b=Ext.getCmp(f.func_id+"-headgrid").getStore(),c=Ext.getCmp(f.func_id+"-bodygrid").getStore(),d=f.relation_filter="";null!=b.getAt(0)&&(d=f.condition+
"'"+b.getAt(0).get(f.combinecolumn)+"'");b.gridreload(a.up("panel"),w.condiStr,c,d)}},{xtype:"button",cls:"advsearchbutton",tooltip:g.adv_search,width:30,height:30,x:530,y:3,handler:function(){null!=w&&w.show()}},{xtype:"button",cls:"savebutton",tooltip:g.save_format,width:30,height:30,x:560,y:3,handler:function(){var a=this.up("panel"),b=this.up("panel").up("panel").items.get(1),c=this.up("panel").targetGrid.columns,d=[],e={},a=a.targetGrid;e.popup_width=null==a?200:a.getPopupWidth();for(var k in b.displayParams)e[k]=
b.displayParams[k];for(k=0;k<c.length;k++)a={},a.col_id=c[k].colid,a.col_index=c[k].getIndex(),a.col_width=c[k].width,a.col_visible=c[k].hidden?0:1,d.push(a);Ext.Ajax.request({method:"POST",url:"../../Funcs/EKB/KanBan.dsc",params:{DCITag:p,uid:l,action:"saveFormat",gridid:f.func_id,datas:Ext.encode(e),coldatas:'[{"col_id":"forCusIcon","col_index":0,"col_width":100,"col_visible":1}]'},success:function(a){b.setCss({grid_font_size:b.displayParams.fs,grid_font_color:b.displayParams.fc,grid_row_height:b.displayParams.rh,
grid_row_color:b.displayParams.bc,grid_row_even_color:b.displayParams.bcEven});Ext.Msg.alert(g.save_result_title,g.save_success)},failure:function(a,b){Ext.Msg.alert(g.save_result_title,g.save_fail+" :</br>"+b.result.errorMessage)}})}},{xtype:"button",cls:"backdefault_greenbutton",tooltip:g.load_def_format,width:30,height:30,x:590,y:3,handler:function(){var a=this.up("panel").up("panel").items.get(1);Ext.MessageBox.confirm(g.load_def_confirm_title,g.load_def_confirm_msg,function(b){"yes"==b&&Ext.Ajax.request({method:"POST",
url:"../../Funcs/EKB/KanBan.dsc",params:{DCITag:p,uid:l,action:"loadDefFormat",datas:"dodelete",gridid:f.func_id},success:function(b){a.setCss({grid_font_size:13,grid_font_color:"000000",grid_row_height:28,grid_row_color:null,grid_row_even_color:null});null!=s&&(s.rmCusFormatIcon(),s.setPopupWidth(200),null!=J&&0<J.getCount()&&J.load(function(a){s.reloadHeadGridFormat(a[0].get("cols"),A)}));null!=m&&(m.rmCusFormatIcon(),m.setPopupWidth(200),null!=K&&0<K.getCount()&&K.load(function(a){m.reloadBodyGridFormat(a[0].get("cols"),
B)}));Ext.Msg.alert(g.load_def_result_title,g.load_def_success)},failure:function(a,b){Ext.Msg.alert(g.load_def_result_title,g.load_def_fail+" :</br>"+b.result.errorMessage)}})})}},{xtype:"button",cls:"save-toolbar",tooltip:g.save_condi,width:30,height:30,x:620,y:3,handler:function(){var a=this.up("panel"),b=this.up("panel").up("panel").items.get(1),c={},d=null,e;for(e in a.condiParams)c[e]=a.condiParams[e];for(e in b.sortParams)c[e]=b.sortParams[e];if(null==c.condi_col||""==c.condi_col)c.condi_type=
"",c.condi_value="";if(null==c.sort_col||""==c.sort_col)c.sort_type="";null!=w&&null!=w.getCondiValue()&&0<w.getCondiValue().length&&(d=Ext.encode(w.getCondiValue()));Ext.Ajax.request({method:"POST",url:"../../Funcs/EKB/KanBan.dsc",params:{DCITag:p,uid:l,action:"saveCondi",sql_id:f.func_id,datas:Ext.encode(c),advDatas:d},success:function(b){f.relation_filter="";a.targetGrid.getStore().gridreload(a.up("panel"),w.condiStr);Ext.Msg.alert(g.save_result_title,g.save_success)},failure:function(a,b){Ext.Msg.alert(g.save_result_title,
g.save_fail+" :</br>"+b.result.errorMessage)}})}},{xtype:"button",cls:"backdefault_bluebutton",tooltip:g.load_def_condi,width:30,height:30,x:650,y:3,handler:function(){var a=this.up("panel").up("panel"),b=a.items.get(0),c=a.items.get(1);Ext.MessageBox.confirm(g.load_def_confirm_title,g.load_def_confirm_msg,function(d){"yes"==d&&Ext.Ajax.request({method:"POST",url:"../../Funcs/EKB/KanBan.dsc",params:{action:"loadDefCondi",uid:l,datas:"dodelete",DCITag:p,sql_id:f.func_id},success:function(e){e={filter_col:"",
filter_condi:"",filter_value:"",sort_col:"",sort_type:"",page_size:H};b.setInitData(e);if(null!=w){var d=w.items.get(1).getStore();null!=d&&d.removeAll()}c.setInitData(e);b.targetGrid.getStore().gridreload(a,"",m.getStore(),"");Ext.Msg.alert(g.load_def_result_title,g.load_def_success)},failure:function(a,b){Ext.Msg.alert(g.load_def_result_title,g.load_def_fail+" :</br>"+b.result.errorMessage)}})})}}],setComboData:function(a,b){var c=this.items.get(0),d=c.getStore();a.unshift({label:g.no_query,value:"",
col_type:"CHAR",config_value:""});null!=d&&(d.loadData(a),null==b||""==b?c.loadDefault():c.setValue(b));a.shift()},setInitData:function(a){var b=this.items.get(0);null==a.filter_col||""==a.filter_col?b.loadDefault():b.setValue(a.filter_col);b=this.items.get(1);null==a.filter_condi||""==a.filter_condi?b.loadDefault():b.setValue(a.filter_condi);b=this.items.get(2);null==a.filter_value||""==a.filter_value?b.loadDefault():b.setValue(a.filter_value);b=this.up("panel");null==a.op_is_open||0==a.op_is_open.length?
b.expand():"0"==a.op_is_open?b.collapse():b.expand()}}),I=f.head_kbid,t=f.func_id+"-"+I+"grid",A=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[],proxy:{async:!0,type:"ajax",timeout:3E5,url:"../../Funcs/EKB/KanBan.dsc",actionMethods:{read:"POST"},reader:{root:"items",totalProperty:"total"},extraParams:{DCITag:p,uid:l,action:"query",page:1,pagesize:1,filter:"",sort:"",sql_id:I,conn_id:f.conn_id}},pageSize:1,gridreload:function(a,b,c,d){var e=this,k=a.items.get(0);a=a.items.get(1);var h="",g="";if(null==
b||0==b.length){b=k.condiParams.condi_col;var n=k.condiParams.condi_type,l=k.condiParams.condi_value;null!=b&&""!=b&&(h=" and "+b+" ",h="startwith"==n?h+("like '"+l+"%' "):"endwith"==n?h+("like '%"+l+"' "):"like"==n?h+("like '%"+l+"%' "):"notlike"==n?h+("not like '%"+l+"%' "):h+(n+" '"+l+"' "))}else h=b;null!=a.sortParams.sort_col&&""!=a.sortParams.sort_col&&(g=a.sortParams.sort_col+" "+a.sortParams.sort_type);e.getProxy().extraParams.hasOwnProperty("page")&&(e.getProxy().extraParams.page=1,e.currentPage=
1);e.getProxy().extraParams.hasOwnProperty("pagesize")&&(e.getProxy().extraParams.pagesize=1,e.pageSize=1);e.getProxy().extraParams.hasOwnProperty("filter")&&(null!=f.relation_filter&&0<f.relation_filter.length?e.getProxy().extraParams.filter=f.relation_filter:e.getProxy().extraParams.filter=h);e.getProxy().extraParams.hasOwnProperty("sort")&&(e.getProxy().extraParams.sort=g);null!=k.targetGrid&&k.targetGrid.getSelectionModel().deselectAll();e.on("load",function(){null!=e.getAt(0)?(m.usePopup&&v.stop(),
d=f.condition+"'"+e.getAt(0).get(f.combinecolumn)+"'",void 0!=c&&(c.getProxy().extraParams.hasOwnProperty("filter")&&(null!=f.relation_filter&&0<f.relation_filter.length?c.getProxy().extraParams.filter=f.relation_filter:c.getProxy().extraParams.filter=d),c.load(function(){0==Ext.getCmp(f.func_id+"-bodygrid").getStore().totalCount?Ext.getCmp(f.func_id+"-bodygrid").dockedItems.get(3).showPopup("",""):Ext.getCmp(f.func_id+"-bodygrid").getSelectionModel().select(0);m.usePopup&&v.executeTask()}))):(c.getProxy().extraParams.filter=
" and "+f.combinecolumn+"='' ",c.load(function(){Ext.getCmp(f.func_id+"-bodygrid").dockedItems.get(3).showPopup("","")}))},this,{single:!0});e.load()}}),s=Ext.create("Ext.grid.Panel",{id:f.func_id+"-headgrid",renderer:"component",stripeRows:!0,autoScroll:!0,loadMask:!0,allowDeselect:!0,usePopup:!1,popupImgPath:"",popupImgCols:[],popupTitleCols:[],popup_refresh_gap:600,selModel:{allowDeselect:!0},enableTextSelection:!0,viewConfig:{forceFit:!1,autoLoad:!1},store:null,bodyCls:t,componentCls:t,columns:[],
sqlRelationStore:Ext.create("Ext.data.Store",{fields:["col_id","target_sql_id","target_col_id","target_ori_col_id","target_sql_name"],autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}}),currpage:0,totalpage:0,timer:null,dockedItems:[{xtype:"pagingtoolbar",store:null,dock:"top",displayInfo:!1,items:["-",{enableToggle:!0,width:50,tooltip:"",cls:"starttimerbutton",toggleHandler:function(a,b){this.btnClick(a,b)},btnClick:function(a,b){var c=this.up("panel").timer;null!=c&&(b?c.executeTask():c.stopTask())}},
"-",{xtype:"label",text:g.refresh_gap},{xtype:"label",text:"",margin:"0 0 0 10"},"-",Ext.create("DCI.Customer.Img",{src:"../../images/icons/CusGridFormat.png",width:20,height:20,hidden:!0,listeners:{afterrender:function(a){Ext.create("Ext.tip.ToolTip",{target:a.getEl(),html:g.cus_format})}}}),Ext.create("DCI.Customer.Img",{src:"../../images/button_icon/BtnCrossDatabase.png",width:20,height:20,hidden:!0,listeners:{afterrender:function(a){Ext.create("Ext.tip.ToolTip",{target:a.getEl(),html:g.cross_db})}}})],
listeners:{beforechange:function(a,b,c){var d=Ext.getCmp(f.func_id+"-bodygrid").getStore();this.store.getProxy().extraParams.hasOwnProperty("page")&&(null==b||0==b?this.store.getProxy().extraParams.page=1:this.store.getProxy().extraParams.page=b);this.store.on("load",function(){if(null!=this.store.getAt(0)){m.usePopup&&v.stop();var a=f.condition+"'"+this.store.getAt(0).get(f.combinecolumn)+"'";void 0!=d&&(d.getProxy().extraParams.hasOwnProperty("filter")&&(null!=f.relation_filter&&0<f.relation_filter.length?
d.getProxy().extraParams.filter=f.relation_filter:d.getProxy().extraParams.filter=a),d.load(function(){0==Ext.getCmp(f.func_id+"-bodygrid").getStore().totalCount?Ext.getCmp(f.func_id+"-bodygrid").dockedItems.get(3).showPopup("",""):Ext.getCmp(f.func_id+"-bodygrid").getSelectionModel().select(0);m.usePopup&&v.executeTask()}))}else Ext.getCmp(f.func_id+"-bodygrid").dockedItems.get(3).showPopup("","")},this,{single:!0});this.store.load()},change:function(a,b,c){null==b||null==b.currentPage||null==b.pageCount?
(this.up("panel").setCurrPage(0),this.up("panel").setTotlaPage(0)):(this.up("panel").setCurrPage(b.currentPage),this.up("panel").setTotlaPage(b.pageCount))}}}],listeners:{selectionchange:function(a,b,c){if(this.usePopup&&0<b.length){c=a="";for(var d=this.dockedItems.get(3),e=0;e<this.popupImgCols.length;e++)a=0==e?b[0].get(this.popupImgCols[e]):a+("--"+b[0].get(this.popupImgCols[e]));for(e=0;e<this.popupTitleCols.length;e++)c=0==e?b[0].get(this.popupTitleCols[e]):c+("--"+b[0].get(this.popupTitleCols[e]));
null!=d&&(b=this.popupImgPath.replace("\\",'"'),b=b.replace('"',"\\")+"\\",d.showPopup(c,b+a+".jpg"))}},celldblclick:function(a,b,c,d,e,k,h,f){},cellcontextmenu:function(a,b,c,d,e,k,h,g){if(null!=this.sqlRelationStore&&0<this.sqlRelationStore.getCount()){a=Ext.create("Ext.menu.Menu",{mpanel:M.parentComp,items:[],clickEvent:function(a,b,c){var e=this;null!=e.mpanel&&Ext.Ajax.request({method:"POST",url:"../../Funcs/EKB/KanBan.dsc",params:{action:"funcInfo",uid:l,DCITag:p,func_id:b,conn_id:f.conn_id},
success:function(d){null==d.responseText||""==d.responseText||0==d.responseText.length?alert("open kanban "+b+" fail"):(d=Ext.JSON.decode(d.responseText),e.mpanel.beforeAddCheck(b,f.conn_id,{url:d.url,text:d.text,func_package:d.func_package,can_edit:d.can_edit,filter:" and "+c+" = '"+a+"'"},!0))}})}});for(b=0;b<this.sqlRelationStore.getCount();b++)this.columns[c].dataIndex==this.sqlRelationStore.getAt(b).get("col_id")&&a.add({text:this.sqlRelationStore.getAt(b).get("target_sql_name"),currcol:this.sqlRelationStore.getAt(b).get("col_id"),
cellValue:d.get(this.columns[c].dataIndex),targetsql:this.sqlRelationStore.getAt(b).get("target_sql_id"),targetcol:this.sqlRelationStore.getAt(b).get("target_col_id"),targetoricol:this.sqlRelationStore.getAt(b).get("target_ori_col_id"),handler:function(){this.up("menu").clickEvent(this.cellValue,this.targetsql,this.targetoricol)}});0<a.items.length&&(h.stopEvent(),a.showAt(h.getXY()))}}},addCusFormatIcon:function(){this.dockedItems.items[1].items.get(17).show()},rmCusFormatIcon:function(){this.dockedItems.items[1].items.get(17).hide()},
setCrossDBIcon:function(a){var b=this.dockedItems.items[1];a?b.items.get(18).show():b.items.get(18).hide()},initHeadGrid:function(a,b,c,d){this.timer=a;var e=this,k=[];Ext.create("Ext.data.Store",{autoLoad:!1,fields:["colFormats"],proxy:{type:"ajax",url:"./../../PublicCtrl.dsc",actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{DCITag:p,uid:l,action:"getGFormat",gridid:I}}}).load(function(a){if(0<a.length){var g=Ext.create("Ext.data.Store",{fields:["col_id","col_index","col_width","col_visible"],
autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}});g.loadData(a[0].get("colFormats"));if(0<g.getCount()){Ext.getCmp(f.func_id+"-headgrid").addCusFormatIcon();for(a=0;a<g.getCount();a++)for(var n=0;n<b.length;n++)if(b[n].colid==g.getAt(a).get("col_id")){"1"==g.getAt(a).get("col_visible")?(b[n].hasOwnProperty("hidden"),b[n].hidden=!1,0!=g.getAt(a).get("col_width")&&(b[n].hasOwnProperty("width"),b[n].width=parseInt(g.getAt(a).get("col_width")))):(0!=g.getAt(a).get("col_width")&&(b[n].hasOwnProperty("width"),
b[n].width=parseInt(g.getAt(a).get("col_width"))),b[n].hasOwnProperty("hidden"),b[n].hidden=!0);k.push(b[n]);b.splice(n,1);break}if(null!=b&&0!=b.length)for(a=0;a<b.length;a++)b[a].hidden=!0,k.push(b[a])}else k=b;if(null!=d)for(n=0;n<k.length;n++)for(a=0;a<d.length;a++)if("col"+d[a].col_id==k[n].colid){k[n].hasOwnProperty("componentCls");k[n].componentCls="dci-realtion-column-header";break}e.reconfigure(c,k)}else{if(null!=d)for(n=0;n<b.length;n++)for(a=0;a<d.length;a++)if("col"+d[a].col_id==b[n].colid){b[n].hasOwnProperty("componentCls");
b[n].componentCls="dci-realtion-column-header";break}e.reconfigure(c,b)}e.child("pagingtoolbar").bindStore(A);null!=y&&(y.targetGrid=e)});e.sqlRelationStore.loadData(d)},reloadHeadGridFormat:function(a,b){var c=this,d=[];Ext.create("Ext.data.Store",{autoLoad:!1,fields:["colFormats"],proxy:{type:"ajax",url:"./../../PublicCtrl.dsc",actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{DCITag:p,uid:l,action:"getGFormat",gridid:I}}}).load(function(e){if(0<e.length){var k=Ext.create("Ext.data.Store",
{fields:["col_id","col_index","col_width","col_visible"],autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}});k.loadData(e[0].get("colFormats"));if(0<k.getCount()){Ext.getCmp(f.func_id+"-headgrid").addCusFormatIcon();for(e=0;e<k.getCount();e++)for(var h=0;h<a.length;h++)if(a[h].colid==k.getAt(e).get("col_id")){"1"==k.getAt(e).get("col_visible")?(a[h].hasOwnProperty("hidden"),a[h].hidden=!1,0!=k.getAt(e).get("col_width")&&(a[h].hasOwnProperty("width"),a[h].width=parseInt(k.getAt(e).get("col_width")))):
(0!=k.getAt(e).get("col_width")&&(a[h].hasOwnProperty("width"),a[h].width=parseInt(k.getAt(e).get("col_width"))),a[h].hasOwnProperty("hidden"),a[h].hidden=!0);d.push(a[h]);a.splice(h,1);break}if(null!=a&&0!=a.length)for(e=0;e<a.length;e++)a[e].hidden=!0,d.push(a[e])}else d=a;if(null!=c.sqlRelationStore)for(h=0;h<d.length;h++)for(e=0;e<c.sqlRelationStore.getCount();e++)if("col"+c.sqlRelationStore.getAt(e).data.col_id==d[h].colid){d[h].hasOwnProperty("componentCls");d[h].componentCls="dci-realtion-column-header";
break}c.reconfigure(b,d)}else{if(null!=c.sqlRelationStore)for(h=0;h<a.length;h++)for(e=0;e<c.sqlRelationStore.getCount();e++)if("col"+c.sqlRelationStore.getAt(e).data.col_id==a[h].colid){a[h].hasOwnProperty("componentCls");a[h].componentCls="dci-realtion-column-header";break}c.reconfigure(b,a)}c.child("pagingtoolbar").bindStore(A);null!=y&&(y.targetGrid=c)})},setCurrPage:function(a){this.currpage=a},setTotlaPage:function(a){this.totalpage=a},nextPage:function(){var a=0,b=this;null==b.currpage||0==
b.currpage?a=1:(a=b.currpage+1,a>b.totalpage&&(a=1));b.store.getProxy().extraParams.hasOwnProperty("page")&&(b.store.getProxy().extraParams.page=a,b.store.currentPage=a);var c=Ext.getCmp(f.func_id+"-bodygrid").getStore();b.store.load(function(d){b.getSelectionModel().deselectAll();b.setCurrPage(a);b.setRefreshTime();null!=b.store.getAt(0)?(m.usePopup&&v.stop(),d=f.condition+"'"+b.store.getAt(0).get(f.combinecolumn)+"'",void 0!=c&&(c.getProxy().extraParams.hasOwnProperty("filter")&&(null!=f.relation_filter&&
0<f.relation_filter.length?c.getProxy().extraParams.filter=f.relation_filter:c.getProxy().extraParams.filter=d),c.load(function(){0==Ext.getCmp(f.func_id+"-bodygrid").getStore().totalCount?Ext.getCmp(f.func_id+"-bodygrid").dockedItems.get(3).showPopup("",""):Ext.getCmp(f.func_id+"-bodygrid").getSelectionModel().select(0);m.usePopup&&v.executeTask()}))):Ext.getCmp(f.func_id+"-bodygrid").dockedItems.get(3).showPopup("","")})},globalNextPage:function(a){var b=0,c=this;if(-1==a)c.store.getProxy().extraParams.hasOwnProperty("page")&&
(c.store.getProxy().extraParams.page=1,c.store.currentPage=1),c.store.load(function(a){c.getSelectionModel().deselectAll();c.setCurrPage(1);c.setRefreshTime();c.usePopup&&(a=c.getSelectionModel(),null!=a&&a.select(0))});else if(b=c.currpage+1,b>c.totalpage&&(b=1),c.usePopup){var d=c.getSelectionModel();null!=d&&(a=0,null==d.lastSelected?d.select(0):d.lastSelected.index%c.getStore().pageSize==c.getStore().getCount()-1||null==d.getSelection()||0==d.getSelection().length?(c.store.getProxy().extraParams.hasOwnProperty("page")&&
(c.store.getProxy().extraParams.page=b,c.store.currentPage=b),c.store.load(function(a){d.deselectAll();c.setCurrPage(b);c.setRefreshTime();c.getSelectionModel().select(0)})):(a=(d.lastSelected.index+1)%c.getStore().pageSize,c.getSelectionModel().select(a)))}else c.store.getProxy().extraParams.hasOwnProperty("page")&&(c.store.getProxy().extraParams.page=b,c.store.currentPage=b),c.store.load(function(a){c.getSelectionModel().deselectAll();c.setCurrPage(b);c.setRefreshTime()})},nextSelectedRow:function(){var a=
this.getSelectionModel();if(null!=a){var b=0;null!=a.lastSelected&&(b=this.getSelectionModel().lastSelected.index%this.getStore().pageSize>=this.getStore().getCount()-1||null==a.getSelection()||0==a.getSelection().length?0:(this.getSelectionModel().lastSelected.index+1)%this.getStore().pageSize);a.select(b)}},setRefreshTimeTitle:function(a,b){var c=this.dockedItems.get(1).items.get(14);null!=c&&c.setText(g.refresh_gap+"  "+a+"  "+b)},setRefreshTime:function(){var a=this.dockedItems.get(1).items.get(15);
null!=a&&a.setText(Ext.Date.format(new Date(Ext.Date.now()),"Y/m/d H:i:s"))},setButtonStatus:function(a){var b=this.dockedItems.get(1).items.get(12);b.toggle(a);b.btnClick(b,a)},setPopupInfo:function(a){},getPopupWidth:function(){var a=this.dockedItems.get(3),b=200;null!=a&&(b=a.getWidth());return b},setPopupWidth:function(a){var b=this.dockedItems.get(3);null!=b&&b.setWidth(a)},changeIcon:function(a){var b=this.dockedItems.get(1).items.get(12);(b.pressed=a)?(b.removeCls("starttimerbutton"),b.addCls("stoptimerbutton"),
b.setTooltip(g.stop_timer)):(b.removeCls("stoptimerbutton"),b.addCls("starttimerbutton"),b.setTooltip(g.start_timer))}}),J=Ext.create("Ext.data.Store",{autoLoad:!1,fields:"cols fields legend marquee refresh display combo lights popup advances relation is_cross".split(" "),proxy:{type:"ajax",url:"../../Funcs/EKB/KanBan.dsc",actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{DCITag:p,uid:l,action:"init",sql_id:I}}}),H=9999,C=f.body_kbid,r=f.func_id+"-"+C+"grid";runner=new Ext.util.TaskRunner;
var B=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[],proxy:{type:"ajax",timeout:3E5,url:"../../Funcs/EKB/KanBan.dsc",actionMethods:{read:"POST"},reader:{root:"items",totalProperty:"total"},extraParams:{DCITag:p,uid:l,action:"query",page:1,pagesize:H,filter:"",sort:"",sql_id:C,conn_id:f.conn_id}},pageSize:H,gridreload:function(a,b){Ext.getCmp(f.func_id+"-hp1");var c=Ext.getCmp(f.func_id+"-hp2"),d="",d=b;this.getProxy().extraParams.hasOwnProperty("page")&&(this.currentPage=this.getProxy().extraParams.page=
1);this.getProxy().extraParams.hasOwnProperty("pagesize")&&(this.pageSize=this.getProxy().extraParams.pagesize=c.sortParams.page_size);this.getProxy().extraParams.hasOwnProperty("filter")&&(null!=f.relation_filter&&0<f.relation_filter.length?this.getProxy().extraParams.filter=f.relation_filter:this.getProxy().extraParams.filter=d);null!=m&&m.getSelectionModel().select(0)}});marqueepanel=Ext.create("Ext.panel.Panel",{region:"north",height:30,width:"100%",border:2,dock:"top",dataTask:null,scrollTask:null,
marqueeUrl:"../../Funcs/EKB/KanBan.dsc",html:"",startMarquee:function(a,b,c){function d(b){null!=h&&h.load(function(e){if(0<e.length){var d="";if("1"==c){for(var h=0;h<e.length;h++)d=0==h?'<div style="font-size:22px;"><Marquee height="'+a.height+'" scrollamount="3" onmouseover="this.stop()" onmouseout="this.start()">'+e[h].get("message"):d+("                              "+e[h].get("message")),h==e.length-1&&(d+="</div></Marquee>");a.update(d)}else{null!=a.scrollTask&&(a.scrollTask.stop(),a.body.dom.scrollTop=
0);for(var k="",h=0;h<e.length;h++)0==h?(k='<div style="font-size:22px;text-align:center;overflow:hidden;height:'+a.height+'px;">'+e[h].get("message")+"</div>",d="<div>"+k):d+='<div  style="font-size:22px;text-align:center;overflow:hidden;height:'+a.height+'px;">'+e[h].get("message")+"</div>",h==e.length-1&&(d+=k+"</div>");a.update(d);null!=a.scrollTask&&a.scrollTask.start(5E3)}b(a)}})}var e=new Ext.util.TaskRunner,k=null,h=Ext.create("Ext.data.Store",{autoLoad:!1,fields:["message"],proxy:{type:"ajax",
url:this.marqueeUrl,actionMethods:{read:"POST"},reader:{root:"marquee"},extraParams:{DCITag:p,uid:l,action:"marqueeData",sql_id:C,conn_id:f.conn_id}}}),g=e.newTask({run:function(){d(function(a){})}});this.dataTask=g;d(function(a){g.start(1E3*b);var d=0;"2"==c?(k=e.newTask({run:function(){0<h.getCount()&&(0==d&&(a.body.dom.scrollTop=0),d==h.getCount()-1?d=0:d++,a.scrollBy(0,a.height,!0))}}),a.scrollTask=k,k.start(5E3)):a.scrollTask=null})},stopScrollTask:function(){null!=this.dataTask&&this.dataTask.stop();
null!=this.scrollTask&&this.scrollTask.stop()},listeners:{el:{mouseover:function(a,b,c){null!=marqueepanel&&null!=marqueepanel.scrollTask&&marqueepanel.scrollTask.stop()}},body:{mouseout:function(a,b,c){null!=marqueepanel&&null!=marqueepanel.scrollTask&&marqueepanel.scrollTask.start(5E3)}}}});var v=runner.newTask({timegap:600,run:function(){null!=m&&m.nextSelectedRow()},setTimeGap:function(a){this.timegap=null==a||""==a||1>a?600:a},executeTask:function(){this.start(1E3*this.timegap);G=!0},stopTask:function(){this.stop();
G=!1}}),m=Ext.create("Ext.grid.Panel",{region:"center",renderer:"component",stripeRows:!0,autoScroll:!0,loadMask:!0,allowDeselect:!0,usePopup:!0,id:f.func_id+"-bodygrid",popupImgPath:"",popupImgCols:[],popupTitleCols:[],popup_refresh_gap:600,selModel:{allowDeselect:!0},enableTextSelection:!0,viewConfig:{forceFit:!1,autoLoad:!1},store:null,bodyCls:r,componentCls:r,columns:[],sqlRelationStore:Ext.create("Ext.data.Store",{fields:["col_id","target_sql_id","target_col_id","target_ori_col_id","target_sql_name"],
autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}}),currpage:0,totalpage:0,timer:null,dockedItems:[{xtype:"pagingtoolbar",store:null,dock:"bottom",displayInfo:!1,items:["-",{enableToggle:!0,width:50,tooltip:"",cls:"starttimerbutton",toggleHandler:function(a,b){this.btnClick(a,b)},btnClick:function(a,b){var c=this.up("panel").timer;null!=c&&(b?c.executeTask():c.stopTask())}},"-",{xtype:"label",text:g.refresh_gap},{xtype:"label",text:"",margin:"0 0 0 10"},"-",Ext.create("DCI.Customer.Img",{src:"../../images/icons/CusGridFormat.png",
width:20,height:20,hidden:!0,listeners:{afterrender:function(a){Ext.create("Ext.tip.ToolTip",{target:a.getEl(),html:g.cus_format})}}}),Ext.create("DCI.Customer.Img",{src:"../../images/button_icon/BtnCrossDatabase.png",width:20,height:20,hidden:!0,listeners:{afterrender:function(a){Ext.create("Ext.tip.ToolTip",{target:a.getEl(),html:g.cross_db})}}})],listeners:{beforechange:function(a,b,c){this.store.getProxy().extraParams.hasOwnProperty("page")&&(null==b||0==b?this.store.getProxy().extraParams.page=
1:this.store.getProxy().extraParams.page=b);this.store.load()},change:function(a,b,c){null==b||null==b.currentPage||null==b.pageCount?(this.up("panel").setCurrPage(0),this.up("panel").setTotlaPage(0)):(this.up("panel").setCurrPage(b.currentPage),this.up("panel").setTotlaPage(b.pageCount))}}},marqueepanel,{xtype:"panel",height:"100%",width:200,border:5,title:"",dock:"right",layout:"fit",collapsible:!0,collapseDirection:"right",animCollapse:!1,hidden:!1,buttonAlign:"left",resizable:!0,items:[{xtype:"panel",
height:"100%",title:"",width:"100%",border:0}],header:{items:[{xtype:"button",cls:"playbutton",pressedCls:"pausebutton",width:15,height:15,enableToggle:!0,handler:function(){null!=v&&(this.pressed?v.executeTask():v.stopTask())}}]},showPopup:function(a,b){var c=this.items.get(0),d=this.items.get(0);null!=d&&(null==a||""==a?d.setTitle(" "):d.setTitle(a),Ext.Ajax.request({method:"POST",url:"./../../PublicCtrl.dsc",params:{DCITag:p,uid:l,action:"B64Encode",str:b},success:function(a){a=Ext.JSON.decode(a.responseText);
a="<img width="+c.getWidth()+" height="+c.getHeight()+' src="./../../ImageLoader.dsc?imgpath='+a.result+'"/>';c.update(a)}}))}}],listeners:{selectionchange:function(a,b,c){if(this.usePopup&&0<b.length){c=a="";for(var d=this.dockedItems.get(3),e=0;e<this.popupImgCols.length;e++)a=0==e?b[0].get(this.popupImgCols[e]):a+("--"+b[0].get(this.popupImgCols[e]));for(e=0;e<this.popupTitleCols.length;e++)c=0==e?b[0].get(this.popupTitleCols[e]):c+("--"+b[0].get(this.popupTitleCols[e]));null!=d&&(b=this.popupImgPath.replace("\\",
'"'),b=b.replace('"',"\\")+"\\",d.showPopup(c,b+a+".jpg"))}},celldblclick:function(a,b,c,d,e,k,h,f){},cellcontextmenu:function(a,b,c,d,e,k,h,g){if(null!=this.sqlRelationStore&&0<this.sqlRelationStore.getCount()){a=Ext.create("Ext.menu.Menu",{mpanel:M.parentComp,items:[],clickEvent:function(a,b,c){var d=this;null!=d.mpanel&&Ext.Ajax.request({method:"POST",url:"../../Funcs/EKB/KanBan.dsc",params:{action:"funcInfo",uid:l,DCITag:p,func_id:C,conn_id:f.conn_id},success:function(e){null==e.responseText||
""==e.responseText||0==e.responseText.length?alert("open kanban "+b+" fail"):(e=Ext.JSON.decode(e.responseText),d.mpanel.beforeAddCheck(b,f.conn_id,{url:e.url,text:e.text,func_package:e.func_package,can_edit:e.can_edit,filter:" and "+c+" = '"+a+"'"},!0))}})}});for(b=0;b<this.sqlRelationStore.getCount();b++)this.columns[c].dataIndex==this.sqlRelationStore.getAt(b).get("col_id")&&a.add({text:this.sqlRelationStore.getAt(b).get("target_sql_name"),currcol:this.sqlRelationStore.getAt(b).get("col_id"),cellValue:d.get(this.columns[c].dataIndex),
targetsql:this.sqlRelationStore.getAt(b).get("target_sql_id"),targetcol:this.sqlRelationStore.getAt(b).get("target_col_id"),targetoricol:this.sqlRelationStore.getAt(b).get("target_ori_col_id"),handler:function(){this.up("menu").clickEvent(this.cellValue,this.targetsql,this.targetoricol)}});0<a.items.length&&(h.stopEvent(),a.showAt(h.getXY()))}}},addCusFormatIcon:function(){this.dockedItems.items[1].items.get(17).show()},rmCusFormatIcon:function(){this.dockedItems.items[1].items.get(17).hide()},setCrossDBIcon:function(a){var b=
this.dockedItems.items[1];a?b.items.get(18).show():b.items.get(18).hide()},initBodyGrid:function(a,b,c,d){this.timer=a;var e=this,k=[];Ext.create("Ext.data.Store",{autoLoad:!1,fields:["colFormats"],proxy:{type:"ajax",url:"./../../PublicCtrl.dsc",actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{DCITag:p,uid:l,action:"getGFormat",gridid:C}}}).load(function(a){if(0<a.length){var g=Ext.create("Ext.data.Store",{fields:["col_id","col_index","col_width","col_visible"],autoLoad:!1,proxy:{type:"memory",
reader:{type:"json"}}});g.loadData(a[0].get("colFormats"));if(0<g.getCount()){Ext.getCmp(f.func_id+"-bodygrid").addCusFormatIcon();for(a=0;a<g.getCount();a++)for(var l=0;l<b.length;l++)if(b[l].colid==g.getAt(a).get("col_id")){"1"==g.getAt(a).get("col_visible")?(b[l].hasOwnProperty("hidden"),b[l].hidden=!1,0!=g.getAt(a).get("col_width")&&(b[l].hasOwnProperty("width"),b[l].width=parseInt(g.getAt(a).get("col_width")))):(0!=g.getAt(a).get("col_width")&&(b[l].hasOwnProperty("width"),b[l].width=parseInt(g.getAt(a).get("col_width"))),
b[l].hasOwnProperty("hidden"),b[l].hidden=!0);k.push(b[l]);b.splice(l,1);break}if(null!=b&&0!=b.length)for(a=0;a<b.length;a++)b[a].hidden=!0,k.push(b[a])}else k=b;if(null!=d)for(l=0;l<k.length;l++)for(a=0;a<d.length;a++)if("col"+d[a].col_id==k[l].colid){k[l].hasOwnProperty("componentCls");k[l].componentCls="dci-realtion-column-header";break}e.reconfigure(c,k)}else{if(null!=d)for(l=0;l<b.length;l++)for(a=0;a<d.length;a++)if("col"+d[a].col_id==b[l].colid){b[l].hasOwnProperty("componentCls");b[l].componentCls=
"dci-realtion-column-header";break}e.reconfigure(c,b)}e.child("pagingtoolbar").bindStore(B)});e.sqlRelationStore.loadData(d)},reloadBodyGridFormat:function(a,b){var c=this,d=[];Ext.create("Ext.data.Store",{autoLoad:!1,fields:["colFormats"],proxy:{type:"ajax",url:"./../../PublicCtrl.dsc",actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{DCITag:p,uid:l,action:"getGFormat",gridid:C}}}).load(function(e){if(0<e.length){var k=Ext.create("Ext.data.Store",{fields:["col_id","col_index","col_width",
"col_visible"],autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}});k.loadData(e[0].get("colFormats"));if(0<k.getCount()){Ext.getCmp(f.func_id+"-bodygrid").addCusFormatIcon();for(e=0;e<k.getCount();e++)for(var h=0;h<a.length;h++)if(a[h].colid==k.getAt(e).get("col_id")){"1"==k.getAt(e).get("col_visible")?(a[h].hasOwnProperty("hidden"),a[h].hidden=!1,0!=k.getAt(e).get("col_width")&&(a[h].hasOwnProperty("width"),a[h].width=parseInt(k.getAt(e).get("col_width")))):(0!=k.getAt(e).get("col_width")&&
(a[h].hasOwnProperty("width"),a[h].width=parseInt(k.getAt(e).get("col_width"))),a[h].hasOwnProperty("hidden"),a[h].hidden=!0);d.push(a[h]);a.splice(h,1);break}if(null!=a&&0!=a.length)for(e=0;e<a.length;e++)a[e].hidden=!0,d.push(a[e])}else d=a;if(null!=c.sqlRelationStore)for(h=0;h<d.length;h++)for(e=0;e<c.sqlRelationStore.getCount();e++)if("col"+c.sqlRelationStore.getAt(e).data.col_id==d[h].colid){d[h].hasOwnProperty("componentCls");d[h].componentCls="dci-realtion-column-header";break}c.reconfigure(b,
d)}else{if(null!=c.sqlRelationStore)for(h=0;h<a.length;h++)for(e=0;e<c.sqlRelationStore.getCount();e++)if("col"+c.sqlRelationStore.getAt(e).data.col_id==a[h].colid){a[h].hasOwnProperty("componentCls");a[h].componentCls="dci-realtion-column-header";break}c.reconfigure(b,a)}c.child("pagingtoolbar").bindStore(B);null!=y&&(y.targetGrid=c)})},setCurrPage:function(a){this.currpage=a},setTotlaPage:function(a){this.totalpage=a},nextPage:function(){var a=0,b=this;null==b.currpage||0==b.currpage?a=1:(a=b.currpage+
1,a>b.totalpage&&(a=1));b.store.getProxy().extraParams.hasOwnProperty("page")&&(b.store.getProxy().extraParams.page=a,b.store.currentPage=a);b.store.load(function(c){b.getSelectionModel().deselectAll();b.setCurrPage(a);b.setRefreshTime()})},globalNextPage:function(a){var b=0,c=this;if(-1==a)c.store.getProxy().extraParams.hasOwnProperty("page")&&(c.store.getProxy().extraParams.page=1,c.store.currentPage=1),c.store.load(function(a){c.getSelectionModel().deselectAll();c.setCurrPage(1);c.setRefreshTime();
c.usePopup&&(a=c.getSelectionModel(),null!=a&&a.select(0))});else if(b=c.currpage+1,b>c.totalpage&&(b=1),c.usePopup){var d=c.getSelectionModel();null!=d&&(a=0,null==d.lastSelected?d.select(0):d.lastSelected.index%c.getStore().pageSize==c.getStore().getCount()-1||null==d.getSelection()||0==d.getSelection().length?(c.store.getProxy().extraParams.hasOwnProperty("page")&&(c.store.getProxy().extraParams.page=b,c.store.currentPage=b),c.store.load(function(a){d.deselectAll();c.setCurrPage(b);c.setRefreshTime();
c.getSelectionModel().select(0)})):(a=(d.lastSelected.index+1)%c.getStore().pageSize,c.getSelectionModel().select(a)))}else c.store.getProxy().extraParams.hasOwnProperty("page")&&(c.store.getProxy().extraParams.page=b,c.store.currentPage=b),c.store.load(function(a){c.getSelectionModel().deselectAll();c.setCurrPage(b);c.setRefreshTime()})},nextSelectedRow:function(){if(null!=this.getSelectionModel()){var a=this.store.getAt(0);null!=a&&(this.store.removeAt(0),this.store.insert(this.store.getCount(),
a),this.getSelectionModel().select(0))}},setRefreshTimeTitle:function(a,b){var c=this.dockedItems.get(1).items.get(14);null!=c&&c.setText(g.refresh_gap+"  "+a+"  "+b)},setRefreshTime:function(){var a=this.dockedItems.get(1).items.get(15);null!=a&&a.setText(Ext.Date.format(new Date(Ext.Date.now()),"Y/m/d H:i:s"))},setPopUpRefreshTime:function(){var a=this.dockedItems.get(1).items.get(15);null!=a&&a.setText(Ext.Date.format(new Date(Ext.Date.now()),"Y/m/d H:i:s"))},setButtonStatus:function(a){var b=
this.dockedItems.get(1).items.get(12);b.toggle(a);b.btnClick(b,a)},setPopupInfo:function(a){var b=this.dockedItems.get(3);null!=a&&(a.use_popup?(b.setVisible(!0),this.usePopup=a.use_popup,this.popupImgPath=a.popup_dir,this.popup_refresh_gap=a.popup_refresh_gap,null!=a.imgcols&&0<a.imgcols.trim().length&&(this.popupImgCols=a.imgcols.split(";")),null!=a.titlecols&&0<a.titlecols.trim().length&&(this.popupTitleCols=a.titlecols.split(";"))):(b.setVisible(!1),this.usePopup=!1,this.popupImgPath="",this.popupImgCols=
[],this.popupTitleCols=[],this.popup_refresh_gap=600));null!=v&&v.setTimeGap(this.popup_refresh_gap);this.usePopup&&(b.header.items.get(0).toggle(!0),b.header.items.get(0).handler())},getPopupWidth:function(){var a=this.dockedItems.get(3),b=200;null!=a&&(b=a.getWidth());return b},setPopupWidth:function(a){var b=this.dockedItems.get(3);null!=b&&b.setWidth(a)},changeIcon:function(a){var b=this.dockedItems.get(1).items.get(12);(b.pressed=a)?(b.removeCls("starttimerbutton"),b.addCls("stoptimerbutton"),
b.setTooltip(g.stop_timer)):(b.removeCls("stoptimerbutton"),b.addCls("starttimerbutton"),b.setTooltip(g.start_timer))}}),K=Ext.create("Ext.data.Store",{autoLoad:!1,fields:"cols fields legend marquee refresh display combo lights popup advances relation is_cross".split(" "),proxy:{type:"ajax",url:"../../Funcs/EKB/KanBan.dsc",actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{DCITag:p,uid:l,action:"init",sql_id:C}}}),E=Ext.create("Ext.panel.Panel",{lightsData:null,layout:"fit",anchor:"0 30%",
title:f.head_name,header:{height:35},items:[s],listeners:{}}),F=Ext.create("Ext.panel.Panel",{lightsData:null,layout:"fit",anchor:"0 70%",title:f.body_name,header:{height:35},items:[m],listeners:{}}),N=Ext.create("Ext.panel.Panel",{region:"center",layout:"anchor",autoScroll:!0,items:[E,F],listeners:{}}),D=Ext.create("Ext.panel.Panel",{title:"",id:f.func_id+"-hp2",anchor:"100% 50%",layout:"absolute",border:0,bodyStyle:{background:"#d3e1f1"},bodyPadding:0,sortParams:{sort_col:"",sort_type:"",page_size:H},
displayParams:{fs:13,fc:"000000",rh:28,bc:"FFFFFF",bcEven:"CCE4F6"},bodygrid:null,headgrid:null,items:[Ext.create("DCI.Customer.ComboBox",{fieldLabel:g.sort_column,name:"sort_column",labelWidth:90,width:250,x:0,y:8,listeners:{change:function(a,b,c,d){this.up("panel").sortParams.sort_col=b}}}),Ext.create("DCI.Customer.ComboBox",{fieldLabel:"",labelWidth:0,width:90,store:{fields:["label","value"],data:[{label:g.asc,value:"asc"},{label:g.desc,value:"desc"}]},x:250,y:8,listeners:{change:function(a,b,
c,d){this.up("panel").sortParams.sort_type=b}}}),Ext.create("DCI.Customer.NumberBox",{fieldLabel:g.page_size,labelWidth:60,defaultvalue:H,maxValue:9999,minValue:1,disabled:!0,width:150,x:340,y:8,listeners:{change:function(a,b,c,d){this.up("panel").sortParams.page_size=b}}}),{xtype:"button",cls:"configbutton",tooltip:g.favorties_setup,x:500,y:5,width:30,height:30,handler:function(){var a=this.up("panel").displayParams;Ext.create("Ext.window.Window",{title:g.favorties_setup,width:500,height:300,minWidth:300,
minHeight:200,layout:"fit",plain:!0,modal:!0,items:[{xtype:"panel",layout:"anchor",items:[{xtype:"slider",anchor:"80% 25%",fieldLabel:g.font_size,border:1,value:a.fs,minValue:8,maxValue:48,increment:1,plugins:new Ext.slider.Tip,listeners:{change:function(b,c,d,e){changeKanbanGrid(c,r,"FS");if(null!=m&&0<m.columns.length)try{var k=m.columns[0].width;m.columns[0].setWidth(k+10);m.columns[0].setWidth(k)}catch(h){window.console&&console.log(h.message)}changeKanbanGrid(c,t,"FS");if(null!=s&&0<s.columns.length)try{k=
s.columns[0].width,s.columns[0].setWidth(k+10),s.columns[0].setWidth(k)}catch(g){window.console&&console.log(g.message)}a.fs=c},afterrender:function(a,c){this.labelCell.dom.attributes.getNamedItem("valign").value="middle"}}},{xtype:"dcicolorpicker",fieldLabel:g.font_color,defaultColor:"000000",curColor:a.fc,width:180,listeners:{change:function(b,c,d,e){changeKanbanGrid(c,r,"FC");changeKanbanGrid(c,t,"FC");a.fc=c}}},{xtype:"slider",anchor:"80% 25%",fieldLabel:g.row_height,value:a.rh,minValue:16,maxValue:100,
increment:4,plugins:new Ext.slider.Tip,listeners:{change:function(b,c,d,e){changeKanbanGrid(c,r,"RH");changeKanbanGrid(c,t,"RH");a.rh=c},afterrender:function(a,c){this.labelCell.dom.attributes.getNamedItem("valign").value="middle"}}},{bodyStyle:"border:0 ;",items:[{layout:"column",bodyStyle:"border:0 ;",items:[{columnWidth:0.4,bodyStyle:"border:0;",items:[{xtype:"dcicolorpicker",fieldLabel:g.bg_color,defaultColor:"FFFFFF",curColor:a.bc,width:180,listeners:{change:function(b,c,d,e){changeKanbanGrid(c,
r,"BC");changeKanbanGrid(c,t,"BC");a.bc=c}}}]},{columnWidth:0.5,bodyStyle:"border:0;",items:[{xtype:"dcicolorpicker",defaultColor:"CCE4F6",curColor:a.bcEven,width:70,listeners:{change:function(b,c,d,e){changeKanbanGrid(c,r,"BcEven");changeKanbanGrid(c,t,"BcEven");a.bcEven=c}}}]}]}]}]}],buttons:[{text:g.close,handler:function(){this.up(".window").close()}}]}).show()}}],setComboData:function(a){var b=this.items.get(0),c=b.getStore();a.unshift({label:g.no_sort,value:""});null!=c&&(c.loadData(a),b.loadDefault());
a.shift()},setCss:function(a){var b="",c="",d="";removeAllStyle(t);null!=a.grid_font_size&&""!=a.grid_font_size?(b+="font-size:"+a.grid_font_size+"pt;",d+="font-size:"+a.grid_font_size+"pt;",c+="font-size:"+a.grid_font_size+"pt;",this.displayParams.fs=a.grid_font_size,Ext.util.CSS.createStyleSheet("."+t+" .x-progress-text {font-size:"+(a.grid_font_size-2)+"pt;}",t)):(b+="font-size:13pt;",d+="font-size:13pt;",c+="font-size:13pt;",this.displayParams.fs="13",Ext.util.CSS.createStyleSheet("."+t+" .x-progress-text {font-size:11pt}",
t));null!=a.grid_font_color&&""!=a.grid_font_color?(b+="color:#"+a.grid_font_color+";",d+="color:#"+a.grid_font_color+";",c+="color:#"+a.grid_font_color+";",this.displayParams.fc=a.grid_font_color):(b+="color:black;",d+="color:black;",c+="color:black;",this.displayParams.fc="000000");null!=a.grid_row_height&&""!=a.grid_row_height?(b+="height:"+a.grid_row_height+"px;",d+="height:"+a.grid_row_height+"px;",this.displayParams.rh=a.grid_row_height,Ext.util.CSS.createStyleSheet("."+t+" .x-progress-default {height:"+
(a.grid_row_height-8)+"px;}",t),Ext.util.CSS.createStyleSheet("."+t+" .x-progress-text {line-height:"+(a.grid_row_height-8)+"px;}",t)):(b+="height:28px;",d+="height:28px;",this.displayParams.rh="28",Ext.util.CSS.createStyleSheet("."+t+" .x-progress-default {height:20px;}",t),Ext.util.CSS.createStyleSheet("."+t+" .x-progress-text {line-height:20px;}",t));null!=a.grid_row_color&&""!=a.grid_row_color?(b+="background-color:#"+a.grid_row_color+";",this.displayParams.bc=a.grid_row_color):(b+="background-color:withe;",
this.displayParams.bc="FFFFFF");null!=a.grid_row_even_color&&""!=a.grid_row_even_color?(d+="background-color:#"+a.grid_row_even_color+";",this.displayParams.bcEven=a.grid_row_even_color):(d+="background-color:#cce4f6;",this.displayParams.bcEven="cce4f6");Ext.util.CSS.createStyleSheet("."+t+" .x-grid-row .x-grid-cell {"+b+"}",t);Ext.util.CSS.createStyleSheet("."+t+" .x-grid-row-alt .x-grid-cell {"+d+"}",t);Ext.util.CSS.createStyleSheet("."+t+" .x-column-header {"+c+"}",t);removeAllStyle(r);null!=a.grid_font_size&&
""!=a.grid_font_size?(b+="font-size:"+a.grid_font_size+"pt;",d+="font-size:"+a.grid_font_size+"pt;",c+="font-size:"+a.grid_font_size+"pt;",this.displayParams.fs=a.grid_font_size,Ext.util.CSS.createStyleSheet("."+r+" .x-progress-text {font-size:"+(a.grid_font_size-2)+"pt;}",r)):(b+="font-size:13pt;",d+="font-size:13pt;",c+="font-size:13pt;",this.displayParams.fs="13",Ext.util.CSS.createStyleSheet("."+r+" .x-progress-text {font-size:11pt}",r));null!=a.grid_font_color&&""!=a.grid_font_color?(b+="color:#"+
a.grid_font_color+";",d+="color:#"+a.grid_font_color+";",c+="color:#"+a.grid_font_color+";",this.displayParams.fc=a.grid_font_color):(b+="color:black;",d+="color:black;",c+="color:black;",this.displayParams.fc="000000");null!=a.grid_row_height&&""!=a.grid_row_height?(b+="height:"+a.grid_row_height+"px;",d+="height:"+a.grid_row_height+"px;",this.displayParams.rh=a.grid_row_height,Ext.util.CSS.createStyleSheet("."+r+" .x-progress-default {height:"+(a.grid_row_height-8)+"px;}",r),Ext.util.CSS.createStyleSheet("."+
r+" .x-progress-text {line-height:"+(a.grid_row_height-8)+"px;}",r)):(b+="height:28px;",d+="height:28px;",this.displayParams.rh="28",Ext.util.CSS.createStyleSheet("."+r+" .x-progress-default {height:20px;}",r),Ext.util.CSS.createStyleSheet("."+r+" .x-progress-text {line-height:20px;}",r));null!=a.grid_row_color&&""!=a.grid_row_color?(b+="background-color:#"+a.grid_row_color+";",this.displayParams.bc=a.grid_row_color):(b+="background-color:withe;",this.displayParams.bc="FFFFFF");null!=a.grid_row_even_color&&
""!=a.grid_row_even_color?(d+="background-color:#"+a.grid_row_even_color+";",this.displayParams.bcEven=a.grid_row_even_color):(d+="background-color:#cce4f6;",this.displayParams.bcEven="cce4f6");Ext.util.CSS.createStyleSheet("."+r+" .x-grid-row .x-grid-cell {"+b+"}",r);Ext.util.CSS.createStyleSheet("."+r+" .x-grid-row-alt .x-grid-cell {"+d+"}",r);Ext.util.CSS.createStyleSheet("."+r+" .x-column-header {"+c+"}",r)},setInitData:function(a,b){var c=this.items.get(0);null==a.sort_col||""==a.sort_col?c.loadDefault():
c.setValue(a.sort_col);c=this.items.get(1);null==a.sort_type||""==a.sort_type?c.loadDefault():c.setValue(a.sort_type);c=this.items.get(2);null!=a.page_size&&""!=a.page_size?c.setValue(a.page_size):c.loadDefault();this.bodygrid=b}}),L=Ext.create("Ext.panel.Panel",{region:"north",height:120,collapsible:!0,title:f.func_name,header:{height:35},layout:"anchor",items:[y,D],listeners:{collapse:function(){updatePanelOpen(f,p,l,g,"0")},expand:function(){updatePanelOpen(f,p,l,g,"1")}}}),z=runner.newTask({timegap:600,
displaygap:30,run:function(){null!=s&&s.nextPage()},setTimeGap:function(a){this.timegap=null==a||""==a||1>a?600:a},getTimeGap:function(){return this.timegap},setDisplayGap:function(a){this.displaygap=null==a||""==a||1>a?600:a},getDisplayGap:function(){return this.displaygap},executeTask:function(){this.start(1E3*this.timegap);u=!0;null!=s&&s.changeIcon(!0)},stopTask:function(){this.stop();u=!1;null!=s&&s.changeIcon(!1)}}),x=runner.newTask({timegap:600,displaygap:30,run:function(){null!=m&&m.nextPage()},
setTimeGap:function(a){this.timegap=null==a||""==a||1>a?600:a},getTimeGap:function(){return this.timegap},setDisplayGap:function(a){this.displaygap=null==a||""==a||1>a?600:a},getDisplayGap:function(){return this.displaygap},executeTask:function(){this.start(1E3*this.timegap);q=!0;null!=m&&m.changeIcon(!0)},stopTask:function(){this.stop();q=!1;null!=m&&m.changeIcon(!1)}}),M=Ext.create("DCI.Customer.SubPanel",{id:f.func_id+"Main",renderTo:"indkbPage",autoDestroy:!0,pagetype:"kanban",border:0,bodyPadding:"0 5 5 5",
layout:"border",widthChangeControls:[L,N],items:[L,N],globalRunning:!1,plugins:["fittoparent"],beforeClose:function(){null!=marqueepanel&&marqueepanel.stopScrollTask();null!=x&&x.stopTask();null!=z&&z.stopTask();null!=v&&v.stopTask();removeAllStyle(r)},focusPage:function(){this.globalRunning||(q&&x.executeTask(),u&&z.executeTask(),G&&v.executeTask(),null!=Ext.get(this.renderTo)&&this.resize(Ext.get(this.renderTo).getWidth(),Ext.get(this.renderTo).getHeight()),null!=m&&m.setRefreshTimeTitle(x.getDisplayGap(),
g.minutes),null!=s&&s.setRefreshTimeTitle(z.getDisplayGap(),g.minutes))},leavePage:function(){q&&x.stop();u&&z.stop();G&&v.stop()},globalTimerEvent:function(a,b){null!=x&&(x.stop(),null!=m&&m.changeIcon(!1));null!=v&&v.stop();null!=m&&(m.setRefreshTimeTitle(b,g.seconds),m.globalNextPage(a));this.globalRunning=!0;return m.currpage},globalTimerStop:function(){this.globalRunning=!1;q&&x.executeTask();u&&z.executeTask();G&&(Ext.getCmp(f.func_id+"-bodygrid").getSelectionModel().select(0),v.executeTask());
null!=m&&m.setRefreshTimeTitle(x.getDisplayGap(),g.minutes)},switchToNextTab:function(){var a=!1;if(m.currpage==m.totalpage)if(m.usePopup){var b=m.getSelectionModel();null!=b&&null!=b.lastSelected&&b.lastSelected.index%m.getStore().pageSize>=m.getStore().getCount()-1&&(a=!0)}else a=!0;else a=!1;return a},relationReload:function(a){f.relation_filter=a;this.items.get(1).getStore().gridreload(this.items.get(0),"reload")}});Ext.create("Ext.data.Store",{autoLoad:!1,fields:["headDisplay","headAdvances",
"bodyDisplay"],proxy:{type:"ajax",url:"../../CUS/Funcs/EKB/SubKanBan02420302.dsc",actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{DCITag:p,uid:l,action:"initFirst",sql_id:f.func_id}}}).load(function(a){0<a.length&&J.load(function(b){if(0<b.length){if(null!=A){for(var c=b[0].get("fields"),d=0;d<c.length;d++)""==c[d].sortType&&(c[d].sortType=function(a){a=parseFloat(String(a).replace(/,/g,"").replace("$",""));return isNaN(a)?0:a});A.model.setFields(c);null!=s&&(s.setCrossDBIcon(b[0].get("is_cross")),
s.initHeadGrid(z,b[0].get("cols"),A,b[0].get("relation")),s.setPopupInfo(b[0].get("popup")));null!=z&&(c=b[0].get("refresh"),z.setTimeGap(c.refresh_gap),z.setDisplayGap(c.display_gap),s.setRefreshTimeTitle(c.display_gap,g.minutes),"1"==c.auto_refresh&&z.executeTask(),s.setButtonStatus("1"==c.auto_refresh));null!=E&&(E.lightsData=b[0].get("lights"));null!=y&&null!=D&&(c=a[0].get("headDisplay"),D.setCss(c),y.setComboData(b[0].get("combo")),D.setComboData(b[0].get("combo")),y.setInitData(c),D.setInitData(c,
s),s.setPopupWidth(c.popup_width));null!=w&&(w.setComboData(b[0].get("combo")),w.lightsData=b[0].get("lights"),w.setInitData(L,A,w,a[0].get("headAdvances")));A.gridreload(L,w.condiStr,B,"")}null!=E&&(c=b[0].get("legend"),null==c||0==c.length?E.setTitle("<table><tr><td><font size='2'>"+f.head_name+"</font></td></tr></table>"):E.setTitle(b[0].get("legend").replace("$$$kn$$$",f.head_name)))}K.load(function(b){if(0<b.length){if(null!=B){for(var c=b[0].get("fields"),d=0;d<c.length;d++)""==c[d].sortType&&
(c[d].sortType=function(a){a=parseFloat(String(a).replace(/,/g,"").replace("$",""));return isNaN(a)?0:a});B.model.setFields(c);null!=m&&(m.setCrossDBIcon(b[0].get("is_cross")),m.initBodyGrid(x,b[0].get("cols"),B,b[0].get("relation")),m.setPopupInfo(b[0].get("popup")));null!=marqueepanel&&(c=b[0].get("marquee"),1==c.use_marquee?("1"==c.marquee_location?marqueepanel.setDocked("bottom"):marqueepanel.setDocked("top"),m.doLayout(),marqueepanel.startMarquee(marqueepanel,c.marquee_refresh_gap,c.marquee_type)):
marqueepanel.setVisible(!1));null!=x&&(c=b[0].get("refresh"),x.setTimeGap(c.refresh_gap),x.setDisplayGap(c.display_gap),m.setRefreshTimeTitle(c.display_gap,g.minutes),"1"==c.auto_refresh&&x.executeTask(),m.setButtonStatus("1"==c.auto_refresh));null!=F&&(F.lightsData=b[0].get("lights"));null!=y&&null!=D&&(c=a[0].get("bodyDisplay"),D.setCss(c),m.setPopupWidth(c.popup_width))}null!=F&&(c=b[0].get("legend"),null==c||0==c.length?F.setTitle("<table><tr><td><font size='2'>"+f.body_name+"</font></td></tr></table>"):
F.setTitle(b[0].get("legend").replace("$$$kn$$$",f.body_name)))}})})})}var l="close search save add _delete edit exit errmsg save_format to_edit to_view mode_view mode_edit no_edit_auth expand collapse refersh clear system_error ok cancel toolbar_query_title condi_col save_msg load_def_fail load_def_success load_def_result_title load_def_confirm_title load_def_confirm_msg save_fail save_success save_result_title save_fail sort_column page_size no_query no_sort asc desc refresh_gap minutes favorties_setup start_with end_with bigger bigger_equal smaller smaller_equal equal not_equal like not_like font_size row_height bg_color font_color condi_relation adv_search save_condi load_def_format load_def_condi to_excel to_html start_timer stop_timer seconds cus_format cross_db".split(" ");
this.dcistore.setMultiLangKeys(l);this.dcistore.setUid(globeuid);this.dcistore.load(function(f){if(null!=f&&1==f.length){var p=buildMultiLangObjct(l,f[0].get("langValues")),g=f[0].get("dcitagValue");Ext.EventManager.on(window,"unload",function(){"Microsoft Internet Explorer"==navigator.appName?window.navigate("./../../Login.dsc?action=logout&uid="+globeuid+"&DCITag="+g):Ext.Ajax.request({method:"POST",url:"./../../Login.dsc",params:{DCITag:g,uid:globeuid,action:"logout"}})});Ext.Ajax.request({method:"POST",
url:"./../../EKB/OpenLink/IndKanBan.dsc",params:{DCITag:g,uid:globeuid,action:"getparams",pagekey:pagekey},success:function(f){if(-1!=f.responseText.indexOf("@dcifiltererrtag@$")){if(f=f.responseText.split("$"),2<=f.length){var l=Ext.JSON.decode(f[1]);Ext.Msg.alert(p.errmsg,l.msg,function(){iserror=!0;logout(g,globeuid);window.location=l.result})}}else if(f=Ext.JSON.decode(f.responseText),!0==f.success){Ext.getDoc().dom.title=f.params.func_name;var u={};u.func_id=f.params.func_id;u.func_name=f.params.func_name;
u.conn_id=f.params.conn_id;u.relation_filter=f.params.relation_filter;Ext.Ajax.request({method:"POST",async:!1,setTimeout:1E3,url:"../../CUS/Funcs/EKB/SubKanBan02420302.dsc",params:{DCITag:g,uid:globeuid,action:"init",ckb_id:u.func_id},success:function(f){f=Ext.JSON.decode(f.responseText);f.success?(u.body_kbid=f.body_kbid,u.ckb_id=f.ckb_id,u.ckb_name=f.ckb_name,u.combinecolumn=f.combinecolumn,u.conn_id=f.conn_id,u.head_kbid=f.head_kbid,u.head_name=f.head_name,u.body_name=f.body_name,u.condition=
" AND "+f.combinecolumn+" = "):Ext.Msg.alert(langobj.errmsg,langobj.load_fail+"</br>"+f.msg)},failure:function(f,g){Ext.Msg.alert(langobj.errmsg,langobj.system_error)}});q(u,g,p,globeuid)}else Ext.Msg.alert(p.errmsg,p.kanban_not_exist)}})}})});
