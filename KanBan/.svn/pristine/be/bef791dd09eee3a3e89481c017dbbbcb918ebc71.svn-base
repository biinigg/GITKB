var pagekey,globeuid;function logout(q,l){"Microsoft Internet Explorer"==navigator.appName?window.navigate("./../../Login.dsc?action=logout&uid="+l+"&DCITag="+q):Ext.Ajax.request({method:"POST",url:"./../../Login.dsc",params:{DCITag:q,uid:l,action:"logout"}})}
function changeKanbanGrid(q,l,h){try{var n=null,f=null;"FS"==h?(n="font-size",f=q+"pt"):"FC"==h?(n="color",f="#"+q):"BC"==h?(n="background-color",f="#"+q):"RH"==h&&(n="height",f=q+"px");null!=n&&(Ext.util.CSS.updateRule("."+l+" .x-grid-row .x-grid-cell",n,f),"background-color"!=n&&"height"!=n&&Ext.util.CSS.updateRule("."+l+" .x-column-header",n,f))}catch(s){window.console&&console.log(s.message)}}
function filterComboData(q,l){var h=null;return h="NUM"==q||"DATE"==q?[{label:l.bigger,value:">"},{label:l.bigger_equal,value:">="},{label:l.smaller,value:"<"},{label:l.smaller_equal,value:"<="},{label:l.equal,value:"="},{label:l.not_equal,value:"<>"}]:"LIGHT"==q||"MAPPING"==q?[{label:l.equal,value:"="},{label:l.not_equal,value:"<>"}]:[{label:l.start_with,value:"startwith"},{label:l.end_with,value:"endwith"},{label:l.bigger,value:">"},{label:l.bigger_equal,value:">="},{label:l.smaller,value:"<"},
{label:l.smaller_equal,value:"<="},{label:l.equal,value:"="},{label:l.not_equal,value:"<>"},{label:l.like,value:"like"},{label:l.not_like,value:"notlike"}]}
Ext.onReady(function(){function q(h,n,f,s){var l=!1,q=!1,E=new Ext.util.TaskRunner,v=h.func_id+"grid",y=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[],proxy:{type:"ajax",url:"./../../Funcs/EKB/KanBan.dsc",actionMethods:{read:"POST"},reader:{root:"items",totalProperty:"total"},extraParams:{DCITag:n,uid:s,action:"query",page:1,pagesize:20,filter:"",sort:"",sql_id:h.func_id,conn_id:h.conn_id}},pageSize:20,gridreload:function(a,b){var c=a.items.get(0),e=a.items.get(1),d="",f="";if(null==b||0==b.length){var k=
c.condiParams.condi_col,g=c.condiParams.condi_type,p=c.condiParams.condi_value;null!=k&&""!=k&&(d=" and "+k+" ",d="startwith"==g?d+("like '"+p+"%' "):"endwith"==g?d+("like '%"+p+"' "):"like"==g?d+("like '%"+p+"%' "):"notlike"==g?d+("not like '%"+p+"%' "):d+(g+" '"+p+"' "))}else d=b;null!=e.displayParams.sort_col&&""!=e.displayParams.sort_col&&(f=e.displayParams.sort_col+" "+e.displayParams.sort_type);this.getProxy().extraParams.hasOwnProperty("page")&&(this.currentPage=this.getProxy().extraParams.page=
1);this.getProxy().extraParams.hasOwnProperty("pagesize")&&(this.pageSize=this.getProxy().extraParams.pagesize=e.sortParams.page_size);this.getProxy().extraParams.hasOwnProperty("filter")&&(null!=h.relation_filter&&0<h.relation_filter.length?this.getProxy().extraParams.filter=h.relation_filter:this.getProxy().extraParams.filter=d);this.getProxy().extraParams.hasOwnProperty("sort")&&(this.getProxy().extraParams.sort=f);this.load();null!=c.targetGrid&&c.targetGrid.getSelectionModel().deselectAll()}}),
t=Ext.create("Ext.panel.Panel",{region:"north",height:30,width:"100%",border:2,title:"",dock:"top",dataTask:null,scrollTask:null,marqueeUrl:"./../../Funcs/EKB/KanBan.dsc",html:"",startMarquee:function(a,b,c){function e(b){null!=k&&k.load(function(d){if(0<d.length){var k="";if("1"==c){for(var e=0;e<d.length;e++)k=0==e?'<div style="font-size:22px;"><Marquee height="'+a.height+'" scrollamount="3" onmouseover="this.stop()" onmouseout="this.start()">'+d[e].get("message"):k+("                              "+
d[e].get("message")),e==d.length-1&&(k+="</div></Marquee>");a.update(k)}else{null!=a.scrollTask&&(a.scrollTask.stop(),a.body.dom.scrollTop=0);for(var f="",e=0;e<d.length;e++)0==e?(f='<div style="font-size:22px;text-align:center;overflow:hidden;height:'+a.height+'px;">'+d[e].get("message")+"</div>",k="<div>"+f):k+='<div  style="font-size:22px;text-align:center;overflow:hidden;height:'+a.height+'px;">'+d[e].get("message")+"</div>",e==d.length-1&&(k+=f+"</div>");a.update(k);null!=a.scrollTask&&a.scrollTask.start(5E3)}b(a)}})}
var d=new Ext.util.TaskRunner,f=null,k=Ext.create("Ext.data.Store",{autoLoad:!1,fields:["message"],proxy:{type:"ajax",url:this.marqueeUrl,actionMethods:{read:"POST"},reader:{root:"marquee"},extraParams:{DCITag:n,uid:s,action:"marqueeData",sql_id:h.func_id,conn_id:h.conn_id}}}),g=d.newTask({run:function(){e(function(a){})}});this.dataTask=g;e(function(a){g.start(1E3*b);var e=0;"2"==c?(f=d.newTask({run:function(){0<k.getCount()&&(0==e&&(a.body.dom.scrollTop=0),e==k.getCount()-1?e=0:e++,a.scrollBy(0,
a.height,!0))}}),a.scrollTask=f,f.start(5E3)):a.scrollTask=null})},stopScrollTask:function(){null!=this.dataTask&&this.dataTask.stop();null!=this.scrollTask&&this.scrollTask.stop()},listeners:{el:{mouseover:function(a,b,c){null!=t&&null!=t.scrollTask&&t.scrollTask.stop()}},body:{mouseout:function(a,b,c){null!=t&&null!=t.scrollTask&&t.scrollTask.start(5E3)}}}}),r=Ext.create("Ext.window.Window",{layout:"border",title:f.toolbar_query_title,closeAction:"hide",height:300,width:520,minHeight:300,minWidth:520,
modal:!0,plain:!0,condiStr:"",kanbanStore:null,headPanel:null,lightsData:null,langObj:f,items:[{xtype:"panel",region:"north",layout:"anchor",border:0,height:70,items:[{xtype:"panel",layout:"absolute",anchor:"100% 50%",height:35,condiParams:{condi_col:"",condi_type:"",condi_value:"",dcondi_col:"",dcondi_type:"",dcondi_value:""},items:[Ext.create("DCI.Customer.ComboBox",{fieldLabel:f.condi_col,store:{fields:["label","value","col_type","config_value"],autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}},
labelWidth:90,width:250,x:0,y:5,listeners:{change:function(a,b,c,e){c=this.up("panel");var d=c.items.get(1),m=a.getStore();e=c.items.get(2);for(var k=null,g=null,p=null,h=0;h<m.getCount();h++)if(b==m.getAt(h).get("value")){k=m.getAt(h).get("col_type");p=m.getAt(h).get("config_value");break}if(null!=k){d.getStore().loadData(filterComboData(k,f));d.loadDefault();if("DATE"==k)g=Ext.create("DCI.Customer.DateField",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",parentPanel:c,
x:340,y:5,listeners:{change:function(a,b,c,d){a.parentPanel.condiParams.condi_value=Ext.Date.format(new Date(b),"Ymd");a.parentPanel.condiParams.dcondi_value=Ext.Date.format(new Date(b),"Y/m/d")}}});else if("MAPPING"==k||"LIGHT"==k){g=Ext.create("DCI.Customer.ComboBox",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",parentPanel:c,x:340,y:5,listeners:{change:function(b,c,d,e){b.parentPanel.condiParams.condi_value=c;b.parentPanel.condiParams.dcondi_value=a.getRawValue()}}});
if("MAPPING"==k){d=[];p=p.split(";");m=null;for(h=0;h<p.length;h++)m=p[h].split("="),null!=m&&2==m.length&&d.push({value:m[0],label:m[1]});g.getStore().loadData(d)}else null!=c.up("panel").up("window").lightsData&&g.getStore().loadData(c.up("panel").up("window").lightsData);g.loadDefault()}else g=Ext.create("DCI.Customer.TextField",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",parentPanel:c,x:340,y:5,listeners:{change:function(a,b,c,d){a.parentPanel.condiParams.condi_value=
b;a.parentPanel.condiParams.dcondi_value=b}}});c.remove(e.getId());c.insert(2,g)}c.condiParams.condi_col=b;c.condiParams.dcondi_col=a.getRawValue()}}}),Ext.create("DCI.Customer.ComboBox",{fieldLabel:"",labelWidth:0,width:90,x:250,y:5,listeners:{change:function(a,b,c,e){c=this.up("panel");c.condiParams.condi_type=b;c.condiParams.dcondi_type=a.getRawValue()}}}),Ext.create("DCI.Customer.TextField",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",x:340,y:5})]},{xtype:"panel",anchor:"100% 50%",
layout:"absolute",items:[{xtype:"radiogroup",fieldLabel:f.condi_relation,columns:2,vertical:!0,width:200,x:0,y:5,items:[{boxLabel:"AND",name:"rb",inputValue:"AND",checked:!0},{boxLabel:"OR",name:"rb",inputValue:"OR"}]},{xtype:"button",text:f.add,x:200,y:5,handler:function(){var a=this.up("panel"),b=a.up("panel").items.get(0),c=a.up("panel").up("window").items.get(1).getStore(),a=a.items.get(0).getValue();null!=c&&c.add({condi_relation:a.rb,condi_col_display:b.condiParams.dcondi_col,condi_type_display:b.condiParams.dcondi_type,
condi_value_display:b.condiParams.dcondi_value,condi_col:b.condiParams.condi_col,condi_type:b.condiParams.condi_type,condi_value:b.condiParams.condi_value})}},{xtype:"button",text:f._delete,x:250,y:5,handler:function(){var a=this.up("panel").up("panel").up("window").items.get(1);a.getSelectionModel().hasSelection()&&a.getStore().remove(a.getSelectionModel().getSelection()[0])}},{xtype:"button",text:f.clear,x:300,y:5,handler:function(){var a=this.up("panel").up("panel").up("window").items.get(1).getStore();
null!=a&&a.removeAll()}}]}]},{xtype:"grid",region:"center",renderer:"component",border:0,stripeRows:!0,autoScroll:!0,loadMask:!0,hideHeaders:!0,enableTextSelection:!0,viewConfig:{forceFit:!1,autoLoad:!1},columns:[{dataIndex:"condi_relation",width:50},{dataIndex:"condi_col_display",width:150},{text:f.conn_id,dataIndex:"condi_type_display",width:100},{text:f.conn_id,dataIndex:"condi_value_display",width:200}],store:Ext.create("Ext.data.Store",{fields:"condi_relation condi_col_display condi_type_display condi_value_display condi_col condi_type condi_value".split(" "),
autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}},syncCondiString:function(a){for(var b="",c=0;c<this.getCount();c++)b+=" "+this.getAt(c).get("condi_relation")+" "+this.getAt(c).get("condi_col")+" ",b="startwith"==this.getAt(c).get("condi_type")?b+("like '"+this.getAt(c).get("condi_value")+"%' "):"endwith"==this.getAt(c).get("condi_type")?b+("like '%"+this.getAt(c).get("condi_value")+"' "):"like"==this.getAt(c).get("condi_type")?b+("like '%"+this.getAt(c).get("condi_value")+"%' "):"notlike"==
this.getAt(c).get("condi_type")?b+("not like '%"+this.getAt(c).get("condi_value")+"%' "):b+(this.getAt(c).get("condi_type")+" '"+this.getAt(c).get("condi_value")+"' ");a.condiStr=b},listeners:{datachanged:function(a,b){var c=null;null!=w&&(c=w.items.get(4),null!=c&&(0<a.getCount()?c.getEl().setStyle({borderWidth:"2px 2px 2px 2px",borderColor:"red",boderStyle:"solid"}):c.getEl().setStyle({borderWidth:"1px 1px 1px 1px",borderColor:"",boderStyle:""})))}}})}],buttons:[{xtype:"button",text:f.ok,handler:function(){var a=
this.up("window"),b=a.items.get(1).getStore();null!=b&&(b.syncCondiString(a),null!=a.kanbanStore&&a.kanbanStore.gridreload(a.headPanel,a.condiStr));a.close()}},{xtype:"button",text:f.cancel,handler:function(){this.up("window").close()}}],setComboData:function(a,b){var c=this.items.get(0).items.get(0).items.get(0),e=c.getStore();null!=e&&(e.loadData(a),null==b||""==b?c.loadDefault():c.setValue(b))},setInitData:function(a,b,c,e){var d=this.items.get(0).items.get(0).items.get(0);null==c.filter_col||
""==c.filter_col?d.loadDefault():d.setValue(c.filter_col);d=this.items.get(0).items.get(0).items.get(1);null==c.filter_condi||""==c.filter_condi?d.loadDefault():d.setValue(c.filter_condi);d=this.items.get(0).items.get(0).items.get(2);null==c.filter_value||""==c.filter_value?d.loadDefault():d.setValue(c.filter_value);this.headPanel=a;this.kanbanStore=b;null!=e&&(this.items.get(1).getStore().loadData(e),this.items.get(1).getStore().syncCondiString(r));var m=this.items.get(0).items.get(0);e=m.items.get(0).getStore();
d=m.items.get(1);a=m.items.get(2);var k=null;c=b=null;if(null!=e&&0<e.getCount()&&(k=e.getAt(0).get("col_type"),c=e.getAt(0).get("config_value"),null!=k)){d.getStore().loadData(filterComboData(k,f));d.loadDefault();if("DATE"==k)b=Ext.create("DCI.Customer.DateField",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",parentPanel:m,x:340,y:5,listeners:{change:function(a,b,c,d){a.parentPanel.condiParams.condi_value=Ext.Date.format(new Date(b),"Ymd");a.parentPanel.condiParams.dcondi_value=
Ext.Date.format(new Date(b),"Y/m/d")}}});else if("MAPPING"==k||"LIGHT"==k){b=Ext.create("DCI.Customer.ComboBox",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",parentPanel:m,x:340,y:5,listeners:{change:function(a,b,c,d){a.parentPanel.condiParams.condi_value=b;a.parentPanel.condiParams.dcondi_value=m.items.get(2).getRawValue()}}});if("MAPPING"==k){e=[];c=c.split(";");d=null;for(k=0;k<c.length;k++)d=c[k].split("="),null!=d&&2==d.length&&e.push({value:d[0],label:d[1]});b.getStore().loadData(e)}else null!=
this.lightsData&&b.getStore().loadData(this.lightsData);b.loadDefault();m.condiParams.condi_value=b.getValue();m.condiParams.dcondi_value=b.getRawValue()}else b=Ext.create("DCI.Customer.TextField",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",parentPanel:m,x:340,y:5,listeners:{change:function(a,b,c,d){a.parentPanel.condiParams.condi_value=b;a.parentPanel.condiParams.dcondi_value=b}}});m.remove(a.getId());m.insert(2,b)}},getCondiValue:function(){var a=[],b=this.items.get(1).getStore();
if(null!=b)for(var c=0;c<b.getCount();c++)a.push({condi_relation:b.getAt(c).get("condi_relation"),condi_col:b.getAt(c).get("condi_col"),condi_type:b.getAt(c).get("condi_type"),condi_value:b.getAt(c).get("condi_value"),condi_col_display:b.getAt(c).get("condi_col_display"),condi_type_display:b.getAt(c).get("condi_type_display"),condi_value_display:b.getAt(c).get("condi_value_display"),seq:c});return a}}),w=Ext.create("Ext.panel.Panel",{title:"",anchor:"100% 50%",layout:"absolute",border:0,bodyStyle:{background:"#d3e1f1"},
bodyPadding:0,targetGrid:null,lightsData:null,condiParams:{condi_col:"",condi_type:"",condi_value:""},items:[Ext.create("DCI.Customer.ComboBox",{fieldLabel:f.condi_col,store:{fields:["label","value","col_type","config_value"],autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}},labelWidth:90,width:250,x:0,y:8,listeners:{change:function(a,b,c,e){c=this.up("panel");var d=c.items.get(1),m=a.getStore();a=c.items.get(2);for(var k=null,g=e=null,p=0;p<m.getCount();p++)if(b==m.getAt(p).get("value")){k=
m.getAt(p).get("col_type");g=m.getAt(p).get("config_value");break}if(null!=k){d.getStore().loadData(filterComboData(k,f));d.loadDefault();if("DATE"==k)e=Ext.create("DCI.Customer.DateField",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",parentPanel:c,x:340,y:8,listeners:{change:function(a,b,c,d){a.parentPanel.condiParams.condi_value=Ext.Date.format(new Date(b),"Ymd")}}});else if("MAPPING"==k||"LIGHT"==k){e=Ext.create("DCI.Customer.ComboBox",{fieldLabel:"",labelWidth:0,width:150,
name:"condi_value",defaultvalue:"",parentPanel:c,x:340,y:8,listeners:{change:function(a,b,c,d){a.parentPanel.condiParams.condi_value=b}}});if("MAPPING"==k){d=[];g=g.split(";");m=null;for(p=0;p<g.length;p++)m=g[p].split("="),null!=m&&2==m.length&&d.push({value:m[0],label:m[1]});e.getStore().loadData(d)}else e.getStore().loadData(c.lightsData);e.loadDefault()}else e=Ext.create("DCI.Customer.TextField",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",parentPanel:c,x:340,y:8,listeners:{change:function(a,
b,c,d){a.parentPanel.condiParams.condi_value=b}}});c.remove(a.getId());c.insert(2,e)}c.condiParams.condi_col=b}}}),Ext.create("DCI.Customer.ComboBox",{fieldLabel:"",labelWidth:0,width:90,x:250,y:8,listeners:{change:function(a,b,c,e){this.up("panel").condiParams.condi_type=b}}}),Ext.create("DCI.Customer.TextField",{fieldLabel:"",labelWidth:0,width:150,name:"condi_value",defaultvalue:"",x:340,y:8}),{xtype:"button",cls:"search-toolbar",tooltip:f.search,width:30,height:30,x:500,y:3,handler:function(){var a=
this.up("panel"),b=a.targetGrid.getStore();h.relation_filter="";b.gridreload(a.up("panel"),r.condiStr)}},{xtype:"button",cls:"advsearchbutton",tooltip:f.adv_search,width:30,height:30,x:530,y:3,handler:function(){null!=r&&r.show()}},{xtype:"button",cls:"savebutton",tooltip:f.save_format,width:30,height:30,x:560,y:3,handler:function(){var a=this.up("panel"),b=this.up("panel").up("panel").items.get(1),c=this.up("panel").targetGrid.columns,e=[],d={},g=a.targetGrid;d.popup_width=null==g?200:g.getPopupWidth();
for(var k in b.displayParams)d[k]=b.displayParams[k];for(a=0;a<c.length;a++)b={},b.col_id=c[a].colid,b.col_index=c[a].getIndex(),b.col_width=c[a].width,b.col_visible=c[a].hidden?0:1,e.push(b);Ext.Ajax.request({method:"POST",url:"../../Funcs/EKB/KanBan.dsc",params:{DCITag:n,uid:s,action:"saveFormat",gridid:h.func_id,datas:Ext.encode(d),coldatas:Ext.encode(e)},success:function(a){null!=g&&g.addCusFormatIcon();Ext.Msg.alert(f.save_result_title,f.save_success)},failure:function(a,b){Ext.Msg.alert(f.save_result_title,
f.save_fail+" :</br>"+b.result.errorMessage)}})}},{xtype:"button",cls:"backdefault_greenbutton",tooltip:f.load_def_format,width:30,height:30,x:590,y:3,handler:function(){var a=this.up("panel").up("panel").items.get(1);Ext.MessageBox.confirm(f.load_def_confirm_title,f.load_def_confirm_msg,function(b){"yes"==b&&Ext.Ajax.request({method:"POST",url:"../../Funcs/EKB/KanBan.dsc",params:{DCITag:n,uid:s,action:"loadDefFormat",datas:"dodelete",gridid:h.func_id},success:function(b){a.setCss({grid_font_size:13,
grid_font_color:"000000",grid_row_height:16,grid_row_color:"FFFFFF"});null!=g&&(g.rmCusFormatIcon(),g.setPopupWidth(200),null!=C&&0<C.getCount()&&C.load(function(a){g.reloadBodyGridFormat(a[0].get("cols"),y)}));Ext.Msg.alert(f.load_def_result_title,f.load_def_success)},failure:function(a,b){Ext.Msg.alert(f.load_def_result_title,f.load_def_fail+" :</br>"+b.result.errorMessage)}})})}},{xtype:"button",cls:"save-toolbar",tooltip:f.save_condi,width:30,height:30,x:620,y:3,handler:function(){var a=this.up("panel"),
b=this.up("panel").up("panel").items.get(1),c={},e=null,d;for(d in a.condiParams)c[d]=a.condiParams[d];for(d in b.sortParams)c[d]=b.sortParams[d];if(null==c.condi_col||""==c.condi_col)c.condi_type="",c.condi_value="";if(null==c.sort_col||""==c.sort_col)c.sort_type="";null!=r&&null!=r.getCondiValue()&&0<r.getCondiValue().length&&(e=Ext.encode(r.getCondiValue()));Ext.Ajax.request({method:"POST",url:"../../Funcs/EKB/KanBan.dsc",params:{DCITag:n,uid:s,action:"saveCondi",sql_id:h.func_id,datas:Ext.encode(c),
advDatas:e},success:function(b){h.relation_filter="";a.targetGrid.getStore().gridreload(a.up("panel"),r.condiStr);Ext.Msg.alert(f.save_result_title,f.save_success)},failure:function(a,b){Ext.Msg.alert(f.save_result_title,f.save_fail+" :</br>"+b.result.errorMessage)}})}},{xtype:"button",cls:"backdefault_bluebutton",tooltip:f.load_def_condi,width:30,height:30,x:650,y:3,handler:function(){var a=this.up("panel").up("panel"),b=a.items.get(0),c=a.items.get(1);Ext.MessageBox.confirm(f.load_def_confirm_title,
f.load_def_confirm_msg,function(e){"yes"==e&&Ext.Ajax.request({method:"POST",url:"../../Funcs/EKB/KanBan.dsc",params:{action:"loadDefCondi",uid:s,datas:"dodelete",DCITag:n,sql_id:h.func_id},success:function(d){d={filter_col:"",filter_condi:"",filter_value:"",sort_col:"",sort_type:"",page_size:20};b.setInitData(d);if(null!=r){var e=r.items.get(1).getStore();null!=e&&e.removeAll()}c.setInitData(d);b.targetGrid.getStore().gridreload(a);Ext.Msg.alert(f.load_def_result_title,f.load_def_success)},failure:function(a,
b){Ext.Msg.alert(f.load_def_result_title,f.load_def_fail+" :</br>"+b.result.errorMessage)}})})}}],setComboData:function(a,b){var c=this.items.get(0),e=c.getStore();a.unshift({label:f.no_query,value:"",col_type:"CHAR",config_value:""});null!=e&&(e.loadData(a),null==b||""==b?c.loadDefault():c.setValue(b));a.shift()},setInitData:function(a){var b=this.items.get(0);null==a.filter_col||""==a.filter_col?b.loadDefault():b.setValue(a.filter_col);b=this.items.get(1);null==a.filter_condi||""==a.filter_condi?
b.loadDefault():b.setValue(a.filter_condi);b=this.items.get(2);null==a.filter_value||""==a.filter_value?b.loadDefault():b.setValue(a.filter_value)}}),B=Ext.create("Ext.panel.Panel",{title:"",anchor:"100% 50%",layout:"absolute",border:0,bodyStyle:{background:"#d3e1f1"},bodyPadding:0,sortParams:{sort_col:"",sort_type:"",page_size:20},displayParams:{fs:13,fc:"000000",rh:16,bc:"FFFFFF"},bodygrid:null,items:[Ext.create("DCI.Customer.ComboBox",{fieldLabel:f.sort_column,name:"sort_column",labelWidth:90,
width:250,x:0,y:8,listeners:{change:function(a,b,c,e){this.up("panel").sortParams.sort_col=b}}}),Ext.create("DCI.Customer.ComboBox",{fieldLabel:"",labelWidth:0,width:90,store:{fields:["label","value"],data:[{label:f.asc,value:"asc"},{label:f.desc,value:"desc"}]},x:250,y:8,listeners:{change:function(a,b,c,e){this.up("panel").sortParams.sort_type=b}}}),Ext.create("DCI.Customer.NumberBox",{fieldLabel:f.page_size,labelWidth:60,defaultvalue:20,maxValue:9999,minValue:1,width:150,x:340,y:8,listeners:{change:function(a,
b,c,e){this.up("panel").sortParams.page_size=b}}}),{xtype:"button",cls:"configbutton",tooltip:f.favorties_setup,x:500,y:5,width:30,height:30,handler:function(){var a=this.up("panel").displayParams;Ext.create("Ext.window.Window",{title:f.favorties_setup,width:500,height:300,minWidth:300,minHeight:200,layout:"fit",plain:!0,modal:!0,items:[{xtype:"panel",layout:"anchor",items:[{xtype:"slider",anchor:"80% 25%",fieldLabel:f.font_size,border:1,value:a.fs,minValue:8,maxValue:48,increment:1,plugins:new Ext.slider.Tip,
listeners:{change:function(b,c,e,d){changeKanbanGrid(c,v,"FS");if(null!=g&&0<g.columns.length)try{var f=g.columns[0].width;g.columns[0].setWidth(f+10);g.columns[0].setWidth(f)}catch(k){window.console&&console.log(k.message)}a.fs=c},afterrender:function(a,c){this.labelCell.dom.attributes.getNamedItem("valign").value="middle"}}},{xtype:"dcicolorpicker",fieldLabel:f.font_color,defaultColor:"000000",curColor:a.fc,width:180,listeners:{change:function(b,c,e,d){changeKanbanGrid(c,v,"FC");a.fc=c}}},{xtype:"slider",
anchor:"80% 25%",fieldLabel:f.row_height,value:a.rh,minValue:16,maxValue:100,increment:4,plugins:new Ext.slider.Tip,listeners:{change:function(b,c,e,d){changeKanbanGrid(c,v,"RH");a.rh=c},afterrender:function(a,c){this.labelCell.dom.attributes.getNamedItem("valign").value="middle"}}},{xtype:"dcicolorpicker",fieldLabel:f.bg_color,defaultColor:"FFFFFF",curColor:a.bc,width:180,listeners:{change:function(b,c,e,d){changeKanbanGrid(c,v,"BC");a.bc=c}}}]}],buttons:[{text:f.close,handler:function(){this.up(".window").close()}}]}).show()}},
{xtype:"button",cls:"toexcelbutton",tooltip:f.to_excel,width:30,height:30,x:530,y:5,handler:function(){var a=this.up("panel").bodygrid;null!=a&&Ext.create("Ext.form.Panel",{standardSubmit:!0,url:"../../Funcs/EKB/KanBan.dsc",method:"POST"}).submit({target:"_blank",params:{DCITag:n,uid:s,conn_id:h.conn_id,func_id:h.func_id,action:"excel",filter:a.getStore().getProxy().extraParams.filter,sort:a.getStore().getProxy().extraParams.sort,cols:Ext.encode(buildColObj(a.columns)),ctype:"1"}})}},{xtype:"button",
cls:"tohtmlbutton",tooltip:f.to_html,width:30,height:30,x:560,y:5,handler:function(){var a=this.up("panel").bodygrid;null!=a&&Ext.create("Ext.form.Panel",{standardSubmit:!0,url:"../../Funcs/EKB/KanBan.dsc",method:"POST"}).submit({target:"_blank",params:{DCITag:n,uid:s,conn_id:h.conn_id,func_id:h.func_id,action:"html",filter:a.getStore().getProxy().extraParams.filter,sort:a.getStore().getProxy().extraParams.sort,cols:Ext.encode(buildColObj(a.columns)),ctype:"2"}})}}],setComboData:function(a){var b=
this.items.get(0),c=b.getStore();a.unshift({label:f.no_sort,value:""});null!=c&&(c.loadData(a),b.loadDefault());a.shift()},setCss:function(a){var b="",c="";Ext.util.CSS.removeStyleSheet(v);null!=a.grid_font_size&&""!=a.grid_font_size?(b+="font-size:"+a.grid_font_size+"pt;",c+="font-size:"+a.grid_font_size+"pt;",this.displayParams.fs=a.grid_font_size):(b+="font-size:13pt;",c+="font-size:13pt;");null!=a.grid_font_color&&""!=a.grid_font_color?(b+="color:#"+a.grid_font_color+";",c+="color:#"+a.grid_font_color+
";",this.displayParams.fc=a.grid_font_color):(b+="color:black;",c+="color:black;");null!=a.grid_row_height&&""!=a.grid_row_height?(b+="height:"+a.grid_row_height+"px;",this.displayParams.rh=a.grid_row_height):b+="height:16px;";null!=a.grid_row_color&&""!=a.grid_row_color?(b+="background-color:#"+a.grid_row_color+";",this.displayParams.bc=a.grid_row_color):b+="background-color:withe;";Ext.util.CSS.createStyleSheet("."+v+" .x-grid-row .x-grid-cell {"+b+"}",v);Ext.util.CSS.createStyleSheet("."+v+" .x-column-header {"+
c+"}",v)},setInitData:function(a,b){var c=this.items.get(0);null==a.sort_col||""==a.sort_col?c.loadDefault():c.setValue(a.sort_col);c=this.items.get(1);null==a.sort_type||""==a.sort_type?c.loadDefault():c.setValue(a.sort_type);c=this.items.get(2);null!=a.page_size&&""!=a.page_size?c.setValue(a.page_size):c.loadDefault();this.bodygrid=b}}),z=Ext.create("Ext.panel.Panel",{region:"north",height:120,collapsible:!0,title:"",header:{height:35},layout:"anchor",items:[w,B]}),g=Ext.create("Ext.grid.Panel",
{region:"center",renderer:"component",stripeRows:!0,autoScroll:!0,loadMask:!0,allowDeselect:!0,usePopup:!0,popupImgPath:"",popupImgCols:[],popupTitleCols:[],popup_refresh_gap:600,selModel:{allowDeselect:!0},enableTextSelection:!0,viewConfig:{forceFit:!1,autoLoad:!1},store:null,bodyCls:v,componentCls:v,columns:[],sqlRelationStore:Ext.create("Ext.data.Store",{fields:["col_id","target_sql_id","target_col_id","target_sql_name"],autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}}),currpage:0,totalpage:0,
timer:null,dockedItems:[{xtype:"pagingtoolbar",store:null,dock:"bottom",displayInfo:!1,items:["-",{enableToggle:!0,width:50,tooltip:"",cls:"starttimerbutton",toggleHandler:function(a,b){null!=D&&!D.globalRunning&&this.btnClick(a,b)},btnClick:function(a,b){var c=this.up("panel").timer;null!=c&&(b?c.executeTask():c.stopTask())}},"-",{xtype:"label",text:f.refresh_gap},{xtype:"label",text:"",margin:"0 0 0 10"},"-",Ext.create("DCI.Customer.Img",{src:"../../images/icons/CusGridFormat.png",width:20,height:20,
hidden:!0,listeners:{afterrender:function(a){Ext.create("Ext.tip.ToolTip",{target:a.getEl(),html:f.cus_format})}}}),Ext.create("DCI.Customer.Img",{src:"../../images/button_icon/BtnCrossDatabase.png",width:20,height:20,hidden:!0,listeners:{afterrender:function(a){Ext.create("Ext.tip.ToolTip",{target:a.getEl(),html:f.cross_db})}}})],listeners:{beforechange:function(a,b,c){this.store.getProxy().extraParams.hasOwnProperty("page")&&(null==b||0==b?this.store.getProxy().extraParams.page=1:this.store.getProxy().extraParams.page=
b);this.store.load()},change:function(a,b,c){null==b||null==b.currentPage||null==b.pageCount?(this.up("panel").setCurrPage(0),this.up("panel").setTotlaPage(0)):(this.up("panel").setCurrPage(b.currentPage),this.up("panel").setTotlaPage(b.pageCount))}}},t,{xtype:"panel",height:"100%",width:200,border:5,title:"",dock:"right",layout:"fit",collapsible:!0,collapseDirection:"right",animCollapse:!1,hidden:!1,buttonAlign:"left",resizable:!0,items:[{xtype:"panel",height:"100%",title:"",width:"100%",border:0}],
header:{items:[{xtype:"button",cls:"playbutton",pressedCls:"pausebutton",width:15,height:15,enableToggle:!0,handler:function(){null!=x&&(this.pressed?(x.executeTask(),null!=g&&g.nextSelectedRow()):x.stopTask())}}]},showPopup:function(a,b){var c=this.items.get(0),e=this.items.get(0);null!=e&&(null==a||""==a?e.setTitle(" "):e.setTitle(a),Ext.Ajax.request({method:"POST",url:"./../../PublicCtrl.dsc",params:{DCITag:n,uid:s,action:"B64Encode",str:b},success:function(a){a=Ext.JSON.decode(a.responseText);
a="<img width="+c.getWidth()+" height="+c.getHeight()+' src="./../../ImageLoader.dsc?imgpath='+a.result+'"/>';c.update(a)}}))}}],listeners:{selectionchange:function(a,b,c){if(this.usePopup&&0<b.length){c=a="";for(var e=this.dockedItems.get(3),d=0;d<this.popupImgCols.length;d++)a=0==d?b[0].get(this.popupImgCols[d]):a+("--"+b[0].get(this.popupImgCols[d]));for(d=0;d<this.popupTitleCols.length;d++)c=0==d?b[0].get(this.popupTitleCols[d]):c+("--"+b[0].get(this.popupTitleCols[d]));null!=e&&(b=this.popupImgPath.replace("\\",
'"'),b=b.replace('"',"\\")+"\\",e.showPopup(c,b+a+".jpg"))}},celldblclick:function(a,b,c,e,d,f,k,g){},cellcontextmenu:function(a,b,c,e,d,f,k,g){if(null!=this.sqlRelationStore&&0<this.sqlRelationStore.getCount()){a=Ext.create("Ext.menu.Menu",{mpanel:D.parentComp,items:[],clickEvent:function(a,b,c){var d=this;null!=d.mpanel&&Ext.Ajax.request({method:"POST",url:"./../../Funcs/EKB/KanBan.dsc",params:{action:"funcInfo",uid:s,DCITag:n,func_id:b,conn_id:h.conn_id},success:function(e){null==e.responseText||
""==e.responseText||0==e.responseText.length?alert("open kanban "+b+" fail"):(e=Ext.JSON.decode(e.responseText),d.mpanel.beforeAddCheck(b,h.conn_id,{url:e.url,text:e.text,func_package:e.func_package,can_edit:e.can_edit,filter:" and "+c+" = '"+a+"'"},!0))}})}});for(b=0;b<this.sqlRelationStore.getCount();b++)this.columns[c].dataIndex==this.sqlRelationStore.getAt(b).get("col_id")&&a.add({text:this.sqlRelationStore.getAt(b).get("target_sql_name"),currcol:this.sqlRelationStore.getAt(b).get("col_id"),cellValue:e.get(this.columns[c].dataIndex),
targetsql:this.sqlRelationStore.getAt(b).get("target_sql_id"),targetcol:this.sqlRelationStore.getAt(b).get("target_col_id"),handler:function(){this.up("menu").clickEvent(this.cellValue,this.targetsql,this.targetcol)}});0<a.items.length&&(k.stopEvent(),a.showAt(k.getXY()))}}},addCusFormatIcon:function(){this.dockedItems.items[1].items.get(17).show()},rmCusFormatIcon:function(){this.dockedItems.items[1].items.get(17).hide()},setCrossDBIcon:function(a){var b=this.dockedItems.items[1];a?b.items.get(18).show():
b.items.get(18).hide()},initBodyGrid:function(a,b,c,e){this.timer=a;var d=this,f=[];Ext.create("Ext.data.Store",{autoLoad:!1,fields:["colFormats"],proxy:{type:"ajax",url:"./../../PublicCtrl.dsc",actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{DCITag:n,uid:s,action:"getGFormat",gridid:h.func_id}}}).load(function(a){if(0<a.length){var g=Ext.create("Ext.data.Store",{fields:["col_id","col_index","col_width","col_visible"],autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}});g.loadData(a[0].get("colFormats"));
if(0<g.getCount()){d.addCusFormatIcon();for(a=0;a<g.getCount();a++)for(var h=0;h<b.length;h++)if(b[h].colid==g.getAt(a).get("col_id")){"1"==g.getAt(a).get("col_visible")?(b[h].hasOwnProperty("hidden"),b[h].hidden=!1,0!=g.getAt(a).get("col_width")&&(b[h].hasOwnProperty("width"),b[h].width=parseInt(g.getAt(a).get("col_width")))):(0!=g.getAt(a).get("col_width")&&(b[h].hasOwnProperty("width"),b[h].width=parseInt(g.getAt(a).get("col_width"))),b[h].hasOwnProperty("hidden"),b[h].hidden=!0);f.push(b[h]);
b.splice(h,1);break}if(null!=b&&0!=b.length)for(a=0;a<b.length;a++)b[a].hidden=!0,f.push(b[a])}else f=b;if(null!=e)for(h=0;h<f.length;h++)for(a=0;a<e.length;a++)if("col"+e[a].col_id==f[h].colid){f[h].hasOwnProperty("componentCls");f[h].componentCls="dci-realtion-column-header";break}d.reconfigure(c,f)}else{if(null!=e)for(h=0;h<b.length;h++)for(a=0;a<e.length;a++)if("col"+e[a].col_id==b[h].colid){b[h].hasOwnProperty("componentCls");b[h].componentCls="dci-realtion-column-header";break}d.reconfigure(c,
b)}d.child("pagingtoolbar").bindStore(y);null!=w&&(w.targetGrid=d)});d.sqlRelationStore.loadData(e)},reloadBodyGridFormat:function(a,b){var c=this,e=[];Ext.create("Ext.data.Store",{autoLoad:!1,fields:["colFormats"],proxy:{type:"ajax",url:"./../../PublicCtrl.dsc",actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{DCITag:n,uid:s,action:"getGFormat",gridid:h.func_id}}}).load(function(d){if(0<d.length){var f=Ext.create("Ext.data.Store",{fields:["col_id","col_index","col_width","col_visible"],
autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}});f.loadData(d[0].get("colFormats"));if(0<f.getCount()){c.addCusFormatIcon();for(d=0;d<f.getCount();d++)for(var g=0;g<a.length;g++)if(a[g].colid==f.getAt(d).get("col_id")){"1"==f.getAt(d).get("col_visible")?(a[g].hasOwnProperty("hidden"),a[g].hidden=!1,0!=f.getAt(d).get("col_width")&&(a[g].hasOwnProperty("width"),a[g].width=parseInt(f.getAt(d).get("col_width")))):(0!=f.getAt(d).get("col_width")&&(a[g].hasOwnProperty("width"),a[g].width=parseInt(f.getAt(d).get("col_width"))),
a[g].hasOwnProperty("hidden"),a[g].hidden=!0);e.push(a[g]);a.splice(g,1);break}if(null!=a&&0!=a.length)for(d=0;d<a.length;d++)a[d].hidden=!0,e.push(a[d])}else e=a;if(null!=c.sqlRelationStore)for(g=0;g<e.length;g++)for(d=0;d<c.sqlRelationStore.getCount();d++)if("col"+c.sqlRelationStore.getAt(d).data.col_id==e[g].colid){e[g].hasOwnProperty("componentCls");e[g].componentCls="dci-realtion-column-header";break}c.reconfigure(b,e)}else{if(null!=c.sqlRelationStore)for(g=0;g<a.length;g++)for(d=0;d<c.sqlRelationStore.getCount();d++)if("col"+
c.sqlRelationStore.getAt(d).data.col_id==a[g].colid){a[g].hasOwnProperty("componentCls");a[g].componentCls="dci-realtion-column-header";break}c.reconfigure(b,a)}c.child("pagingtoolbar").bindStore(y);null!=w&&(w.targetGrid=c)})},setCurrPage:function(a){this.currpage=a},setTotlaPage:function(a){this.totalpage=a},nextPage:function(){var a=0,b=this;null==b.currpage||0==b.currpage?a=1:(a=b.currpage+1,a>b.totalpage&&(a=1));b.store.getProxy().extraParams.hasOwnProperty("page")&&(b.store.getProxy().extraParams.page=
a,b.store.currentPage=a);b.store.load(function(c){b.getSelectionModel().deselectAll();b.setCurrPage(a);b.setRefreshTime()})},globalNextPage:function(a){var b=0,c=this;if(-1==a)c.store.getProxy().extraParams.hasOwnProperty("page")&&(c.store.getProxy().extraParams.page=1,c.store.currentPage=1),c.store.load(function(a){c.getSelectionModel().deselectAll();c.setCurrPage(1);c.setRefreshTime();c.usePopup&&(a=c.getSelectionModel(),null!=a&&a.select(0))});else if(b=c.currpage+1,b>c.totalpage&&(b=1),c.usePopup){var e=
c.getSelectionModel();null!=e&&(a=0,null==e.lastSelected?e.select(0):e.lastSelected.index%c.getStore().pageSize==c.getStore().getCount()-1||null==e.getSelection()||0==e.getSelection().length?(c.store.getProxy().extraParams.hasOwnProperty("page")&&(c.store.getProxy().extraParams.page=b,c.store.currentPage=b),c.store.load(function(a){e.deselectAll();c.setCurrPage(b);c.setRefreshTime();c.getSelectionModel().select(0)})):(a=(e.lastSelected.index+1)%c.getStore().pageSize,c.getSelectionModel().select(a)))}else c.store.getProxy().extraParams.hasOwnProperty("page")&&
(c.store.getProxy().extraParams.page=b,c.store.currentPage=b),c.store.load(function(a){c.getSelectionModel().deselectAll();c.setCurrPage(b);c.setRefreshTime()})},nextSelectedRow:function(){var a=this.getSelectionModel();if(null!=a){var b=0;null!=a.lastSelected&&(b=this.getSelectionModel().lastSelected.index%this.getStore().pageSize>=this.getStore().getCount()-1||null==a.getSelection()||0==a.getSelection().length?0:(this.getSelectionModel().lastSelected.index+1)%this.getStore().pageSize);a.select(b)}},
setRefreshTimeTitle:function(a,b){var c=this.dockedItems.get(1).items.get(14);null!=c&&c.setText(f.refresh_gap+"  "+a+"  "+b)},setRefreshTime:function(){var a=this.dockedItems.get(1).items.get(15);null!=a&&a.setText(Ext.Date.format(new Date(Ext.Date.now()),"Y/m/d H:i:s"))},setButtonStatus:function(a){var b=this.dockedItems.get(1).items.get(12);b.toggle(a);b.btnClick(b,a)},setPopupInfo:function(a){var b=this.dockedItems.get(3);null!=a&&(a.use_popup?(b.setVisible(!0),this.usePopup=a.use_popup,this.popupImgPath=
a.popup_dir,this.popup_refresh_gap=a.popup_refresh_gap,null!=a.imgcols&&0<a.imgcols.trim().length&&(this.popupImgCols=a.imgcols.split(";")),null!=a.titlecols&&0<a.titlecols.trim().length&&(this.popupTitleCols=a.titlecols.split(";"))):(b.setVisible(!1),this.usePopup=!1,this.popupImgPath="",this.popupImgCols=[],this.popupTitleCols=[],this.popup_refresh_gap=600));null!=x&&x.setTimeGap(this.popup_refresh_gap);this.usePopup&&(b.header.items.get(0).toggle(!0),b.header.items.get(0).handler())},getPopupWidth:function(){var a=
this.dockedItems.get(3),b=200;null!=a&&(b=a.getWidth());return b},setPopupWidth:function(a){var b=this.dockedItems.get(3);null!=b&&b.setWidth(a)},changeIcon:function(a){var b=this.dockedItems.get(1).items.get(12);(b.pressed=a)?(b.removeCls("starttimerbutton"),b.addCls("stoptimerbutton"),b.setTooltip(f.stop_timer)):(b.removeCls("stoptimerbutton"),b.addCls("starttimerbutton"),b.setTooltip(f.start_timer))}}),D=Ext.create("DCI.Customer.SubPanel",{id:h.func_id+"Main",renderTo:"indkbPage",autoDestroy:!0,
pagetype:"kanban",border:0,bodyPadding:"0 5 5 5",layout:"border",widthChangeControls:[z,g],items:[z,g],plugins:["fittoparent"],globalRunning:!1,beforeClose:function(){null!=t&&t.stopScrollTask();null!=u&&u.stopTask();null!=x&&x.stopTask();Ext.util.CSS.removeStyleSheet(v)},focusPage:function(){this.globalRunning||(l&&u.executeTask(),q&&x.executeTask(),null!=Ext.get(this.renderTo)&&this.resize(Ext.get(this.renderTo).getWidth(),Ext.get(this.renderTo).getHeight()),null!=g&&g.setRefreshTimeTitle(u.getDisplayGap(),
f.minutes))},leavePage:function(){l&&u.stop();q&&x.stop()},globalTimerEvent:function(a,b){null!=u&&(u.stop(),null!=g&&g.changeIcon(!1));null!=x&&x.stop();null!=g&&(g.setRefreshTimeTitle(b,f.seconds),g.globalNextPage(a));this.globalRunning=!0;return g.currpage},globalTimerStop:function(){this.globalRunning=!1;l&&u.executeTask();q&&x.executeTask();null!=g&&g.setRefreshTimeTitle(u.getDisplayGap(),f.minutes)},switchToNextTab:function(){var a=!1;if(g.currpage==g.totalpage)if(g.usePopup){var b=g.getSelectionModel();
null!=b&&null!=b.lastSelected&&b.lastSelected.index%g.getStore().pageSize>=g.getStore().getCount()-1&&(a=!0)}else a=!0;else a=!1;return a},relationReload:function(a){h.relation_filter=a;this.items.get(1).getStore().gridreload(this.items.get(0),"reload")}}),C=Ext.create("Ext.data.Store",{autoLoad:!1,fields:"cols fields legend marquee refresh display combo lights popup advances relation is_cross".split(" "),proxy:{type:"ajax",url:"./../../Funcs/EKB/KanBan.dsc",actionMethods:{read:"POST"},reader:{type:"json"},
extraParams:{DCITag:n,uid:s,action:"init",sql_id:h.func_id}}}),u=E.newTask({timegap:600,displaygap:30,run:function(){null!=g&&g.nextPage()},setTimeGap:function(a){this.timegap=null==a||""==a||1>a?600:a},getTimeGap:function(){return this.timegap},setDisplayGap:function(a){this.displaygap=null==a||""==a||1>a?600:a},getDisplayGap:function(){return this.displaygap},executeTask:function(){this.start(1E3*this.timegap);l=!0;null!=g&&g.changeIcon(!0)},stopTask:function(){this.stop();l=!1;null!=g&&g.changeIcon(!1)}}),
x=E.newTask({timegap:600,run:function(){null!=g&&g.nextSelectedRow()},setTimeGap:function(a){this.timegap=null==a||""==a||1>a?600:a},executeTask:function(){this.start(1E3*this.timegap);q=!0},stopTask:function(){this.stop();q=!1}});C.load(function(a){if(0<a.length){if(null!=y){var b=a[0].get("fields").split(";");y.model.setFields(b);null!=g&&(g.setCrossDBIcon(a[0].get("is_cross")),g.initBodyGrid(u,a[0].get("cols"),y,a[0].get("relation")),g.setPopupInfo(a[0].get("popup")));null!=t&&(b=a[0].get("marquee"),
1==b.use_marquee?("1"==b.marquee_location?t.setDocked("bottom"):t.setDocked("top"),g.doLayout(),t.startMarquee(t,b.marquee_refresh_gap,b.marquee_type)):t.setVisible(!1));null!=u&&(b=a[0].get("refresh"),u.setTimeGap(b.refresh_gap),u.setDisplayGap(b.display_gap),g.setRefreshTimeTitle(b.display_gap,f.minutes),"1"==b.auto_refresh&&u.executeTask(),g.setButtonStatus("1"==b.auto_refresh));null!=w&&(w.lightsData=a[0].get("lights"));null!=w&&null!=B&&(b=a[0].get("display"),B.setCss(b),w.setComboData(a[0].get("combo")),
B.setComboData(a[0].get("combo")),w.setInitData(b),B.setInitData(b,g),g.setPopupWidth(b.popup_width));null!=r&&(r.setComboData(a[0].get("combo")),r.lightsData=a[0].get("lights"),r.setInitData(z,y,r,a[0].get("advances")));y.gridreload(z,r.condiStr)}null!=z&&(b=a[0].get("legend"),null==b||0==b.length?z.setTitle("<table><tr><td><font size='2'>"+h.func_name+"</font></td></tr></table>"):z.setTitle(a[0].get("legend").replace("$$$kn$$$",h.func_name)))}})}var l="close search save add _delete edit exit errmsg save_format to_edit to_view mode_view mode_edit no_edit_auth expand collapse refersh clear system_error ok cancel toolbar_query_title condi_col save_msg load_def_fail load_def_success load_def_result_title load_def_confirm_title load_def_confirm_msg save_fail save_success save_result_title save_fail sort_column page_size no_query no_sort asc desc refresh_gap minutes favorties_setup start_with end_with bigger bigger_equal smaller smaller_equal equal not_equal like not_like font_size row_height bg_color font_color condi_relation adv_search save_condi load_def_format load_def_condi to_excel to_html start_timer stop_timer seconds cus_format cross_db".split(" ");
this.dcistore.setMultiLangKeys(l);this.dcistore.setUid(globeuid);this.dcistore.load(function(h){if(null!=h&&1==h.length){var n=buildMultiLangObjct(l,h[0].get("langValues")),f=h[0].get("dcitagValue");Ext.EventManager.on(window,"unload",function(){"Microsoft Internet Explorer"==navigator.appName?window.navigate("./../../Login.dsc?action=logout&uid="+globeuid+"&DCITag="+f):Ext.Ajax.request({method:"POST",url:"./../../Login.dsc",params:{DCITag:f,uid:globeuid,action:"logout"}})});Ext.Ajax.request({method:"POST",
url:"./../../EKB/OpenLink/IndKanBan.dsc",params:{DCITag:f,uid:globeuid,action:"getparams",pagekey:pagekey},success:function(h){if(-1!=h.responseText.indexOf("@dcifiltererrtag@$")){if(h=h.responseText.split("$"),2<=h.length){var l=Ext.JSON.decode(h[1]);Ext.Msg.alert(n.errmsg,l.msg,function(){iserror=!0;logout(f,globeuid);window.location=l.result})}}else if(h=Ext.JSON.decode(h.responseText),!0==h.success){Ext.getDoc().dom.title=h.params.func_name;var A={};A.func_id=h.params.func_id;A.func_name=h.params.func_name;
A.conn_id=h.params.conn_id;A.relation_filter=h.params.relation_filter;q(A,f,n,globeuid)}else Ext.Msg.alert(n.errmsg,n.kanban_not_exist)}})}})});
