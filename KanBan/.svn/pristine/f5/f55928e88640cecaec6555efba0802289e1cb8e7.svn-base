function allNodeLoaded(h,t){var b=!0,n=null;null==t&&(t=h.getRootNode());if(t.hasChildNodes())for(var n=t.childNodes,s=0;s<n.length&&!(b=allNodeLoaded(h,n[s]),!b);s++);else b=t.isLeaf()?!0:t.isLoaded();return b}
function showIndexPage(h,t,b,n){function s(a,b){b&&(r="");for(var d=null,c=a.childNodes,e=0;e<c.length;e++)d="",d+=c[e].data.id,d=b?d+",":d+(","+c[e].parentNode.data.id),d+=","+c[e].data.lang_key,d+=","+c[e].parentNode.indexOf(c[e]),d+=","+c[e].data.leaf,r=""==r?d:r+(";"+d),!c[e].data.leaf&&c[e].hasChildNodes()&&s(c[e],!1)}var C="TreeModel-Configs TreeModel-LKB TreeModel-ET_FOLDER TreeModel-WF_FOLDER TreeModel-SM_FOLDER TreeModel-EF_FOLDER TreeModel-WPP TreeModel-TT_FOLDER".split(" "),m=null,u=(new Ext.util.TaskRunner).newTask({timegap:900,
run:function(){try{var a=null,b=!1,d=!1;if(null!=mainPanel){for(var c=0;c<mainPanel.items.length;c++)if("EKB"==mainPanel.items.get(c).tabPackage)if(null==m){m=mainPanel.items.get(c).id;a=Ext.getCmp(m.substring(3)+"Main");a.globalTimerEvent(-1,this.timegap);mainPanel.setActiveTab(m);d=!0;break}else if(m==mainPanel.items.get(c).id||b)if(b){m=mainPanel.items.get(c).id;a=Ext.getCmp(m.substring(3)+"Main");a.globalTimerEvent(-1,this.timegap);mainPanel.setActiveTab(m);d=!0;break}else if(a=Ext.getCmp(m.substring(3)+
"Main"),a.switchToNextTab())b=!0;else{a.globalTimerEvent(0,this.timegap);mainPanel.setActiveTab(m);d=!0;break}if(!d)for(c=0;c<mainPanel.items.length;c++)if("EKB"==mainPanel.items.get(c).tabPackage){m=mainPanel.items.get(c).id;a=Ext.getCmp(m.substring(3)+"Main");a.globalTimerEvent(-1,this.timegap);mainPanel.setActiveTab(m);break}}}catch(e){window.console&&console.log(e.message)}},setTimeGap:function(a){if(null==a||""==a||1>a)a=600;this.timegap=a},getTimeGap:function(){return this.timegap},executeTask:function(){this.start(1E3*
this.timegap);null!=x&&x.changeIcon(!0)},stopTask:function(){null!=mainPanel.getActiveTab()&&"EKB"==mainPanel.getActiveTab().tabPackage&&Ext.getCmp(mainPanel.getActiveTab().id.substring(3)+"Main").globalTimerStop();this.stop();null!=x&&x.changeIcon(!1);m=null}});Ext.define("TreeModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"string"},{name:"text",type:"string"},{name:"level",type:"int"},{name:"leaf",type:"boolean"},{name:"url",type:"string"},{name:"parent",type:"string"},{name:"lang_key",
type:"string"},{name:"func_package",type:"string"},{name:"can_edit",type:"string"},{name:"init_load_expanded",type:"string"}]});var I=Ext.create("Ext.data.Store",{autoLoad:!1,checkSession:!1,fields:"dblistvalue userInfo pageTimerGap hasfavor sysMarquee hascus".split(" "),proxy:{type:"ajax",url:"./../../Funcs/Main/Index.dsc",actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{DCITag:h,uid:n,action:"init"}}}),y=new Ext.data.Store({fields:["label","value"],autoLoad:!1,proxy:{type:"memory",
reader:{type:"json"}}}),w=new Ext.data.Store({fields:["uid","uname","gname","ltime"],autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}}),k=Ext.create("Ext.form.field.ComboBox",{store:y,queryMode:"local",displayField:"label",valueField:"value",width:125,x:62,y:5,typeAhead:!0,editable:!1,listeners:{change:function(a,b,d,c){"undefined"!==typeof l&&null!=l&&(l.getRootNode().removeAll(),l.getProxy().extraParams.connid=b,l.load());"undefined"!==typeof f&&null!=f&&(f.getRootNode().removeAll(),f.getProxy().extraParams.connid=
b,f.load())}}}),l=Ext.create("Ext.data.TreeStore",{model:"TreeModel",autoLoad:!1,proxy:{type:"ajax",url:"./../../Funcs/Main/Index.dsc",actionMethods:{read:"POST"},reader:{type:"json",root:"datas"},extraParams:{DCITag:h,action:"tree",uid:n,connid:""}},root:{text:b.func_tree_root,id:"FuncTreeRoot"}}),p=Ext.create("Ext.tree.Panel",{rootVisible:!0,viewConfig:{loadMask:!0,plugins:{ptype:"treeviewdragdrop",ddGroup:"ddgroup",sortOnDrop:!0,containerScroll:!0}},useArrows:!0,store:l,tbar:[{xtype:"button",iconCls:"savebutton_tree",
tooltip:b.save,handler:function(){s(p.getRootNode(),!0);null!=r&&""!=r&&Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:h,action:"save",uid:n,connid:k.getValue(),treeArr:r},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=a.responseText.split("$"),2<=a.length){var g=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,g.msg,function(){iserror=!0;window.location=g.result})}}else a=Ext.JSON.decode(a.responseText),a.success[0].result?(p.setCusIcon(),
Ext.MessageBox.alert(b.save_result_title,b.save_success)):Ext.MessageBox.alert(b.save_result_title,b.save_fail)},failure:function(a,g){Ext.MessageBox.alert(b.errmsg,b.system_error)}})}},{xtype:"button",iconCls:"refreshbutton_tree",tooltip:b.refersh,handler:function(){var a=k.getValue();if("undefined"!==typeof l&&null!=l){var b=allNodeLoaded(p,null);!l.isLoading()&&b&&(l.getRootNode().removeAll(),l.getProxy().extraParams.connid=a,l.load())}}},{xtype:"button",iconCls:"addfolderbutton",tooltip:b.add,
handler:function(){if(p.getSelectionModel().hasSelection()){var a=p.getSelectionModel().getSelection(),g={id:(new Date).getTime(),leaf:!1};a[0].data.leaf?l.getNodeById(a[0].data.parent).appendChild(g):a[0].appendChild(g);l.getNodeById(g.id).data.lang_key="lang"+g.id;Ext.MessageBox.show({title:b.add_folder_title,msg:b.node_lang_panel,width:300,buttons:Ext.MessageBox.OKCANCEL,multiline:!0,fn:function(a,c){if("ok"==a){var e=l.getNodeById(g.id);e.set("text",c);s(p.getRootNode(),!0);Ext.Ajax.request({method:"POST",
url:"./../../Funcs/Main/Index.dsc",params:{DCITag:h,action:"savelang",uid:n,connid:k.getValue(),langkey:e.data.lang_key,langvalue:c,treeArr:r},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=a.responseText.split("$"),2<=a.length){var g=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,g.msg,function(){iserror=!0;window.location=g.result})}}else a=Ext.JSON.decode(a.responseText),a.success[0].result?Ext.MessageBox.alert(b.add_result_title,b.add_success):Ext.MessageBox.alert(b.add_result_title,
b.add_fail)},failure:function(a,g){Ext.MessageBox.alert(b.errmsg,b.system_error)}})}else e=l.getNodeById(g.id),e.remove()}})}else Ext.MessageBox.alert(b.errmsg,b.no_f_node_selected)}},{xtype:"button",iconCls:"deletebutton_tree",tooltip:b._delete,handler:function(){p.getSelectionModel().hasSelection()&&Ext.MessageBox.confirm(b.delete_confirm_title,b.delete_confirm_msg,function(a){"yes"==a&&(a=p.getSelectionModel().getSelection()[0],hasChildNodes()||a.remove(),s(p.getRootNode(),!0),Ext.Ajax.request({method:"POST",
url:"./../../Funcs/Main/Index.dsc",params:{DCITag:h,action:"save",uid:n,connid:k.getValue(),treeArr:r},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=a.responseText.split("$"),2<=a.length){var d=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,d.msg,function(){iserror=!0;window.location=d.result})}}else a=Ext.JSON.decode(a.responseText),a.success[0].result?(p.setCusIcon(),Ext.MessageBox.alert(b.delete_result_title,b.delete_success)):Ext.MessageBox.alert(b.delete_result_title,
b.delete_fail)},failure:function(a,d){Ext.MessageBox.alert(b.errmsg,b.system_error)}}))})}},{xtype:"button",iconCls:"clearbutton_tree",tooltip:b.clear_user_folder_title,handler:function(){Ext.MessageBox.show({title:b.clear_user_folder_title,msg:b.clear_user_folder,width:300,buttons:Ext.MessageBox.OKCANCEL,fn:function(a,g){"ok"==a&&Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:h,action:"clean",uid:n,connid:k.getValue()},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=
a.responseText.split("$"),2<=a.length){var g=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,g.msg,function(){iserror=!0;window.location=g.result})}}else"undefined"!==typeof l&&null!=l&&(l.getRootNode().removeAll(),l.getProxy().extraParams.connid=k.getValue(),l.load()),a=Ext.JSON.decode(a.responseText),a.success[0].result?(p.rmCusIcon(),Ext.MessageBox.alert(b.clear_result_title,b.clear_success)):Ext.MessageBox.alert(b.clear_result_title,b.clear_fail)},failure:function(a,g){Ext.MessageBox.alert(b.errmsg,
b.system_error)}})}})}},{xtype:"button",iconCls:"collapseAllbutton_tree",tooltip:b.collapse,handler:function(){p.collapseAll()}},{xtype:"button",iconCls:"expandAllbutton_tree",tooltip:b.expand,handler:function(){p.expandAll()}},{xtype:"button",iconCls:"addfavoritebutton",tooltip:b.add_favorite,handler:function(){if(p.getSelectionModel().hasSelection()&&null!=f){var a=p.getSelectionModel().getSelection();if(null==f.getNodeById(a[0].data.id)){if(a[0].data.leaf){var g={id:a[0].data.id,leaf:a[0].data.leaf,
parent:null,lang_key:a[0].data.lang_key,text:a[0].data.text};f.getRootNode().appendChild(g)}else Ext.MessageBox.alert(b.errmsg,b.not_program);g=0;null!=f.getRootNode()&&null!=f.getRootNode().childNodes&&(g=f.getRootNode().childNodes.length);Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:h,action:"savefavor",uid:n,connid:k.getValue(),treeArr:a[0].data.id+",,"+a[0].data.lang_key+","+g+","+a[0].data.leaf}})}else Ext.MessageBox.alert(b.errmsg,b.favor_exist)}}}],listeners:{itemdblclick:function(a,
b,d,c,e,D){b.data.leaf&&mainPanel.beforeAddCheck(b.data.id,k.getValue(),b.data,!1)},afteritemexpand:function(a,b,d,c){!a.isRoot()&&(existInArray(C,a.id)&&!a.hasChildNodes())&&(b=a.parentNode,null!=b&&b.removeChild(a))},load:function(a,b,d,c,e){if(b.isRoot())try{this.expandAll()}catch(D){window.console&&console.log(D.message)}}},setCusIcon:function(){var a=this.getDockedItems('toolbar[dock="top"]')[0].items.get(4);null!=a&&a.getEl().setStyle({borderWidth:"2px 2px 2px 2px",borderColor:"red",boderStyle:"solid"})},
rmCusIcon:function(){var a=this.getDockedItems('toolbar[dock="top"]')[0].items.get(4);null!=a&&a.getEl().setStyle({borderWidth:"1px 1px 1px 1px",borderColor:"",boderStyle:""})}}),f=Ext.create("Ext.data.TreeStore",{model:"TreeModel",autoLoad:!1,proxy:{type:"ajax",url:"./../../Funcs/Main/Index.dsc",actionMethods:{read:"POST"},reader:{type:"json",root:"datas"},extraParams:{DCITag:h,action:"favor",uid:n,connid:""}},root:{text:b.func_tree_root,id:"FuncTreeRoot"}}),q=Ext.create("Ext.tree.Panel",{rootVisible:!0,
viewConfig:{loadMask:!0,plugins:{ptype:"treeviewdragdrop",ddGroup:"ddgroup",sortOnDrop:!0,containerScroll:!0}},useArrows:!0,store:f,tbar:[{xtype:"button",iconCls:"savebutton_tree",tooltip:b.save,handler:function(){s(q.getRootNode(),!0);null!=r&&""!=r&&Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:h,action:"savefavor",uid:n,connid:k.getValue(),treeArr:r},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=a.responseText.split("$"),2<=a.length){var g=
Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,g.msg,function(){iserror=!0;window.location=g.result})}}else a=Ext.JSON.decode(a.responseText),a.success[0].result?(q.setCusIcon(),Ext.MessageBox.alert(b.save_result_title,b.save_success)):Ext.MessageBox.alert(b.save_result_title,b.save_fail)},failure:function(a,g){Ext.MessageBox.alert(b.errmsg,b.system_error)}})}},{xtype:"button",iconCls:"refreshbutton_tree",tooltip:b.refresh,handler:function(){if("undefined"!==typeof f&&null!=f){var a=allNodeLoaded(q,
null);!f.isLoading()&&a&&(f.getRootNode().removeAll(),f.getProxy().extraParams.connid=k.getValue(),f.load())}}},{xtype:"button",iconCls:"addfolderbutton",tooltip:b.add,handler:function(){if(q.getSelectionModel().hasSelection()){var a=q.getSelectionModel().getSelection(),g={id:(new Date).getTime(),leaf:!1};a[0].data.leaf?f.getNodeById(a[0].data.parent).appendChild(g):a[0].appendChild(g);f.getNodeById(g.id).data.lang_key="lang"+g.id;Ext.MessageBox.show({title:b.add_folder_title,msg:b.node_lang_panel,
width:300,buttons:Ext.MessageBox.OKCANCEL,multiline:!0,fn:function(a,c){if("ok"==a){var e=f.getNodeById(g.id);e.set("text",c);s(q.getRootNode(),!0);Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:h,action:"savelangfavor",uid:n,connid:k.getValue(),langkey:e.data.lang_key,langvalue:c,treeArr:r},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=a.responseText.split("$"),2<=a.length){var c=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,c.msg,
function(){iserror=!0;window.location=c.result})}}else a=Ext.JSON.decode(a.responseText),a.success[0].result?Ext.MessageBox.alert(b.add_result_title,b.add_success):Ext.MessageBox.alert(b.add_result_title,b.add_fail)},failure:function(a,c){Ext.MessageBox.alert(b.errmsg,b.system_error)}})}else e=f.getNodeById(g.id),e.remove()}})}else Ext.MessageBox.alert(b.errmsg,b.no_f_node_selected)}},{xtype:"button",iconCls:"deletebutton_tree",tooltip:b._delete,handler:function(){Ext.MessageBox.confirm(b.delete_confirm_title,
b.delete_confirm_msg,function(a){"yes"==a&&q.getSelectionModel().hasSelection()&&(q.getSelectionModel().getSelection()[0].remove(),s(q.getRootNode(),!0),Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:h,action:"savefavor",uid:n,connid:k.getValue(),treeArr:r},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=a.responseText.split("$"),2<=a.length){var d=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,d.msg,function(){iserror=!0;window.location=
d.result})}}else a=Ext.JSON.decode(a.responseText),a.success[0].result?(q.setCusIcon(),Ext.MessageBox.alert(b.delete_result_title,b.delete_success)):Ext.MessageBox.alert(b.delete_result_title,b.delete_fail)},failure:function(a,d){Ext.MessageBox.alert(b.errmsg,b.system_error)}}))})}},{xtype:"button",iconCls:"clearbutton_tree",tooltip:b.clear_favor_folder_title,handler:function(){Ext.MessageBox.show({title:b.clear_favor_folder_title,msg:b.clear_favor_folder,width:300,buttons:Ext.MessageBox.OKCANCEL,
fn:function(a,g){"ok"==a&&Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:h,action:"cleanfavor",uid:n,connid:k.getValue()},success:function(a){if(-1!=a.responseText.indexOf("@dcifiltererrtag@$")){if(a=a.responseText.split("$"),2<=a.length){var c=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,c.msg,function(){iserror=!0;window.location=c.result})}}else"undefined"!==typeof f&&null!=f&&(f.getRootNode().removeAll(),f.getProxy().extraParams.connid=k.getValue(),f.load()),
a=Ext.JSON.decode(a.responseText),a.success[0].result?(q.rmCusIcon(),Ext.MessageBox.alert(b.clear_result_title,b.clear_success)):Ext.MessageBox.alert(b.clear_result_title,b.clear_fail)},failure:function(a,c){Ext.MessageBox.alert(b.errmsg,b.system_error)}})}})}},{xtype:"button",iconCls:"collapseAllbutton_tree",tooltip:b.collapse,handler:function(){q.collapseAll()}},{xtype:"button",iconCls:"expandAllbutton_tree",tooltip:b.expand,handler:function(){q.expandAll()}}],listeners:{itemdblclick:function(a,
b,d,c,e,f){b.data.leaf&&mainPanel.addKanBanTab(b.data.id,k.getValue(),b.data,!1)},afteritemexpand:function(a,b,d,c){!a.isRoot()&&(existInArray(C,a.id)&&!a.hasChildNodes())&&(b=a.parentNode,null!=b&&b.removeChild(a))},load:function(a,b,d,c,e){if(b.isRoot())try{this.expandAll()}catch(f){window.console&&console.log(f.message)}}},setCusIcon:function(){var a=this.getDockedItems('toolbar[dock="top"]')[0].items.get(4);null!=a&&a.getEl().setStyle({borderWidth:"2px 2px 2px 2px",borderColor:"red",boderStyle:"solid"})},
rmCusIcon:function(){var a=this.getDockedItems('toolbar[dock="top"]')[0].items.get(4);null!=a&&a.getEl().setStyle({borderWidth:"1px 1px 1px 1px",borderColor:"",boderStyle:""})}});mainPanel=Ext.create("Ext.tab.Panel",{region:"center",xtype:"tabpanel",deferredRender:!1,bodyStyle:{background:"#EEF5FC"},listeners:{tabchange:function(a,b,d,c){null!=b&&null!=d&&(a=Ext.getCmp(d.getId().substring(3)+"Main"),b=Ext.getCmp(b.getId().substring(3)+"Main"),null!=a&&"kanban"==a.pagetype&&a.leavePage(),null!=b&&
b.focusPage())},resize:function(a,b,d,c,e,f){if(null!=a.getActiveTab()){e=c=null;for(f=0;f<a.items.length;f++)e=a.items.get(f),a.getActiveTab().getId()==e.getId()&&(c=Ext.getCmp(e.getId().substring(3)+"Main"),null!=c&&c.resize(b-20,d-a.getTabBar().getHeight()-2)),c=Ext.get(e.getId().substring(3)+"Page"),null!=c&&(c.setWidth(b-20),c.setHeight(d-a.getTabBar().getHeight()-2))}}},beforeAddCheck:function(a,g,d,c){var e="",f=this,l="tab"+a,k=!1;null!=d&&(e=d.func_package);for(var m=0;m<f.items.length&&
!k;m++)if(f.items.getAt(m).id==l){k=!0;break}"EKB"==e&&!k?Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:h,action:"kanbanCheck",uid:n,func_id:a,conn_id:g},success:function(e){if(-1!=e.responseText.indexOf("@dcifiltererrtag@$")){if(e=e.responseText.split("$"),2<=e.length){var h=Ext.JSON.decode(e[1]);Ext.Msg.alert(b.errmsg,h.msg,function(){iserror=!0;window.location=h.result})}}else e=Ext.JSON.decode(e.responseText),"true"==e.result[0].success?f.addKanBanTab(a,g,d,
c):Ext.Msg.alert(b.errmsg,b.kanban_not_exist)}}):f.addKanBanTab(a,g,d,c)},addKanBanTab:function(a,g,d,c){u.stopTask();var e=this,f="tab"+a,h=!1,k="",l="0",m="",p="";null!=d&&(k=d.text,m=d.url,p=d.func_package,l=d.can_edit);for(var q=0;q<e.items.length&&!h;q++)if(e.items.getAt(q).id==f){h=!0;break}h||(functab=Ext.create("Ext.panel.Panel",{id:f,title:k,closable:!0,autoScroll:!0,tabPackage:p,bodyStyle:{background:"#eaf1fb"},loader:{url:m,scripts:!0,params:{forwardTag:t,func_id:a,func_name:k,conn_id:g,
canEdit:l,filter:d.filter,uid:n},listeners:{exception:function(a,c,g,d){Ext.Msg.alert(b.errmsg,b.load_fail);e.remove(functab)},load:function(a,c,g,d){if(100>c.responseText.length&&-1!=c.responseText.indexOf("@dcifiltererrtag@$")&&(a=c.responseText.split("$"),2<=a.length)){var f=Ext.JSON.decode(a[1]);Ext.Msg.alert(b.errmsg,f.msg,function(){iserror=!0;null!=f.result&&0<f.result.length?window.location=f.result:e.remove(functab)})}}}},listeners:{added:function(a){a.loader.load()},beforeclose:function(a,
c){if(null!=a){var g=Ext.getCmp(a.id.substring(3)+"Main");if(null!=g){var d=!1;if(null!=g.items)for(var f=0;f<g.items.length&&!("function"==typeof g.items.get(f).getCurrMode&&(d=g.items.get(f).getCurrMode()==PageMode.Edit||g.items.get(f).getCurrMode()==PageMode.Add));f++);d?Ext.MessageBox.confirm(b.confirm_title,b.data_lose_warning,function(b){"yes"==b&&(g.beforeClose(),e.remove(a))}):(g.beforeClose(),e.remove(a));return!1}}}}}),e.add(functab));h&&c&&(a=Ext.getCmp(a+"Main"),null!=a&&null!=d&&a.relationReload(d.filter));
e.setActiveTab(f)}});var E=Ext.create("Ext.form.Label",{xtype:"label",text:"",margin:"0 0 0 5",x:90,y:5}),F=Ext.create("Ext.form.Label",{xtype:"label",text:"",margin:"0 0 0 5",x:250,y:5}),G=Ext.create("Ext.form.Label",{xtype:"label",text:"",margin:"0 0 0 5",x:250,y:30}),H=Ext.create("Ext.form.Label",{xtype:"label",text:"",margin:"0 0 0 5",x:90,y:30}),z=Ext.create("Ext.panel.Panel",{region:"north",xtype:"panel",height:30,margins:"0 5 5 5",layout:"absolute",border:!1,split:!1,items:[{xtype:"label",
text:b.conn_target,margin:"0 0 0 2",width:60,x:0,y:8},k,{xtype:"button",iconCls:"refreshbutton_tree",tooltip:b.refersh,x:188,y:5,handler:function(){var a=k.getValue();Ext.create("Ext.data.Store",{autoLoad:!1,checkSession:!1,fields:["dblistvalue"],proxy:{type:"ajax",url:"./../../Funcs/Main/Index.dsc",actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{DCITag:h,uid:n,action:"dblist"}}}).load(function(b){y.loadData(b[0].get("dblistvalue"));k.setValue(a)})}}]}),A=Ext.create("Ext.panel.Panel",
{title:b.functions,xtype:"panel",margins:"0 0 0 0",border:!1,split:!1,layout:"fit",items:[p],setCusIcon:function(){this.items.get(0).setCusIcon()}}),v=Ext.create("Ext.panel.Panel",{xtype:"panel",title:b.favorties,margins:"0 0 0 0",border:!1,split:!1,layout:"fit",items:[q]}),v=Ext.create("Ext.panel.Panel",{region:"center",margins:"0 0 0 0",border:!1,split:!1,layout:{type:"accordion",titleCollapse:!1,animate:!0},items:[A,v]}),z=Ext.create("Ext.panel.Panel",{region:"west",stateId:"funcPanel",title:b.tree_panel_title,
split:!0,splitterResize:!1,width:220,collapsible:!0,animCollapse:!1,layout:"border",border:!1,items:[z,v]}),v=Ext.create("Ext.panel.Panel",{region:"west",xtype:"panel",layout:"absolute",margins:"0 0 0 0",width:400,bodyStyle:{background:"#EEF5FC"},border:!1,split:!1,items:[{xtype:"label",text:b.user_id,margin:"0 0 0 5",x:5,y:5},E,{xtype:"label",text:b.user_name,margin:"0 0 0 5",x:170,y:5},F,{xtype:"label",text:b.group_name,margin:"0 0 0 5",x:5,y:30},H,{xtype:"label",text:b.login_time,margin:"0 0 0 5",
x:170,y:30},G]}),J=Ext.create("Ext.panel.Panel",{region:"center",xtype:"panel",layout:"absolute",margins:"0 0 0 0",bodyStyle:{background:"#EEF5FC"},border:!1,split:!1}),x=Ext.create("Ext.panel.Panel",{region:"east",xtype:"panel",margins:"0 0 0 0",split:!1,layout:"absolute",border:!1,bodyStyle:{background:"#EEF5FC"},items:[{xtype:"button",cls:"starttimerbutton24",tooltip:b.kanban_loop,enableToggle:!0,x:10,y:10,width:35,height:35,handler:function(){var a=this;if(a.pressed){var g=mainPanel.getActiveTab();
if(null==g)Ext.MessageBox.alert(b.errmsg,b.no_kanban_can_show),a.pressed=!1;else{var d=!1;Ext.Ajax.request({method:"POST",url:"./../../Funcs/Main/Index.dsc",params:{DCITag:h,uid:n,action:"pageTaskGap"},success:function(c){if(-1!=c.responseText.indexOf("@dcifiltererrtag@$")){if(c=c.responseText.split("$"),2<=c.length){var e=Ext.JSON.decode(c[1]);Ext.Msg.alert(b.errmsg,e.msg,function(){iserror=!0;window.location=e.result})}}else{c=Ext.JSON.decode(c.responseText);u.setTimeGap(c.result[0].gap);if(null!=
g&&"EKB"==g.tabPackage)m=mainPanel.getActiveTab().id,c=Ext.getCmp(m.substring(3)+"Main"),c.globalTimerEvent(-1,u.getTimeGap()),d=!0;else for(c=0;c<mainPanel.items.length;c++)if("EKB"==mainPanel.items.get(c).tabPackage){m=mainPanel.items.get(c).id;c=Ext.getCmp(m.substring(3)+"Main");c.globalTimerEvent(-1,u.getTimeGap());mainPanel.setActiveTab(m);d=!0;break}d?u.executeTask():(Ext.MessageBox.alert(b.errmsg,b.no_kanban_can_show),a.pressed=!1)}},failure:function(c,g){Ext.MessageBox.alert(b.errmsg,b.get_task_gap_fail);
a.pressed=!1}})}}else u.stopTask()}},{xtype:"button",cls:"logoutbutton",tooltip:b.logout,x:50,y:10,width:35,height:35,handler:function(){Ext.MessageBox.confirm(b.confirm_title,b.logout_confirm,function(a){"yes"==a&&(islogout=!0,logout(h))})}}],changeIcon:function(a){var b=this.items.get(0);(b.pressed=a)?(b.removeCls("starttimerbutton24"),b.addCls("stoptimerbutton24")):(b.removeCls("stoptimerbutton24"),b.addCls("starttimerbutton24"))}}),v=Ext.create("Ext.panel.Panel",{region:"north",xtype:"panel",
header:!1,height:50,split:!0,splitterResize:!1,collapsible:!0,collapseMode:"mini",animCollapse:!1,margins:"0 0 0 0",layout:"border",bodyStyle:{background:"#EEF5FC"},items:[v,J,x]}),B=Ext.create("Ext.panel.Panel",{region:"south",xtype:"panel",header:!1,height:40,iheight:40,split:!0,splitterResize:!1,collapsible:!0,collapseMode:"mini",animCollapse:!1,dataTask:null,scrollTask:null,collapseBySys:!1,collapseByUser:!1,showType:"1",bodyStyle:{background:"#EEF5FC"},syscollapse:function(){this.collapseBySys=
!0;this.collapse(!0);this.collapseBySys=!1},sysexpand:function(){this.collapseByUser||this.expand(!0)},listeners:{collapse:function(a,b){a.collapseBySys||(a.collapseByUser=!0)},expand:function(a,b){a.collapseByUser=!1}},startMarquee:function(a,b){function d(){null!=k&&k.load(function(a){if(0<a.length){var d="";c.sysexpand();if("1"==b){for(var e=0;e<a.length;e++)d=0==e?'<div style="font-size:22px;"><Marquee height="'+c.iheight+'" scrollamount="3" onmouseover="this.stop()" onmouseout="this.start()">'+
a[e].get("message"):d+("                              "+a[e].get("message")),e==a.length-1&&(d+="</div></Marquee>");c.update(d)}else{null!=c.scrollTask&&(c.scrollTask.stop(),c.body.dom.scrollTop=0);for(var f="",e=0;e<a.length;e++)0==e?(f='<div style="font-size:22px;text-align:center;overflow:hidden;height:'+c.iheight+'px;">'+a[e].get("message")+"</div>",d="<div>"+f):d+='<div  style="font-size:22px;text-align:center;overflow:hidden;height:'+c.iheight+'px;">'+a[e].get("message")+"</div>",e==a.length-
1&&(d+=f+"</div>");c.update(d);null!=c.scrollTask&&c.scrollTask.start(5E3)}}else null!=c.scrollTask&&(c.scrollTask.stop(),c.body.dom.scrollTop=0),c.update("")})}var c=this,e=new Ext.util.TaskRunner,f=null;c.syscollapse();var k=Ext.create("Ext.data.Store",{autoLoad:!1,fields:["message"],proxy:{type:"ajax",url:"./../../Funcs/Main/Index.dsc",actionMethods:{read:"POST"},reader:{root:"marquee"},extraParams:{DCITag:h,uid:n,action:"marqueeData"}}}),l=0;"2"==b?(null==f&&(f=e.newTask({run:function(){0<k.getCount()&&
(0==l&&(c.body.dom.scrollTop=0),l==k.getCount()-1?l=0:l++,c.scrollBy(0,c.iheight,!0))}})),c.scrollTask=f,f.start(5E3)):c.scrollTask=null;this.dataTask=e=e.newTask({run:function(){d()}});d();e.start(1E3*a)}});Ext.create("Ext.Viewport",{layout:"border",items:[z,v,mainPanel,B],listenres:[{disable:function(a,b){logout(h)}}]});I.load(function(a){if(1==a.length){u.setTimeGap(a[0].get("pageTimerGap")[0].gap);y.loadData(a[0].get("dblistvalue"));w.loadData(a[0].get("userInfo"));if(0<y.getCount()&&"undefined"!=
typeof k&&null!=k){var b=y.getAt(0).get("value");k.setValue(b);l.getRootNode().expand();f.getRootNode().expand()}0<w.getCount()&&(E.setText(" : "+w.getAt(0).get("uid")),F.setText(" : "+w.getAt(0).get("uname")),G.setText(" : "+w.getAt(0).get("ltime")),H.setText(" : "+w.getAt(0).get("gname")));null!=A&&"true"==a[0].get("hasfavor")[0].hasfavor.toLowerCase()&&A.collapse(!0);null!=p&&null!=q&&(b=a[0].get("hascus")[0],"true"==b.hasdefcus.toLowerCase()&&p.setCusIcon(),"true"==b.hasfavcus.toLowerCase()&&
q.setCusIcon());null!=B&&B.startMarquee(a[0].get("sysMarquee")[0].marquee_refresh_gap,a[0].get("sysMarquee")[0].marquee_type)}});var r=""}function logout(h){Ext.Ajax.request({method:"POST",url:"./../../Login.dsc",params:{DCITag:h,uid:idxuid,action:"logout"},success:function(h){Ext.JSON.decode(h.responseText).success?window.location.href="./../../":Ext.MessageBox.alert(langs.errmsg,langs.logout_fail)},failure:function(h,b){Ext.MessageBox.alert(langs.errmsg,langs.logout_fail)}})}
function logoutF(h){"Microsoft Internet Explorer"==navigator.appName?window.navigate("./../../Login.dsc?action=logout&uid="+idxuid+"&DCITag="+h):Ext.Ajax.request({method:"POST",url:"./../../Login.dsc",params:{DCITag:h,uid:idxuid,action:"logout"}})};
