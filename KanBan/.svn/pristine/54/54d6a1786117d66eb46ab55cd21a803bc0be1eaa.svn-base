function trimStr(a){for(var b=-1,c=a.length;33>a.charCodeAt(--c););for(;33>a.charCodeAt(++b););return a.slice(b,c+1)}function BuildComboboxStore(a,b){Ext.define("comboboxModel",{extend:"Ext.data.Model",fields:[{name:"label",type:"string"},{name:"value",type:"string"}]});return new Ext.data.Store({id:"ComboboxStore",model:"comboboxModel",autoLoad:!1,proxy:{type:"ajax",url:a,actionMethods:{read:"POST"},reader:{type:"json",root:"values"},extraParams:b}})}
Ext.define("DCI.LKB.Customer.OpenWinTrigger",{extend:"Ext.form.field.Trigger",alias:"DCI.OpenWinTrigger",multiSelect:!1,displayColumns:[],returnColumn:"",openWinDataUrl:"",openWinParams:{},depComps:[],ouid:"",onTriggerClick:function(){if(""==this.id)alert("元件設定錯誤");else{for(var a=null,b=null,c=0;c<this.depComps.length;c++)b=-1==this.depComps[c].indexOf("_")?this.depComps[c]:this.depComps[c].substring(0,this.depComps[c].indexOf("_")),this.openWinParams.hasOwnProperty(b)&&(a=Ext.getCmp(this.depComps[c]),
null!=a&&(this.openWinParams[b]=a.getValue()));this.openWinParams.uid=this.ouid;createOpenWin(this,this.multiSelect,this.displayColumns,this.returnColumn,this.openWinDataUrl,this.openWinParams).show()}}});
function createOpenWin(a,b,c,d,e,f){b=null;var k=[];b=[];k.push({name:"selected",type:"bool"});b.push({xtype:"checkcolumn",text:"選擇",dataIndex:"selected"});for(var l=0;l<c.length;l++)k.push({name:c[l][0],type:"string"}),b.push({text:c[l][1],dataIndex:c[l][0]});c=Ext.define("WinModel",{extend:"Ext.data.Model",fields:k});var h=new Ext.data.Store({id:"WinStore",model:c,autoLoad:!1,proxy:{type:"ajax",url:e,actionMethods:{read:"POST"},reader:{type:"json",root:"items"},extraParams:f}});e=Ext.create("Ext.grid.Panel",
{renderer:"component",stripeRows:!0,store:h,autoScroll:!0,columns:b});h.load();return b=Ext.create("Ext.window.Window",{title:"開窗",width:500,height:300,minWidth:300,minHeight:200,layout:"fit",plain:!0,modal:!0,items:e,buttons:[{text:"確定",handler:function(){var b="";if(0!=h.getCount())for(var c=null,e=null,e=d.split(";"),l=0;l<h.getCount();l++)if(c=h.getAt(l),c.get("selected")){if(""==b)for(var f=0;f<e.length;f++)b=0==f?trimStr(c.get(e[f])):1==f?b+("("+trimStr(c.get(e[f]))):b+(","+trimStr(c.get(e[f])));
else{b+=";";for(f=0;f<e.length;f++)b=0==f?b+trimStr(c.get(e[f])):1==f?b+("("+trimStr(c.get(e[f]))):b+(","+trimStr(c.get(e[f])))}1<e.length&&(b+=")")}a.setValue(b);this.up(".window").close()}},{text:"取消",handler:function(){this.up(".window").close()}}]})}var PageMode=buildMultiLangObjct(["View","Edit","Add"],["View","Edit","Add"]);Ext.define("DCI.Customer.Img",{extend:"Ext.Img",alias:"DCI.Customer.Img",width:50,height:50,loadDefault:function(){this.setSrc("")},setReadOnly:function(a){}});
Ext.define("DCI.Customer.FileField",{extend:"Ext.form.field.File",alias:"DCI.Customer.FileField",buttonText:"",buttonConfig:{iconCls:"upload-icon"},emptyText:"",defaultvalue:"",ispk:!1,canEdit:!0,loadDefault:function(){},setReadOnly:function(a){this.readOnly=a;this.setDisabled(a)}});
Ext.define("DCI.Customer.TextField",{extend:"Ext.form.field.Text",alias:"DCI.Customer.TextField",msgTarget:"side",oriAllowBlank:!1,defaultvalue:"",ispk:!1,canEdit:!0,cusStyle:null,loadDefault:function(){this.setValue(this.defaultvalue)},setReadOnly:function(a){a?(this.allowBlank=!0,this.setFieldStyle({backgroundColor:"#ddd",backgroundImage:"none"})):(this.allowBlank=this.oriAllowBlank,null!=this.cusStyle&&""!=this.cusStyle?this.setFieldStyle(this.cusStyle):this.setFieldStyle({backgroundColor:"#FFFFFF"}));
this.callParent(arguments)},initComponent:function(){this.oriAllowBlank=this.allowBlank;null!=this.style&&(this.cusStyle=this.style);this.callParent(arguments)}});
Ext.define("DCI.Customer.ComboBox",{extend:"Ext.form.field.ComboBox",alias:"DCI.Customer.ComboBox",displayField:"label",valueField:"value",typeAhead:!0,editable:!1,queryMode:"local",matchFieldWidth:!1,multiSelect:!1,forceSelection:!0,store:{fields:["label","value"],autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}},defaultvalue:"",ispk:!1,canEdit:!0,cusStyle:null,loadDefault:function(){null!=this.store&&0<this.store.getCount()&&(null==this.defaultvalue||""==this.defaultvalue?this.setValue(this.store.getAt(0).get("value")):
this.setValue(this.defaultvalue))},setReadOnly:function(a){a?this.setFieldStyle({backgroundColor:"#ddd",backgroundImage:"none"}):null!=this.cusStyle&&""!=this.cusStyle?this.setFieldStyle(this.cusStyle):this.setFieldStyle({backgroundColor:"#FFFFFF"});this.callParent(arguments)},initComponent:function(){null!=this.style&&(this.cusStyle=this.style);this.callParent(arguments)}});
Ext.define("DCI.Customer.HeadFormPanel",{extend:"Ext.form.Panel",alias:"DCI.Customer.HeadFormPanel",region:"center",layout:"absolute",frame:!0,width:1E3,bodyPadding:5,waitMsgTarget:!0,method:"POST",languageObj:null,searchWin:null,searchStore:null,currmode:PageMode.View,currrow:0,dataloaded:!1,bodypanel:null,toolpanel:null,defaults:{xtype:"textfield"},fieldDefaults:{labelAlign:"right",labelWidth:80,msgTarget:"side"},loadDefault:function(){if(null!=this.items&&0<this.items.length)for(var a=0;a<this.items.length;a++)-1!=
Ext.getClassName(this.items.get(a)).indexOf("DCI")&&this.items.get(a).loadDefault();null!=this.bodypanel&&this.bodypanel.clearGrid();this.resetDataLoaded()},showQueryWindow:function(){},initQueryWindow:function(){if(this.getCurrMode()==PageMode.Add){this.loadDefault();for(var a=0;a<this.items.length;a++)try{"function"==typeof this.items.get(a).clearInvalid&&this.items.get(a).clearInvalid()}catch(b){window.console&&console.log(b.message)}}},getCurrMode:function(){return this.currmode},setCurrMode:function(a){this.currmode=
a;this.currmode==PageMode.View?(setCompsReadOnly(this.items,!0),null!=this.bodypanel&&this.bodypanel.changeMode(PageMode.Edit)):this.currmode==PageMode.Add?setCompsReadOnly(this.items,!1):this.currmode==PageMode.Edit&&setPageEdit(this.items)},resetDataLoaded:function(){this.setDataLoaded(!1)},setDataLoaded:function(a){this.dataloaded=a;null!=this.bodypanel&&this.bodypanel.dataloaded(a);null!=this.toolpanel&&this.toolpanel.setDataLoadMode(a)},cusValid:function(a){a()},initComponent:function(){this.callParent(arguments);
setCompsReadOnly(this.items,!0)}});
Ext.define("DCI.Customer.QueryWindow",{extend:"Ext.window.Window",alias:"DCI.Customer.QueryWindow",layout:"border",title:"Query",height:200,width:400,minWidth:300,minHeight:200,modal:!0,plain:!0,headform:null,items:[{xtype:"panel",region:"north",height:35,layout:"absolute",items:[{xtype:"combobox",fieldLabel:"",displayField:"label",valueField:"value",typeAhead:!0,editable:!1,queryMode:"local",labelWidth:1,matchFieldWidth:!1,multiSelect:!1,forceSelection:!0,store:Ext.create("Ext.data.Store",{fields:[{name:"label",
type:"string"},{name:"value",type:"string"}],autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}}),x:5,y:5},{xtype:"textfield",name:"qvalue",fieldLabel:"",labelWidth:1,width:160,x:155,y:5},{xtype:"button",cls:"search-toolbar",width:30,height:30,x:315,y:1,handler:function(){this.up("panel").up("window").clickFunc()}}]},{xtype:"grid",region:"center",renderer:"component",stripeRows:!0,autoScroll:!0,loadMask:!0,enableTextSelection:!0,viewConfig:{forceFit:!1,autoLoad:!1},columns:[],store:null,dockedItems:[{xtype:"pagingtoolbar",
store:null,dock:"bottom",displayInfo:!0,listeners:{beforechange:function(a,b,c){this.store.getProxy().extraParams.hasOwnProperty("page")&&(null==b||0==b?this.store.getProxy().extraParams.page=1:this.store.getProxy().extraParams.page=b);this.store.load()}}}],listeners:{celldblclick:function(a,b,c,d,e,f,k,l){b=this.up("window");a=a.getStore();null!=b.headform&&(b.headform.currrow=1==a.currentPage?f:(a.currentPage-1)*a.pageSize+f);this.up("window").loadHeadData(d)}}}],setInitObjects:function(a,b,c){if(0<
a.length){var d=this.items.get(0).items.get(0);d.getStore().loadData(a[0].get("cols"));0<d.getStore().getCount()&&("undefined"!=typeof d&&null!=d)&&d.setValue(d.getStore().getAt(0).get("value"))}this.items.get(1).reconfigure(b,c);this.items.get(1).child("pagingtoolbar").bindStore(b);b.load()},loadHeadData:function(a){this.headform.loadRecord(a);this.headform.setDataLoaded(!0);this.close()},clickFunc:function(){var a=this.items.get(1).getStore(),b=this.items.get(0).items.get(0).getValue(),c=this.items.get(0).items.get(1).getValue();
a.getProxy().extraParams.hasOwnProperty("filter")&&(a.getProxy().extraParams.filter=" and "+b+" like '%"+c+"%' ");a.getProxy().extraParams.hasOwnProperty("page")&&(a.getProxy().extraParams.page=1);a.currentPage=1;a.load()}});
Ext.define("DCI.Customer.SubTabPanel",{extend:"Ext.tab.Panel",alias:"DCI.Customer.SubTabPanel",minWidth:900,minHeight:400,widthChangeControls:[],bodyStyle:{background:"#eaf1fb"},resize:function(a,b){if(a>this.width){this.width=a;for(var c=0;c<this.widthChangeControls.length;c++)null!=this.widthChangeControls[c]&&this.widthChangeControls[c].setWidth(a-20)}else{var d=this.minWidth;a>this.minWidth&&(d=a);for(c=0;c<this.widthChangeControls.length;c++)null!=this.widthChangeControls[c]&&this.widthChangeControls[c].setWidth(d-
20);this.width=a}b<this.minHeight&&(b=this.minHeight);this.setHeight(b)},beforeClose:function(){},focusPage:function(){null!=Ext.get(this.renderTo)&&this.resize(Ext.get(this.renderTo).getWidth(),Ext.get(this.renderTo).getHeight())},leavePage:function(){},globalTimerEvent:function(a,b){},globalTimerStop:function(){}});
Ext.define("DCI.Customer.SubPanel",{extend:"Ext.Panel",alias:"DCI.Customer.SubPanel",minWidth:900,minHeight:400,parentComp:null,bodyStyle:{background:"#eaf1fb"},widthChangeControls:[],setParent:function(a){this.parentComp=a},resize:function(a,b){if(a>this.width){this.width=a;for(var c=0;c<this.widthChangeControls.length;c++)null!=this.widthChangeControls[c]&&this.widthChangeControls[c].setWidth(a-20)}else{var d=this.minWidth;a>this.minWidth&&(d=a);for(c=0;c<this.widthChangeControls.length;c++)null!=
this.widthChangeControls[c]&&this.widthChangeControls[c].setWidth(d-20);this.width=a}b<this.minHeight&&(b=this.minHeight);this.setHeight(b)},beforeClose:function(){},focusPage:function(){null!=Ext.get(this.renderTo)&&this.resize(Ext.get(this.renderTo).getWidth(),Ext.get(this.renderTo).getHeight())},leavePage:function(){},globalTimerEvent:function(a,b){},globalTimerStop:function(){}});
Ext.define("DCI.Customer.ToolBarPanel",{extend:"Ext.Panel",alias:"DCI.Customer.ToolBarPanel",region:"north",width:300,height:35,bodyStyle:{background:"#99bce8"},x:0,y:0,border:0,layout:"absolute",bindform:null,postvalue:"",uid:"",canEdit:!0,cusMsg:[],keepAdd:!0,items:[{xtype:"button",cls:"search-toolbar",x:5,y:3,width:30,height:30,handler:function(){var a=this,b=a.up("panel").bindform;null!=b&&(b.setLoading(!1),b.getCurrMode()==PageMode.View?b.showQueryWindow():Ext.MessageBox.confirm(b.languageObj.confirm_title,
b.languageObj.data_lose_warning,function(c){"yes"==c&&(b.showQueryWindow(),b.setCurrMode(PageMode.View),a.up("panel").ModeChange(PageMode.View))}))}},{xtype:"button",cls:"add-toolbar",x:40,y:3,width:30,height:30,handler:function(){var a=this.up("panel").bindform;null!=a&&a.getCurrMode()==PageMode.View&&(a.setLoading(!1),this.up("panel").canEdit?(a.loadDefault(),a.setCurrMode(PageMode.Add),this.up("panel").ModeChange(PageMode.Add)):Ext.MessageBox.alert(a.languageObj.errmsg,a.languageObj.no_edit_auth))}},
{xtype:"button",cls:"edit-toolbar",x:75,y:3,width:30,height:30,handler:function(){var a=this.up("panel").bindform;if(null!=a&&a.getCurrMode()==PageMode.View&&a.dataloaded)if(a.setLoading(!1),this.up("panel").canEdit){var b=this.up("panel").exceptionEditAuth();null!=b&&2==b.length&&("1"==b[0]?(a.setCurrMode(PageMode.Edit),this.up("panel").ModeChange(PageMode.Edit)):Ext.MessageBox.alert(a.languageObj.errmsg,b[1]))}else Ext.MessageBox.alert(a.languageObj.errmsg,a.languageObj.no_edit_auth)}},{xtype:"button",
cls:"delete-toolbar",x:110,y:3,width:30,height:30,handler:function(){var a=this.up("panel").bindform,b=this.up("panel").postvalue,c=this.up("panel").uid,d=this.up("panel").cusMsg;if(null!=a&&a.getCurrMode()==PageMode.Edit)if(a.setLoading(!1),this.up("panel").canEdit){var e=this.up("panel"),f=e.exceptionDeleteAuth();null!=f&&2==f.length&&("1"==f[0]?Ext.MessageBox.confirm(a.languageObj.delete_confirm_title,a.languageObj.delete_confirm_msg,function(f){"yes"==f&&Ext.Ajax.request({method:"POST",url:a.url,
params:{action:"del",datas:Ext.encode(a.getForm().getValues()),DCITag:b,uid:c},success:function(b){b=Ext.JSON.decode(b.responseText);if(b.success){a.loadDefault();a.setCurrMode(PageMode.View);e.ModeChange(PageMode.View);for(b=0;b<a.items.length;b++)try{"function"==typeof a.items.get(b).clearInvalid&&a.items.get(b).clearInvalid()}catch(c){window.console&&console.log(c.message)}null!=d&&3<=d.length?Ext.Msg.alert(a.languageObj.delete_result_title,d[2]):Ext.Msg.alert(a.languageObj.delete_result_title,
a.languageObj.delete_success)}else Ext.Msg.alert(a.languageObj.save_result_title,a.languageObj.delete_fail+" :</br>"+b.errorMessage)},failure:function(b,c){Ext.MessageBox.alert(a.languageObj.errmsg,a.languageObj.system_error)}})}):Ext.MessageBox.alert(a.languageObj.errmsg,f[1]))}else alerExt.MessageBox.alert(a.languageObj.errmsg,a.languageObj.no_edit_auth)}},{xtype:"button",cls:"save-toolbar",x:145,y:3,width:30,height:30,handler:function(){var a=this.up("panel").bindform,b=this.up("panel"),c=this.up("panel").cusMsg,
d=this.up("panel").keepAdd;if(null!=a&&(a.getCurrMode()==PageMode.Add||a.getCurrMode()==PageMode.Edit))a.setLoading(!1),this.up("panel").canEdit?a.isValid()&&a.cusValid(function(){a.getForm().submit({waitMsg:a.languageObj.save_msg,params:{action:"save",datas:Ext.encode(a.getForm().getValues()),DCITag:b.postvalue,uid:b.uid,mode:a.getCurrMode()},failure:function(b,c){Ext.Msg.alert(a.languageObj.save_result_title,a.languageObj.save_fail+" :</br>"+c.result.errorMessage)},success:function(e,f){var k=a.getCurrMode();
if(k==PageMode.Add){if(d)a.loadDefault(),a.setCurrMode(PageMode.View),b.ModeChange(PageMode.View);else{a.setCurrMode(PageMode.View);b.ModeChange(PageMode.View);var l=f.result.resultData.items[0];null==l?a.loadDefault():(a.getForm().setValues(l),a.setDataLoaded(!0))}null!=a.bodypanel&&a.bodypanel.setNewCondi()}else a.setCurrMode(PageMode.View),b.ModeChange(PageMode.View);for(var h=0;h<a.items.length;h++)try{"function"==typeof a.items.get(h).clearInvalid&&a.items.get(h).clearInvalid()}catch(g){window.console&&
console.log(g.message)}null!=l&&b.afterSaveFunc(l);k==PageMode.Add&&null!=c&&1<=c.length?Ext.Msg.alert(a.languageObj.save_result_title,c[0]):k==PageMode.Edit&&null!=c&&2<=c.length?Ext.Msg.alert(a.languageObj.save_result_title,c[1]):Ext.Msg.alert(a.languageObj.save_result_title,a.languageObj.save_success)}})}):Ext.MessageBox.alert(a.languageObj.errmsg,a.languageObj.no_edit_auth)}},{xtype:"button",cls:"exit-toolbar",x:180,y:3,width:30,height:30,handler:function(){var a=this,b=a.up("panel").bindform;
null!=b&&(b.setLoading(!1),(b.getCurrMode()==PageMode.Add||b.getCurrMode()==PageMode.Edit)&&Ext.MessageBox.confirm(b.languageObj.confirm_title,b.languageObj.data_lose_warning,function(c){if("yes"==c){b.getCurrMode()==PageMode.Add&&b.loadDefault();for(c=0;c<b.items.length;c++)try{"function"==typeof b.items.get(c).clearInvalid&&b.items.get(c).clearInvalid()}catch(d){window.console&&console.log(d.message)}b.setCurrMode(PageMode.View);a.up("panel").ModeChange(PageMode.View)}}))}},{xtype:"label",text:"",
height:30,style:"font: bold 20px courier",x:215,y:5}],dockedItems:[{xtype:"toolbar",dock:"right",width:122,style:{background:"#99bce8"},layout:"absolute",items:[{xtype:"button",cls:"first-disable-toolbar",x:0,y:3,width:30,height:30,handler:function(){var a=this,b=a.up("panel").bindform;if(null!=b){var c=b.searchStore;null!=c&&(1<c.getTotalCount()&&0!=b.currrow)&&(b.getCurrMode()==PageMode.View?1==c.currentPage?(b.currrow=0,b.searchWin.loadHeadData(c.getAt(0))):(c.getProxy().extraParams.hasOwnProperty("page")&&
(c.getProxy().extraParams.page=1),c.currentPage=1,c.load(function(){b.currrow=0;b.searchWin.loadHeadData(c.getAt(0))})):b.getCurrMode()==PageMode.Edit&&Ext.MessageBox.confirm(b.languageObj.confirm_title,b.languageObj.data_lose_warning,function(d){if("yes"==d){1==c.currentPage?(b.currrow=0,b.searchWin.loadHeadData(c.getAt(0))):(c.getProxy().extraParams.hasOwnProperty("page")&&(c.getProxy().extraParams.page=1),c.currentPage=1,c.load(function(){b.currrow=0;b.searchWin.loadHeadData(c.getAt(0))}));for(d=
0;d<b.items.length;d++)try{"function"==typeof b.items.get(d).clearInvalid&&b.items.get(d).clearInvalid()}catch(e){window.console&&console.log(e.message)}b.setCurrMode(PageMode.View);a.up("panel").ModeChange(PageMode.View)}}))}}},{xtype:"button",cls:"back-disable-toolbar",x:30,y:3,width:30,height:30,handler:function(){var a=this,b=a.up("panel").bindform;if(null!=b){var c=b.searchStore,d=b.currrow;if(null!=c&&1<c.getTotalCount()&&1<=d){d--;var e=1,e=0==d%c.pageSize?d/c.pageSize+1:Math.ceil(d/c.pageSize);
b.getCurrMode()==PageMode.View?c.currentPage==e?(b.currrow=d,b.searchWin.loadHeadData(c.getAt(d%c.pageSize))):(c.getProxy().extraParams.hasOwnProperty("page")&&(c.getProxy().extraParams.page=e),c.currentPage=e,c.load(function(){b.currrow=d;b.searchWin.loadHeadData(c.getAt(d%c.pageSize))})):b.getCurrMode()==PageMode.Edit&&Ext.MessageBox.confirm(b.languageObj.confirm_title,b.languageObj.data_lose_warning,function(f){if("yes"==f){c.currentPage==e?(b.currrow=d,b.searchWin.loadHeadData(c.getAt(d%c.pageSize))):
(c.getProxy().extraParams.hasOwnProperty("page")&&(c.getProxy().extraParams.page=e),c.currentPage=e,c.load(function(){b.currrow=d;b.searchWin.loadHeadData(c.getAt(d%c.pageSize))}));for(f=0;f<b.items.length;f++)try{"function"==typeof b.items.get(f).clearInvalid&&b.items.get(f).clearInvalid()}catch(k){window.console&&console.log(k.message)}b.setCurrMode(PageMode.View);a.up("panel").ModeChange(PageMode.View)}})}}}},{xtype:"button",cls:"forward-disable-toolbar",x:60,y:3,width:30,height:30,handler:function(){var a=
this,b=a.up("panel").bindform;if(null!=b){var c=b.searchStore,d=b.currrow;if(null!=c&&1<c.getTotalCount()&&d<c.getTotalCount()-1){d++;var e=1,e=0==d%c.pageSize?d/c.pageSize+1:Math.ceil(d/c.pageSize);b.getCurrMode()==PageMode.View?c.currentPage==e?(b.currrow=d,b.searchWin.loadHeadData(c.getAt(d%c.pageSize))):(c.getProxy().extraParams.hasOwnProperty("page")&&(c.getProxy().extraParams.page=e),c.currentPage=e,c.load(function(){b.currrow=d;b.searchWin.loadHeadData(c.getAt(d%c.pageSize))})):b.getCurrMode()==
PageMode.Edit&&Ext.MessageBox.confirm(b.languageObj.confirm_title,b.languageObj.data_lose_warning,function(f){if("yes"==f){c.currentPage==e?(b.currrow=d,b.searchWin.loadHeadData(c.getAt(d%c.pageSize))):(c.getProxy().extraParams.hasOwnProperty("page")&&(c.getProxy().extraParams.page=e),c.currentPage=e,c.load(function(){b.currrow=d;b.searchWin.loadHeadData(c.getAt(d%c.pageSize))}));for(f=0;f<b.items.length;f++)try{"function"==typeof b.items.get(f).clearInvalid&&b.items.get(f).clearInvalid()}catch(k){window.console&&
console.log(k.message)}b.setCurrMode(PageMode.View);a.up("panel").ModeChange(PageMode.View)}})}}}},{xtype:"button",cls:"end-disable-toolbar",x:90,y:3,width:30,height:30,handler:function(){var a=this,b=a.up("panel").bindform;if(null!=b){var c=b.searchStore;if(null!=c&&1<c.getTotalCount())if(b.getCurrMode()==PageMode.View)if(c.currentPage==Math.ceil(c.getTotalCount()/c.pageSize))b.currrow=c.getTotalCount()-1,b.searchWin.loadHeadData(c.getAt(c.getTotalCount()%c.pageSize-1));else{var d=Math.ceil(c.getTotalCount()/
c.pageSize);c.getProxy().extraParams.hasOwnProperty("page")&&(c.getProxy().extraParams.page=d);c.currentPage=d;c.load(function(){b.currrow=c.getTotalCount()-1;b.searchWin.loadHeadData(c.getAt(c.getTotalCount()%c.pageSize-1))})}else b.getCurrMode()==PageMode.Edit&&Ext.MessageBox.confirm(b.languageObj.confirm_title,b.languageObj.data_lose_warning,function(d){if("yes"==d){c.currentPage==Math.ceil(c.getTotalCount()/c.pageSize)?(b.currrow=c.getTotalCount()-1,b.searchWin.loadHeadData(c.getAt(c.getTotalCount()%
c.pageSize-1))):(d=Math.ceil(c.getTotalCount()/c.pageSize),c.getProxy().extraParams.hasOwnProperty("page")&&(c.getProxy().extraParams.page=d),c.currentPage=d,c.load(function(){b.currrow=c.getTotalCount()-1;b.searchWin.loadHeadData(c.getAt(c.getTotalCount()%c.pageSize-1))}));for(d=0;d<b.items.length;d++)try{"function"==typeof b.items.get(d).clearInvalid&&b.items.get(d).clearInvalid()}catch(f){window.console&&console.log(f.message)}b.setCurrMode(PageMode.View);a.up("panel").ModeChange(PageMode.View)}})}}}]}],
setBindForm:function(a){this.bindform=a},ModeChange:function(a){var b=this.items.get(this.items.length-1);null!=b&&(a==PageMode.Edit||a==PageMode.Add?b.setText(this.bindform.languageObj.mode_edit):b.setText(this.bindform.languageObj.mode_view));var b=this.items.get(1),c=this.items.get(2),d=this.items.get(3),e=this.items.get(4),f=this.items.get(5);a==PageMode.Add?(e.removeCls("save-disable-toolbar"),e.addCls("save-toolbar"),f.removeCls("exit-disable-toolbar"),f.addCls("exit-toolbar"),c.removeCls("edit-toolbar"),
c.addCls("edit-disable-toolbar"),d.removeCls("delete-toolbar"),d.addCls("delete-disable-toolbar"),b.removeCls("add-disable-toolbar"),b.addCls("add-toolbar")):a==PageMode.Edit?(f.removeCls("exit-disable-toolbar"),f.addCls("exit-toolbar"),c.removeCls("edit-disable-toolbar"),c.addCls("edit-toolbar"),d.removeCls("delete-disable-toolbar"),d.addCls("delete-toolbar"),e.removeCls("save-disable-toolbar"),e.addCls("save-toolbar"),b.removeCls("add-toolbar"),b.addCls("add-disable-toolbar")):a==PageMode.View&&
(f.removeCls("exit-toolbar"),f.addCls("exit-disable-toolbar"),this.bindform.dataloaded?(c.removeCls("edit-disable-toolbar"),c.addCls("edit-toolbar")):(c.removeCls("edit-toolbar"),c.addCls("edit-disable-toolbar")),d.removeCls("delete-toolbar"),d.addCls("delete-disable-toolbar"),e.removeCls(e.cls),e.addCls("save-disable-toolbar"),b.removeCls("add-disable-toolbar"),b.addCls("add-toolbar"))},setCusButtons:function(a){if(null!=a){for(var b=0;b<a.length;b++)this.insert(this.items.length-1,a[b]);var b=this.items.get(this.items.length-
1),c=b.x,c=c+35*a.length;b.x=c}},exceptionEditAuth:function(){return["1",""]},exceptionDeleteAuth:function(){return["1",""]},setDataLoadMode:function(a){var b=this.items.get(2),c=this.getDockedItems('[dock="right"]')[0],d=this.bindform,e=d.searchStore,f=d.currrow;null!=b&&(a?(b.removeCls("edit-disable-toolbar"),b.addCls("edit-toolbar")):(b.removeCls("edit-toolbar"),b.addCls("edit-disable-toolbar")));a&&null!=e&&1<e.getTotalCount()?0==f?(c.items.get(0).removeCls("first-toolbar"),c.items.get(0).addCls("first-disable-toolbar"),
c.items.get(1).removeCls("back-toolbar"),c.items.get(1).addCls("back-disable-toolbar"),c.items.get(2).removeCls("forward-disable-toolbar"),c.items.get(2).addCls("forward-toolbar"),c.items.get(3).removeCls("end-disable-toolbar"),c.items.get(3).addCls("end-toolbar")):f==e.getTotalCount()-1?(c.items.get(0).removeCls("first-disable-toolbar"),c.items.get(0).addCls("first-toolbar"),c.items.get(1).removeCls("back-disable-toolbar"),c.items.get(1).addCls("back-toolbar"),c.items.get(2).removeCls("forward-toolbar"),
c.items.get(2).addCls("forward-disable-toolbar"),c.items.get(3).removeCls("end-toolbar"),c.items.get(3).addCls("end-disable-toolbar")):(c.items.get(0).removeCls("first-disable-toolbar"),c.items.get(0).addCls("first-toolbar"),c.items.get(1).removeCls("back-disable-toolbar"),c.items.get(1).addCls("back-toolbar"),c.items.get(2).removeCls("forward-disable-toolbar"),c.items.get(2).addCls("forward-toolbar"),c.items.get(3).removeCls("end-disable-toolbar"),c.items.get(3).addCls("end-toolbar")):(c.items.get(0).removeCls("first-toolbar"),
c.items.get(0).addCls("first-disable-toolbar"),c.items.get(1).removeCls("back-toolbar"),c.items.get(1).addCls("back-disable-toolbar"),c.items.get(2).removeCls("forward-toolbar"),c.items.get(2).addCls("forward-disable-toolbar"),c.items.get(3).removeCls("end-toolbar"),c.items.get(3).addCls("end-disable-toolbar"),a||(d.searchStore=null))},setTips:function(a){var b=this.getDockedItems('[dock="right"]')[0];this.items.get(0).setTooltip(a.search);this.items.get(1).setTooltip(a.add);this.items.get(2).setTooltip(a.edit);
this.items.get(3).setTooltip(a._delete);this.items.get(4).setTooltip(a.save);this.items.get(5).setTooltip(a.exit);b.items.get(0).setTooltip(a.first_row);b.items.get(1).setTooltip(a.back_row);b.items.get(2).setTooltip(a.next_row);b.items.get(3).setTooltip(a.last_row)}});
Ext.define("DCI.Customer.BodyGridPanel",{extend:"Ext.panel.Panel",alias:"DCI.Customer.BodyGridPanel",region:"center",layout:"border",bodyStyle:{background:"#eaf1fb"},bodyPadding:5,headform:null,actionurl:"",languageObj:null,currmode:PageMode.View,dataloaded:!1,gridid:"",postvalue:"",keyfields:[],headKeys:{},canEdit:!0,oriGStore:null,oriGColumns:[],stopUsingBtn:[],uid:"",cusFormatIconPath:"",items:[{xtype:"panel",region:"north",border:0,layout:"absolute",height:40,x:400,y:0,items:[{xtype:"button",
width:50,disabled:!0,x:0,y:5,handler:function(){this.up("panel").up("panel").currmode==PageMode.Edit&&this.up("panel").up("panel").addNewRow()}},{xtype:"button",disabled:!0,width:50,x:55,y:5,handler:function(){var a=this.up("panel").up("panel");if(a.currmode==PageMode.Edit&&a.valided()){var b=a.languageObj,c=a.items.get(1).getStore();null!=a.items.get(1).plugins[0]&&a.items.get(1).plugins[0].completeEdit();for(var d=[],e=0,f=0;f<c.getCount();f++)1==c.getAt(f).get("moditag")&&(d.push(c.getAt(f).data),
"add"==c.getAt(f).get("moditp")&&e++);Ext.Ajax.request({method:"POST",url:a.actionurl,params:{DCITag:a.postvalue,uid:a.uid,action:"bodySave",datas:Ext.encode(d),allAdd:c.getCount()==e},success:function(c){a.gridReload();Ext.Msg.alert(b.save_result_title,b.save_success)},failure:function(a,c){Ext.Msg.alert(b.save_result_title,b.save_fail+" :</br>"+c.result.errorMessage)}})}}},{xtype:"button",disabled:!0,width:50,x:110,y:5,handler:function(){var a=this.up("panel").up("panel"),b=a.currmode,c=a.items.get(1),
d=a.languageObj,e=a.actionurl;Ext.MessageBox.confirm(d.delete_confirm_title,d.delete_confirm_msg,function(f){"yes"==f&&(b==PageMode.Edit&&null!=c)&&(f=c.getSelectionModel().getSelection(),0<f.length&&Ext.Ajax.request({method:"POST",url:e,params:{DCITag:a.postvalue,uid:a.uid,action:"bodyDelete",datas:Ext.encode(f[0].data)},success:function(b){a.gridReload();Ext.Msg.alert(d.delete_result_title,d.delete_success)},failure:function(a,b){Ext.Msg.alert(d.delete_result_title,d.delete_fail+" :</br>"+b.result.errorMessage)}}))})}},
{xtype:"button",disabled:!0,width:100,x:165,y:5,handler:function(){this.up("panel").up("panel").canEdit?(this.up("panel").up("panel").changeMode(this.up("panel").up("panel").currmode),this.up("panel").up("panel").currmode==PageMode.View&&this.up("panel").up("panel").gridReload()):Ext.MessageBox.alert(this.up("panel").up("panel").languageObj.errmsg,this.up("panel").up("panel").languageObj.no_edit_auth)}},{xtype:"button",width:100,x:270,y:5,handler:function(){for(var a=this.up("panel").up("panel"),
b=a.items.get(1).columns,c=a.languageObj,d=[],e=0;e<b.length;e++){var f={};f.col_id=b[e].colid;f.col_index=b[e].getIndex();f.col_width=b[e].width;f.col_visible=b[e].hidden?0:1;d.push(f)}Ext.Ajax.request({method:"POST",url:"./../../PublicCtrl.dsc",params:{DCITag:this.up("panel").up("panel").postvalue,uid:this.up("panel").up("panel").uid,action:"saveGFormat",gridid:this.up("panel").up("panel").gridid,datas:Ext.encode(d)},success:function(b){a.addCusFormatIcon();Ext.Msg.alert(c.save_result_title,c.save_success)},
failure:function(a,b){Ext.Msg.alert(c.save_result_title,c.save_fail+" :</br>"+b.result.errorMessage)}})}},{xtype:"button",width:120,x:375,y:5,handler:function(){var a=this.up("panel").up("panel"),b=a.items.get(1),c=a.languageObj,d=a.getOGS(),e=a.getOGC();Ext.MessageBox.confirm(c.load_def_confirm_title,c.load_def_confirm_msg,function(f){"yes"==f&&Ext.Ajax.request({method:"POST",url:"./../../PublicCtrl.dsc",params:{DCITag:a.postvalue,uid:a.uid,action:"clearGFormat",gridid:a.gridid},success:function(f){b.reconfigure(d,
e);a.rmCusFormatIcon();Ext.Msg.alert(c.load_def_result_title,c.load_def_success)},failure:function(a,b){Ext.Msg.alert(c.load_def_result_title,c.load_def_fail+" :</br>"+b.result.errorMessage)}})})}}]},{xtype:"grid",region:"center",stripeRows:!0,autoScroll:!0,loadMask:!0,allowDeselect:!0,selModel:{allowDeselect:!0},enableTextSelection:!0,viewConfig:{forceFit:!1,autoLoad:!1},columns:[],store:null,listeners:{celldblclick:function(a,b,c,d,e,f,k,l){this.up("panel").griddbclick(a,b,c,d,e,f,k,l)},selectionchange:function(a,
b,c){this.up("panel").gridselectionchange(a,b,c)},deselect:function(a,b,c,d){this.up("panel").griddeselect(a,b,c,d)}},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,listeners:{beforeedit:function(a,b,c){if(b.grid.up("panel").currmode==PageMode.View)return!1;if("add"!=b.record.get("moditp")&&null!=b.grid.up("panel").keyfields){a=b.grid.up("panel").keyfields;for(c=0;c<a.length;c++)if(a[c]==b.column.dataIndex)return!1}},edit:function(a,b,c){1!=b.record.get("moditag")&&null!=b.record&&
(b.record.set("moditag",1),b.record.set("moditp","edit"),b.record.commit())}}})]}],getOGS:function(){return this.oriGStore},getOGC:function(){return this.oriGColumns},isCusFormatExist:function(){for(var a=this.items.get(0),b=!1,c=0;c<a.items.length;c++)if("cusicon"==a.items.get(c).iconid){b=!0;break}return b},addCusFormatIcon:function(){var a=this,b=this.items.get(0),c=b.items.length-1;a.isCusFormatExist()||(b.items.insert(b.items.length,Ext.create("DCI.Customer.Img",{iconid:"cusicon",src:a.cusFormatIconPath,
x:b.items.get(c).x+b.items.get(c).width+2,y:8,width:20,height:20,listeners:{afterrender:function(b){Ext.create("Ext.tip.ToolTip",{target:b.getEl(),html:a.languageObj.cus_format})}}})),b.update())},rmCusFormatIcon:function(){var a=this.items.get(0);this.isCusFormatExist()&&(a.items.remove(a.items.get(a.items.length-1)),a.update())},initBody:function(a,b){var c=this,d=this.items.get(1),e=c.items.get(0),f=[];c.oriGStore=a;c.oriGColumns=[];if(null==c.cusFormatIconPath||""==c.cusFormatIconPath)c.cusFormatIconPath=
"../../images/icons/CusGridFormat.png";for(var k=0;k<b.length;k++)c.oriGColumns.push(b[k]);Ext.create("Ext.data.Store",{autoLoad:!1,fields:["colFormats"],proxy:{type:"ajax",url:"./../../PublicCtrl.dsc",actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{DCITag:this.postvalue,uid:this.uid,action:"getGFormat",gridid:this.gridid}}}).load(function(e){if(0<e.length){var h=Ext.create("Ext.data.Store",{fields:["col_id","col_index","col_width","col_visible"],autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}});
h.loadData(e[0].get("colFormats"));if(0<h.getCount()){c.addCusFormatIcon();for(e=0;e<h.getCount();e++)for(var g=0;g<b.length;g++)if(b[g].colid==h.getAt(e).get("col_id")){"1"==h.getAt(e).get("col_visible")?(b[g].hasOwnProperty("hidden"),b[g].hidden=!1,0!=h.getAt(e).get("col_width")&&(b[g].hasOwnProperty("width"),b[g].width=parseInt(h.getAt(e).get("col_width")))):(0!=h.getAt(e).get("col_width")&&(b[g].hasOwnProperty("width"),b[g].width=parseInt(h.getAt(e).get("col_width"))),b[g].hasOwnProperty("hidden"),
b[g].hidden=!0);f.push(b[g]);b.splice(g,1);break}if(null!=b&&0!=b.leght)for(e=0;e<b.length;e++)b[e].hidden=!0,f.push(b[e])}else f=b;d.reconfigure(a,f)}else d.reconfigure(a,b)});c.changeMode(PageMode.Edit);c.dataloaded(!1);null!=c.languageObj&&(e.items.get(0).setText(c.languageObj.add),e.items.get(1).setText(c.languageObj.save),e.items.get(2).setText(c.languageObj._delete),e.items.get(3).setText(c.languageObj.to_edit),e.items.get(4).setText(c.languageObj.save_format),e.items.get(5).setText(c.languageObj.load_def_format));
null!=this.headform&&(this.headform.bodypanel=this)},getCurrMode:function(){return this.currmode},addNewRow:function(){},dataloaded:function(a){var b=this.items.get(0).items.get(3);null!=b&&(b.setDisabled(!a),a||this.changeMode(PageMode.Edit))},clearGrid:function(){var a=this.items.get(1).getStore();null!=a&&a.removeAll()},changeMode:function(a){var b=this.items.get(0).items;if(a==PageMode.View){for(a=0;3>=a;a++)if(3==a)b.get(a).setText(this.languageObj.to_view);else if(null!=this.stopUsingBtn&&0<
this.stopUsingBtn.length){for(var c=!1,d=0;d<this.stopUsingBtn.length;d++)if(this.stopUsingBtn[d]==a){c=!0;break}b.get(a).setDisabled(c)}else b.get(a).setDisabled(!1);this.currmode=PageMode.Edit}else{for(a=0;3>=a;a++)3==a?b.get(a).setText(this.languageObj.to_edit):b.get(a).setDisabled(!0);this.currmode=PageMode.View}},setNewCondi:function(){},gridReload:function(){var a=this.items.get(1);null!=a&&a.getStore().load()},griddbclick:function(a,b,c,d,e,f,k,l){},gridselectionchange:function(a,b,c){},griddeselect:function(a,
b,c,d){},getGrid:function(){return this.items.get(1)},valided:function(){return!0}});
Ext.define("DCI.Customer.ViewGridPanel",{extend:"Ext.panel.Panel",alias:"DCI.Customer.ViewGridPanel",region:"center",layout:"border",bodyStyle:{background:"#eaf1fb"},bodyPadding:5,actionurl:"",dataloaded:!1,gridid:"",postvalue:"",uid:"",cusFormatIconPath:"",oriGStore:null,oriGColumns:[],items:[{xtype:"panel",region:"north",border:0,header:!1,split:!0,collapsible:!0,collapseMode:"mini",animCollapse:!1,collapsed:!0,layout:"absolute",height:35,items:[{xtype:"button",text:"save format",width:150,x:0,
y:5,handler:function(){for(var a=this.up("panel").up("panel"),b=a.items.get(2).columns,c=a.languageObj,d=[],e=0;e<b.length;e++){var f={};f.col_id=b[e].colid;f.col_index=b[e].getIndex();f.col_width=b[e].width;f.col_visible=b[e].hidden?0:1;d.push(f)}Ext.Ajax.request({method:"POST",url:"./../../PublicCtrl.dsc",params:{DCITag:a.postvalue,uid:a.uid,action:"saveGFormat",gridid:a.gridid,datas:Ext.encode(d)},success:function(b){a.addCusFormatIcon();Ext.Msg.alert(c.save_result_title,c.save_success)},failure:function(a,
b){Ext.Msg.alert(c.save_result_title,c.save_fail+" :</br>"+b.result.errorMessage)}})}},{xtype:"button",width:120,x:155,y:5,handler:function(){var a=this.up("panel").up("panel"),b=a.items.get(2),c=a.languageObj,d=a.getOGS(),e=a.getOGC();Ext.MessageBox.confirm(c.load_def_confirm_title,c.load_def_confirm_msg,function(f){"yes"==f&&Ext.Ajax.request({method:"POST",url:"./../../PublicCtrl.dsc",params:{DCITag:a.postvalue,uid:a.uid,action:"clearGFormat",gridid:a.gridid},success:function(f){b.reconfigure(d,
e);a.rmCusFormatIcon();Ext.Msg.alert(c.load_def_result_title,c.load_def_success)},failure:function(a,b){Ext.Msg.alert(c.load_def_result_title,c.load_def_fail+" :</br>"+b.result.errorMessage)}})})}}]},{xtype:"grid",region:"center",stripeRows:!0,autoScroll:!0,loadMask:!0,allowDeselect:!0,selModel:{allowDeselect:!0},enableTextSelection:!0,viewConfig:{forceFit:!1,autoLoad:!1},columns:[],store:null,listeners:{celldblclick:function(a,b,c,d,e,f,k,l){this.up("panel").griddbclick(a,b,c,d,e,f,k,l)}}}],getOGS:function(){return this.oriGStore},
getOGC:function(){return this.oriGColumns},isCusFormatExist:function(){for(var a=this.items.get(0),b=!1,c=0;c<a.items.length;c++)if("cusicon"==a.items.get(c).iconid){b=!0;break}return b},addCusFormatIcon:function(){var a=this,b=this.items.get(0),c=b.items.length-1;a.isCusFormatExist()||(b.items.insert(b.items.length,Ext.create("DCI.Customer.Img",{src:a.cusFormatIconPath,x:b.items.get(c).x+b.items.get(c).width+2,y:8,width:20,height:20,listeners:{afterrender:function(b){Ext.create("Ext.tip.ToolTip",
{target:b.getEl(),html:a.languageObj.cus_format})}}})),b.update())},rmCusFormatIcon:function(){var a=this.items.get(0);this.isCusFormatExist()&&(a.items.remove(a.items.get(a.items.length-1)),a.update())},initBody:function(a,b){var c=this,d=c.items.get(2),e=c.items.get(0),f=[];c.oriGStore=a;c.oriGColumns=[];if(null==c.cusFormatIconPath||""==c.cusFormatIconPath)c.cusFormatIconPath="../../images/icons/CusGridFormat.png";for(var k=0;k<b.length;k++)c.oriGColumns.push(b[k]);Ext.create("Ext.data.Store",
{autoLoad:!1,fields:["colFormats"],proxy:{type:"ajax",url:"./../../PublicCtrl.dsc",actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{DCITag:c.postvalue,uid:c.uid,action:"getGFormat",gridid:c.gridid}}}).load(function(e){if(0<e.length){var h=Ext.create("Ext.data.Store",{fields:["col_id","col_index","col_width","col_visible"],autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}});h.loadData(e[0].get("colFormats"));if(0<h.getCount()){c.addCusFormatIcon();for(e=0;e<h.getCount();e++)for(var g=
0;g<b.length;g++)if(b[g].colid==h.getAt(e).get("col_id")){"1"==h.getAt(e).get("col_visible")?(b[g].hasOwnProperty("hidden"),b[g].hidden=!1,0!=h.getAt(e).get("col_width")&&(b[g].hasOwnProperty("width"),b[g].width=parseInt(h.getAt(e).get("col_width")))):(0!=h.getAt(e).get("col_width")&&(b[g].hasOwnProperty("width"),b[g].width=parseInt(h.getAt(e).get("col_width"))),b[g].hasOwnProperty("hidden"),b[g].hidden=!0);f.push(b[g]);b.splice(g,1);break}if(null!=b&&0!=b.leght)for(e=0;e<b.length;e++)b[e].hidden=
!0,f.push(b[e])}else f=b;d.reconfigure(a,f)}else d.reconfigure(a,b)});null!=c.languageObj&&(e.items.get(0).setText(c.languageObj.save_format),e.items.get(1).setText(c.languageObj.load_def_format))},clearGrid:function(){var a=this.items.get(2).getStore();null!=a&&a.removeAll()},gridReload:function(){var a=this.items.get(2);null!=a&&a.getStore().load()},griddbclick:function(a,b,c,d,e,f,k,l){},getGrid:function(){return this.items.get(2)}});
Ext.define("DCI.Customer.HeadPanel",{extend:"Ext.panel.Panel",alias:"DCI.Customer.HeadPanel",region:"north",width:300,border:0,headform:null,postvalue:"",uid:"",layout:"border",canEdit:!0,cusMsg:[],keepAdd:!0,exceptionEditAuth:function(){return["1",""]},exceptionDeleteAuth:function(){return["1",""]},afterSaveFunc:function(a){},initComponent:function(){if(null!=this.headform){var a=Ext.create("DCI.Customer.ToolBarPanel",{bindform:this.headform,postvalue:this.postvalue,uid:this.uid,canEdit:this.canEdit,
exceptionEditAuth:this.exceptionEditAuth,exceptionDeleteAuth:this.exceptionDeleteAuth,afterSaveFunc:this.afterSaveFunc,cusMsg:this.cusMsg,keepAdd:this.keepAdd});a.setTips(this.headform.languageObj);a.ModeChange(PageMode.View);this.headform.toolpanel=a;this.items=[a,this.headform]}this.callParent(arguments)},setCusButtons:function(a){null!=this.items.get(0)&&this.items.get(0).setCusButtons(a)},getCurrMode:function(){if(null!=this.headform)return this.headform.getCurrMode()}});
Ext.define("DCI.Customer.CheckColumn",{extend:"Ext.grid.column.CheckColumn",xtype:"dcicheckcolumn",alias:"DCI.Customer.CheckColumn",colid:"",showOnly:!1,width:200,canEditControl:function(a,b){return!0},listeners:{beforecheckchange:function(a,b,c,d){return this.showOnly?!1:this.up("panel").up("panel").currmode==PageMode.View?!1:this.canEditControl(a,b)},checkchange:function(a,b,c,d){this.showOnly||(a=this.up("panel").getStore(),null!=a&&1!=a.getAt(b).get("moditag")&&(a.getAt(b).set("moditag",1),a.getAt(b).set("moditp",
"edit"),a.getAt(b).commit()))}}});
Ext.define("DCI.Customer.NumberBox",{extend:"Ext.form.field.Number",alias:"DCI.Customer.NumberBox",defaultvalue:30,labelAlign:"right",ispk:!1,canEdit:!0,maxValue:9999,minValue:30,cusStyle:null,loadDefault:function(){this.setValue(this.defaultvalue)},setReadOnly:function(a){a?this.setFieldStyle({backgroundColor:"#ddd",backgroundImage:"none"}):null!=this.cusStyle&&""!=this.cusStyle?this.setFieldStyle(this.cusStyle):this.setFieldStyle({backgroundColor:"#FFFFFF"});this.callParent(arguments)},initComponent:function(){null!=
this.style&&(this.cusStyle=this.style);this.callParent(arguments)}});Ext.define("DCI.Customer.LightColumn",{extend:"Ext.grid.column.Column",xtype:"dcilightcolumn",alias:"DCI.Customer.LightColumn",colid:"",width:100,renderer:function(a){return"<img src='./../../ImageLoader.dsc?iconid="+a+"' width=16 hight=16/>"}});
Ext.define("DCI.Customer.ImgPickerColumn",{extend:"Ext.grid.column.Column",xtype:"dciimgpickercolumn",alias:"DCI.Customer.ImgPickerColumn",colid:"",text:"",menuDisabled:!0,sortable:!1,maxWidth:30,minWidth:30,width:30,renderer:function(a){return"<img src='./../../images/button_icon/ToolBarSearch.png' />"}});
Ext.define("DCI.Customer.ImgColumn",{extend:"Ext.grid.column.Column",xtype:"dciimgcolumn",alias:"DCI.Customer.ImgColumn",align:"center",colid:"",width:100,renderer:function(a){return"<img src='"+a+"' />"}});Ext.define("DCI.Customer.ImgMapColumn",{extend:"Ext.grid.column.Column",xtype:"dciimgmapcolumn",alias:"DCI.Customer.ImgMapColumn",colid:"",width:100,renderer:function(a){return"<img src='./../../ImageLoader.dsc?imgpath="+a+"'/>"}});
Ext.define("DCI.Customer.DateField",{extend:"Ext.form.field.Date",xtype:"dcidatefield",alias:"DCI.Customer.DateField",oriAllowBlank:!1,defaultvalue:"",ispk:!1,canEdit:!0,cusStyle:null,loadDefault:function(){this.setValue(this.defaultvalue)},setReadOnly:function(a){a?(this.allowBlank=!0,this.setFieldStyle({backgroundColor:"#ddd",backgroundImage:"none"})):(this.allowBlank=this.oriAllowBlank,null!=this.cusStyle&&""!=this.cusStyle?this.setFieldStyle(this.cusStyle):this.setFieldStyle({backgroundColor:"#FFFFFF"}));
this.callParent(arguments)},initComponent:function(){this.oriAllowBlank=this.allowBlank;null!=this.style&&(this.cusStyle=this.style);this.callParent(arguments)}});
Ext.define("DCI.Customer.ColorPicker",{extend:"Ext.form.field.Trigger",xtype:"dcicolorpicker",alias:"DCI.Customer.ColorPicker",picker:null,defaultColor:"FFFFFF",curColor:"",setValue:function(a){this.curColor=a;this.callParent(arguments);return this},getValue:function(){return this.curColor},onTriggerClick:function(){var a=this;a.picker?a.picker.hidden?a.picker.show():a.picker.hide():(a.picker=Ext.create("Ext.picker.Color",{pickerField:this,ownerCt:this,renderTo:document.body,floating:!0,hidden:!1,
focusOnShow:!0,style:{backgroundColor:"#fff"},listeners:{scope:this,select:function(b,c,d){a.setValue(c);a.setFieldStyle("background:#"+c);a.picker.hide()},show:function(a,c){a.getEl().monitorMouseLeave(500,a.hide,a)}}}),a.picker.alignTo(a.inputEl,"tl-bl?"),a.picker.show(a.inputEl))},initComponent:function(){null!=this.curColor&&""!=this.curColor?this.setFieldStyle("background:#"+this.curColor):this.setFieldStyle("background:#"+this.defaultColor);this.callParent(arguments)}});
Ext.define("DCI.Customer.ProgressBarColumn",{extend:"Ext.grid.column.Column",xtype:"dciprogressbarcolumn",alias:"DCI.Customer.ProgressBarColumn",colid:"",width:100,renderer:function(a){var b=a.replace(/,/g,"");a=1*a.replace(/,/g,"")/100;var c=Ext.create("Ext.ProgressBar",{cls:"x-progress-"+(51<=b&&81>b?"brown":81<=b&&100>b?"blue":100<=b?"green":"red"),style:{width:"100%"}});1<a&&(a=1);c.updateProgress(a,b+"%",!0);return Ext.DomHelper.markup(c.getRenderTree())}});
Ext.define("DCI.Customer.Hidden",{extend:"Ext.form.field.Hidden",alias:"DCI.Customer.Hidden",defaultvalue:"",triggerModi:!0,loadDefault:function(){this.setValue(this.defaultvalue)}});Ext.define("DCI.Customer.CheckBox",{extend:"Ext.form.field.Checkbox",xtype:"dcicheckbox",alias:"DCI.Customer.CheckBox",defaultvalue:"",ispk:!1,canEdit:!0,checked:!1,loadDefault:function(){this.setValue(this.defaultvalue)},getSubmitValue:function(){var a=0;return a=this.checked?1:0}});
Ext.define("DCI.Customer.EmptyButton",{extend:"Ext.button.Button",alias:"DCI.Customer.EmptyButton",targetComp:null,ispk:!1,canEdit:!0});
Ext.define("DCI.Customer.OpenWinWindow",{extend:"Ext.window.Window",alias:"DCI.Customer.OpenWinWindow",layout:"border",title:"Query",height:200,width:400,minWidth:300,minHeight:200,modal:!0,plain:!0,parentButton:null,showSelectAll:!1,items:[{xtype:"panel",region:"north",layout:"absolute",height:35,items:[{xtype:"combobox",fieldLabel:"",displayField:"label",valueField:"value",typeAhead:!0,editable:!1,queryMode:"local",labelWidth:1,matchFieldWidth:!1,multiSelect:!1,forceSelection:!0,store:Ext.create("Ext.data.Store",
{fields:[{name:"label",type:"string"},{name:"value",type:"string"}],autoLoad:!1,proxy:{type:"memory",reader:{type:"json"}}}),x:5,y:5},{xtype:"textfield",name:"qvalue",fieldLabel:"",labelWidth:1,width:160,x:140,y:5},{xtype:"button",cls:"search-toolbar",width:30,height:30,x:300,y:1,handler:function(){var a=this.up("panel").up("window").items.get(1).getStore(),b=this.up("panel").items.get(0).getValue(),c=this.up("panel").items.get(1).getValue();a.getProxy().extraParams.hasOwnProperty("filter")&&(a.getProxy().extraParams.filter=
" and "+b+" like '%"+c+"%' ");a.load()}},{xtype:"dcicheckbox",labelWidth:30,defaultvalue:0,x:335,y:5,triggerChange:!0,listeners:{change:function(a,b,c,d){this.triggerChange&&null!=this.up("panel").up("panel").parentButton&&this.up("panel").up("panel").parentButton.selectAllEvent(a,b,c,d)}},setChecked:function(a){this.triggerChange=!1;this.setValue(a);this.triggerChange=!0}}]},{xtype:"grid",region:"center",renderer:"component",border:0,stripeRows:!0,autoScroll:!0,loadMask:!0,enableTextSelection:!0,
viewConfig:{forceFit:!1,autoLoad:!1},columns:[],store:null}],buttons:[{xtype:"button",text:"OK",btnkey:"btn001",handler:function(){var a=this.up("window");a.parentButton.setSelectedData(a.items.get(1).getStore());a.close()}},{xtype:"button",text:"Cancel",btnkey:"btn002",handler:function(){this.up("window").close()}}],setInitObjects:function(a,b,c){if(0<a.length){var d=this.items.get(0).items.get(0);d.getStore().loadData(a[0].get("cols"));0<d.getStore().getCount()&&("undefined"!=typeof d&&null!=d)&&
d.setValue(d.getStore().getAt(0).get("value"))}this.items.get(1).reconfigure(b,c);null!=this.parentButton.langsObj&&(this.down("button[btnkey=btn001]").setText(this.parentButton.langsObj.ok),this.down("button[btnkey=btn002]").setText(this.parentButton.langsObj.cancel),this.setTitle(this.parentButton.langsObj.toolbar_query_title),this.items.get(0).items.get(3).setFieldLabel(this.parentButton.langsObj.select_all));this.items.get(0).items.get(3).setVisible(this.showSelectAll);this.showSelectAll&&this.items.get(0).items.get(3).setValue(this.parentButton.isAll())}});
Ext.define("DCI.Customer.OpenWinTrigger",{extend:"Ext.button.Button",alias:"DCI.Customer.OpenWinTrigger",targetComp:null,ispk:!1,canEdit:!0,displayCols:[],gridStore:null,filterComboRecord:null,actionurl:"",buttonID:"",pvalue:"",puid:"",winHeight:200,winWidth:450,langsObj:null,showSelectAll:!1,handler:function(){var a=Ext.create("DCI.Customer.OpenWinWindow",{height:this.winHeight,width:this.winWidth,parentButton:this,showSelectAll:this.showSelectAll});a.setInitObjects(this.filterComboRecord,this.gridStore,
this.displayCols);a.show()},setReadOnly:function(a){this.setDisabled(a)},loadDefault:function(){null!=this.targetComp&&this.targetComp.loadDefault()},setInitObjs:function(a){this.filterComboRecord=a;null!=this.gridStore&&this.gridStore.load()},setSelectedData:function(){},initComponent:function(){var a=this;Ext.create("Ext.data.Store",{autoLoad:!1,fields:["cols"],proxy:{type:"ajax",url:a.actionurl,actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{DCITag:a.pvalue,uid:a.puid,action:"openwinQcombo",
btnid:a.buttonID}}}).load(function(b){0<b.length&&a.setInitObjs(b)});this.callParent(arguments)},selectAllEvent:function(a,b,c,d){},isAll:function(){return 0}});
Ext.define("DCI.Customer.SqlEditor",{extend:"Ext.form.TextArea",alias:"DCI.Customer.SqlEditor",width:"100%",labelWidth:75,msgTarget:"side",autoScroll:!0,cusStyle:null,defaultvalue:"",ispk:!1,canEdit:!0,codemirror:null,initComponent:function(){null!=this&&(this.maxHeight=this.height);null!=this.style&&(this.cusStyle=this.style);this.callParent(arguments)},loadDefault:function(){this.setValue(this.defaultvalue)},setReadOnly:function(a){a?this.setFieldStyle({backgroundColor:"#ddd",backgroundImage:"none"}):
null!=this.cusStyle&&""!=this.cusStyle?this.setFieldStyle(this.cusStyle):this.setFieldStyle({backgroundColor:"#FFFFFF"});this.callParent(arguments)}});
Ext.define("Ext.ux.plugins.FitToParent",{alias:"plugin.fittoparent",extend:"Object",fitWidth:!0,fitHeight:!0,offsets:[0,0],constructor:function(a){a=a||{};if(a.tagName||a.dom||Ext.isString(a))a={parent:a};Ext.apply(this,a)},init:function(a){this.component=a;a.on("render",function(a){this.parent=Ext.get(this.parent||a.getPositionEl().dom.parentNode);a.doLayout&&(a.monitorResize=!0,a.doLayout=Ext.Function.createInterceptor(a.doLayout,this.fitSize,this));this.fitSize();Ext.EventManager.onWindowResize(this.fitSize,
this)},this,{single:!0})},fitSize:function(){var a=this.component.getPosition(!0),b=this.parent.getViewSize();this.component.setSize(this.fitWidth?b.width-a[0]-this.offsets[0]:void 0,this.fitHeight?b.height-a[1]-this.offsets[1]:void 0)}});var viewHeight=0;
function showview(a,b){var c=180;refalshTime=Ext.create("Ext.toolbar.TextItem",{text:getCurrentTime()});Ext.define("TreeModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"string"},{name:"text",type:"string"},{name:"level",type:"int"},{name:"leaf",type:"boolean"},{name:"url",type:"string"},{name:"cls",type:"string"},{name:"parent",type:"string"},{name:"lkbcolor",type:"string"},{name:"imgurl",type:"string"}]});var d=Ext.create("Ext.data.Store",{fields:["display","value"],data:[{display:"5",value:"5"},
{display:"10",value:"10"},{display:"30",value:"30"},{display:"60",value:"60"},{display:"120",value:"120"},{display:"180",value:"180"},{display:"300",value:"300"},{display:"600",value:"600"}]}),e=Ext.create("Ext.Button",{enableToggle:!0,iconCls:"startbutton",tooltip:"Auto Refresh",handler:function(){null!=mainPanel.items&&0!=mainPanel.items.length?timerControl(k,this,b,c):this.toggle(!1)}}),f=Ext.create("Ext.Button",{iconCls:"refreshbutton",tooltip:"Refresh",handler:function(){refreshTab(b)}});timergapcombo=
Ext.create("Ext.form.field.ComboBox",{store:d,queryMode:"local",displayField:"display",valueField:"value",width:60,typeAhead:!0,editable:!1,listeners:{change:function(a,b,d,e){c!=b&&(timerisrunning?(alert("please stop timmer"),a.setValue(d)):c=b)}}});timergapcombo.setValue("180");d=Ext.create("Ext.data.TreeStore",{model:"TreeModel",proxy:{type:"ajax",url:"index.do",actionMethods:{read:"POST"},reader:{type:"json",root:"datas"},extraParams:{DCITag:b}},root:{text:"LKB Functions",id:"FuncTreeRoot",expanded:!0}});
funcTree=Ext.create("Ext.tree.Panel",{rootVisible:!1,width:150,height:150,viewConfig:{loadMask:!0},useArrows:!0,store:d,listeners:{itemclick:function(d,f,g,m,n){if(!0==f.data.leaf){timerisrunning&&timerControl(k,e,b,c);indexstatusbar.showBusy();d="tab"+f.data.id;g=!1;for(m=0;m<mainPanel.items.length&&!g;m++)mainPanel.items.getAt(m).id==d&&(g=!0);g?(mainPanel.setActiveTab(d),indexstatusbar.clearStatus({useDefaults:!0})):(g="",g=-1!=d.indexOf("EKBQ")?"/LKB/FuncViews/Query/"+d.substring(3)+".jsp":-1!=
d.indexOf("SCH")?"/LKB/FuncViews/WS/"+d.substring(3)+".jsp":"/LKB/FuncViews/LKB01.jsp",functab=Ext.create("Ext.Panel",{id:d,title:f.data.text,closable:!0,loader:{url:g,scripts:!0,params:{SFTTag:a,funcid:f.data.id,lkbcolor:f.data.lkbcolor,imgurl:f.data.imgurl},listeners:{load:function(a,b,c,d){indexstatusbar.clearStatus({useDefaults:!0})}}},listeners:{added:function(a){a.loader.load()}}}),mainPanel.add(functab),functab.show(),mainPanel.setActiveTab(d))}}}});indexstatusbar=Ext.create("Ext.ux.StatusBar",
{id:"index-statusbar",defaultText:"Ready",defaultIconCls:"x-status-valid",items:["-",f,"-",e,timergapcombo,"-","Last Update Time :",refalshTime]});mainPanel=Ext.create("Ext.tab.Panel",{region:"center",xtype:"tabpanel",deferredRender:!1,bbar:indexstatusbar,listeners:{tabchange:function(a,d,f,m){timerisrunning&&timerControl(k,e,b,c);-1==a.getActiveTab().getId().indexOf("EKBQ")?indexstatusbar.show():indexstatusbar.hide();indexstatusbar.doLayout()},resize:function(a,b,c,d,e,f){null!=a.getActiveTab()&&
(d=Ext.getCmp(a.getActiveTab().getId().substring(3)+"main"),"undefined"!=typeof d&&null!=d?(d.setWidth(b),d.setHeight(c-a.getTabBar().getHeight())):(d=Ext.getCmp("KBP"+a.getActiveTab().getId().substring(3)),"undefined"!=typeof d&&null!=d&&(d.setWidth(b),d.setHeight(c-a.getTabBar().getHeight()-indexstatusbar.getHeight()))))}}});Ext.create("Ext.Viewport",{id:"DCIIndex",layout:"border",items:[{region:"west",stateId:"funcPanel",id:"west-panel",title:"功能列表",split:!0,width:200,minWidth:175,maxWidth:300,
collapsible:!0,animCollapse:!0,layout:"fit",items:[funcTree]},mainPanel]});viewHeight=mainPanel.getHeight()-mainPanel.getTabBar().getHeight();var k=(new Ext.util.TaskRunner).newTask({run:function(){refreshTab(b)}})}
function refreshTab(a){if(null!=mainPanel.items&&0!=mainPanel.items.length){var b=mainPanel.getActiveTab();null==b?alert("no active tab"):(b=b.id.substring(3),Ext.define("DCI.DCIBLKModel1",{extend:"Ext.data.Model",fields:[{name:"id",type:"string",mapping:"id"},{name:"pattern",type:"int"},{name:"bodyStyle",type:"string"},{name:"html",type:"string"},{name:"height",type:"int"}]}),a=new Ext.data.Store({id:"DCIBLKStore",requires:"DCI.DCIBLKModel1",model:"DCI.DCIBLKModel1",proxy:{type:"ajax",url:"showlkb.do",
actionMethods:{read:"POST"},reader:{type:"json"},extraParams:{action:"refresh",DCITag:a,funcid:b}}}),b="KBP"+b,a.load(function(a){if(null!=a&&0<a.length)for(var b=null,e=0;e<a.length;e++)b=Ext.getCmp(a[e].get("id")),1==a[e].get("pattern")?(b.body.update(a[e].get("html")),b.setBodyStyle(a[e].get("bodyStyle"))):(3==a[e].get("pattern")||4==a[e].get("pattern"))&&b.body.update(a[e].get("html"))}),Ext.fly(refalshTime.getEl()).update(getCurrentTime()))}}
function timerControl(a,b,c,d){timerisrunning?(a.stop(),timerisrunning=!1,b.setIconCls("startbutton"),indexstatusbar.setStatus({text:"Ready",iconCls:"x-status-valid"}),b.toggle(!1)):(b.setIconCls("pausebutton"),indexstatusbar.setStatus({text:"",iconCls:"timerrunning"}),b.toggle(!0),timerisrunning=!0,refreshTab(c),a.start(1E3*d))}
function getCurrentTime(){var a=new Date,b=a.getHours(),c=a.getMinutes(),a=a.getSeconds();10>b&&(b="0"+b.toString());10>c&&(c="0"+c.toString());10>a&&(a="0"+a.toString());return b+":"+c+":"+a}
function getCurrentDateTime(){var a=new Date,b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate(),e=a.getHours(),f=a.getMinutes(),a=a.getSeconds();10>c&&(c="0"+c.toString());10>d&&(d="0"+d.toString());10>e&&(e="0"+e.toString());10>f&&(f="0"+f.toString());10>a&&(a="0"+a.toString());return b+"/"+c+"/"+d+" "+e+":"+f+":"+a}
function loadLKB(a,b,c,d){a=Ext.create("Ext.panel.Panel",{renderTo:b,id:"KBP"+b,layout:"absolute",autoScroll:!0,height:mainPanel.getHeight()-mainPanel.getTabBar().getHeight()-indexstatusbar.getHeight(),border:!1,bodyBorder:!1,bodyStyle:"background : "+d+";",loader:{url:"showlkb.do",params:{DCITag:a,funcid:b}},renderer:function(a,b,c,d,h,g){}});null!=c&&""!=c&&(c=Ext.create("Ext.Img",{src:c}),a.add(c));a.loader.load({renderer:"component"})};
